<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Research notes" href="research_notes.html" /><link rel="prev" title="Introduction" href="introduction.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Technical reports - RX004</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=da9162aa" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">RX004</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">RX004</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">목차:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current has-children current-page"><a class="current reference internal" href="#">Technical reports</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Technical reports</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win">유비노스 시작 안내서 (윈도우즈)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-002006-vscode-tips">VSCode 활용 팁</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rx004">RX004 라이브러리 사용 안내서</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-004015-rx004-01-proposal">연구과제004-01 제안서</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-004016-rx004-02-proposal">연구과제004-02 제안서</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-004021-rx004-01-result-report-group01">연구과제004-01 결과 보고서 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-004022-rx004-01-result-report-group02">연구과제004-01 결과 보고서 02조</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-004023-rx004-02-result-report-group01">연구과제004-02 결과 보고서 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="#technical-report-004024-rx004-02-result-report-group02">연구과제004-02 결과 보고서 02조</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="research_notes.html">Research notes</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Research notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="research_notes.html#sprt-03-06-rx004-01">연구 노트 2025_0112_0208_SPRT_03_06 RX004 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="research_notes.html#sprt-03-06-rx004-02">연구 노트 2025_0112_0208_SPRT_03_06 RX004 02조</a></li>
<li class="toctree-l2"><a class="reference internal" href="research_notes.html#sprt-07-09-rx004-01">연구 노트 2025_0209_0301_SPRT_07_09 RX004 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="research_notes.html#sprt-07-09-rx004-02">연구 노트 2025_0209_0301_SPRT_07_09 RX004 02조</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="seminar.html">Seminar</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="rx004_01.html">Project RX0004-01</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Project RX0004-01</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-aws-setting-guide">RX004 AWS Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-aws-cli-setting-guide">RX004 AWS CLI Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-dynamodb-and-access-policy-setting-guide">RX004 DynamoDB and Access Policy Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-iotcore-lorawan-gateway-setting-guide">RX004 IoTCore LoRaWAN Gateway Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-iotcore-lorawan-device-setting-guide">RX004 IoTCore LoRaWAN Device Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-amplify-sensor-data-view-deployment-guide">RX004 Amplify Sensor Data View Deployment Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions_and_answers.html">Questions and answers</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="appendix.html">Appendix</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Appendix</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#restructuredtext-basic">reStructuredText basic</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="technical-reports">
<span id="id1"></span><h1>Technical reports<a class="headerlink" href="#technical-reports" title="Link to this heading">¶</a></h1>
<br><hr class="docutils" />
<section id="technical-report-002003-ubinos-getting-started-guide-win">
<span id="id2"></span><h2>유비노스 시작 안내서 (윈도우즈)<a class="headerlink" href="#technical-report-002003-ubinos-getting-started-guide-win" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><dl class="simple">
<dt>유비노스 시작 안내서 동영상 채널: (<a class="reference external" href="https://youtube.com/&#64;ubinos">https://youtube.com/&#64;ubinos</a>)</dt><dd><ul>
<li><dl class="simple">
<dt><a class="reference external" href="https://youtube.com/playlist?list=PLrCPdTJCbmB9TwyiUClB_ze8P-u7AsCWI&amp;si=9AICUF_AUI6j8N2w">Ubinos Getting Started Guide 재생 목록</a></dt><dd><ul>
<li><p><a class="reference external" href="https://youtu.be/CFY_Ksk_xAg">Ubinos Getting Started Guide (Windows) 동영상</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/XMzsgVgeJZc">Ubinos Library Update Guide 동영상</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>유비노스 관련 문의 및 답변:</dt><dd><ul>
<li><p>유비노스 깃허브 이슈 웹페이지: (<a class="reference external" href="https://github.com/ubinos/ubinos.issues">https://github.com/ubinos/ubinos.issues</a>)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<br><section id="id3">
<h3>운영체제 종속적 패키지 설치<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<section id="chocolatey">
<h4>Chocolatey 설치<a class="headerlink" href="#chocolatey" title="Link to this heading">¶</a></h4>
<ol class="arabic">
<li><p><strong>관리자 권한으로</strong> PowerShell 실행</p></li>
<li><dl>
<dt>다음 명령어 실행</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString(&#39;https://community.chocolatey.org/install.ps1&#39;))</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>PowerShell 창 닫기</p></li>
</ol>
</section>
<section id="id4">
<h4>필요한 패키지 설치<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ol class="arabic">
<li><p><strong>관리자 권한으로</strong> 명령 프롬프트(cmd.exe) 실행</p></li>
<li><dl>
<dt>다음 명령어 실행해 필요한 패키지 설치</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">choco feature enable -n allowGlobalConfirmation</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">choco install ninja make gperf git dtc-msys2 wget 7zip python3 python3-virtualenv python311 cmake qemu</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p><strong>명령 프롬프트(cmd.exe) 창 닫기</strong></p></li>
<li><dl>
<dt>시스템 변수의 PATH에 다음 경로를 추가한다.</dt><dd><ul>
<li><dl class="simple">
<dt>시스템 변수의 PATH 설정 메뉴</dt><dd><ul class="simple">
<li><p>윈도우 설정 -&gt; 시스템 -&gt; 정보 -&gt; 고급 시스템 설정 -&gt; 환경 변수 -&gt; 시스템 변수 -&gt; Path</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>추가할 경로</dt><dd><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\Program Files\qemu
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
<p><a class="reference internal" href="#figure-002002-ubinos-env-path-setting-win"><span class="std std-numref">그림 2</span></a> 은 경로 설정 예를 보여준다.</p>
</dd>
</dl>
</li>
<li><p>일반 사용자 권한으로 명령 프롬프트(cmd.exe) 실행</p></li>
<li><dl>
<dt>다음 명령을 수행해 git 사용자 이름과 이메일 설정</dt><dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>“Your Name”과 “<a class="reference external" href="mailto:your-email&#37;&#52;&#48;example&#46;com">your-email<span>&#64;</span>example<span>&#46;</span>com</a>”을 본인의 이름과 이메일로 변경해서 실행해야 한다.</p>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git config --global user.name &quot;Your Name&quot;</span>
<span class="go">git config --global user.email &quot;your-email@example.com&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>명령 프롬프트(cmd.exe) 창 닫기</p></li>
</ol>
<br><figure class="align-center" id="id71">
<span id="figure-002002-ubinos-env-path-setting-win"></span><a class="reference internal image-reference" href="_images/figure_002002_ubinos_env_path_setting_win.png"><img alt="Ubinos Env. Path Setting for Windows 11" src="_images/figure_002002_ubinos_env_path_setting_win.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 2 </span><span class="caption-text">Ubinos Env. Path Setting for Windows 11</span><a class="headerlink" href="#id71" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<br></section>
</section>
<section id="ssh-key-github">
<h3>SSH key 생성 및 github에 등록<a class="headerlink" href="#ssh-key-github" title="Link to this heading">¶</a></h3>
<section id="ssh-key">
<h4>SSH key 생성<a class="headerlink" href="#ssh-key" title="Link to this heading">¶</a></h4>
<ol class="arabic">
<li><p>일반 사용자 권한으로 명령 프롬프트(cmd.exe) 실행</p></li>
<li><dl>
<dt>다음 명령어를 실행해 ssh key를 생성</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ssh-keygen -t rsa -b 4096</span>
</pre></div>
</div>
<ul class="simple">
<li><p>file을 입력하라는 메시지가 나오면 엔터를 눌러 기본값을 선택한다.</p></li>
<li><p>passphrase를 입력하라는 메시지가 나오면 엔터를 눌러 no passphrase를 선택한다.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령어를 실행해 생성한 공개키를 클립보드에 복사</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">type %USERPROFILE%\.ssh\id_rsa.pub | clip</span>
</pre></div>
</div>
<ul class="simple">
<li><p>file을 기본값인 id_rsa가 아닌 다른 것을 선택했다면 해당 file로 변경해서 실행해야 한다.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>명령 프롬프트(cmd.exe) 창 닫기</p></li>
</ol>
</section>
<section id="ssh-github">
<h4>생성한 SSH 공개키를 github에 등록<a class="headerlink" href="#ssh-github" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>웹브라우저에서 <a class="reference external" href="https://github.com">https://github.com</a> 에 접속한한 후, 로그인</p></li>
<li><p>오른쪽 상단의 프로필 사진을 클릭한 후, Settings 클릭</p></li>
<li><p>좌측 메뉴에서 SSH and GPG keys 클릭</p></li>
<li><p>New SSH key 클릭</p></li>
<li><p>Title에 원하는 이름을 입력</p></li>
<li><p>Key에 복사한 공개키를 붙여넣기</p></li>
<li><p>Add SSH key 클릭</p></li>
</ol>
<br></section>
</section>
<section id="id5">
<h3>유비노스 소스트리 다운로드 및 개발용 가상환경 생성<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<section id="id6">
<h4>유비노스 소스트리 다운로드<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<ol class="arabic">
<li><p>일반 사용자 권한으로 명령 프롬프트(cmd.exe) 실행</p></li>
<li><dl>
<dt>다음 명령을 실행해 작업용 디렉토리 생성 후 해당 디렉토리로 이동</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir C:\MyWorks\ubinos</span>
<span class="go">cd C:\MyWorks\ubinos</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령어를 실행해 유비노스 소스트리 다운로드</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://github.com/ubinos/ubiworks.git</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령어를 실행해 다운로드한 유비노스 소스트리 디렉토리로 이동</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd ubiworks</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령어를 실행해 유비노스 소스트리 서브모듈 다운로드</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git submodule update --init</span>
<span class="go">git submodule foreach git switch ubinos-main</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>명령 프롬프트(cmd.exe) 창 닫기</p></li>
</ol>
</section>
<section id="id7">
<h4>개발용 가상환경 생성<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<ol class="arabic">
<li><p>일반 사용자 권한으로 명령 프롬프트(cmd.exe) 실행</p></li>
<li><dl>
<dt>다음 명령을 실행해 유비노스 소스트리 make 디렉토리로 이동</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\MyWorks\ubinos\ubiworks\make</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령을 실행해 “Ubinos config selecgtor”를 실행</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xsel</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“Ubinos config selecgtor” 창이 뜨면 다음을 선택한 후 Select 버튼을 클릭</dt><dd><ul class="simple">
<li><p>ubinos project의 ubinos_venv</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령을 실행해 빌드</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make rebuildd</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>빌드가 정상적으로 완료되면 다름과 같이 가상환경 활성화, 비활성화 명령이 출력됨</dt><dd><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;&quot;
&quot;* env activate command: &quot;
&quot;C:\MyWorks\ubinos\ubiworks\output\ubinos_venv\Scripts\activate.bat&quot;
&quot;&quot;
&quot;* env deactivate command: &quot;
&quot;deactivate&quot;
&quot;&quot;
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>가상환경 활성화 명령을 실행해 ubinos_venv 활성화</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">C:\MyWorks\ubinos\ubiworks\output\ubinos_venv\Scripts\activate.bat</span>
</pre></div>
</div>
<ul>
<li><dl>
<dt>위 명령처럼 절대경로로 실행해도 되지만, 아래 명령처럼 상대경로로 실행해도 된다.</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">..\output\ubinos_venv\Scripts\activate.bat</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>명령 프롬프트(cmd.exe) 창 닫기</p></li>
</ol>
<br></section>
</section>
<section id="vscode">
<h3>VSCode 설치<a class="headerlink" href="#vscode" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><dl class="simple">
<dt>웹브라우저로 다음 URL에 접속해, VSCode를 다운로드 및 설치</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://code.visualstudio.com">https://code.visualstudio.com</a></p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<br></section>
<section id="gnu-arm-embedded-toolchain">
<h3>GNU ARM Embedded Toolchain 설치<a class="headerlink" href="#gnu-arm-embedded-toolchain" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><dl>
<dt>웹브라우저로 다음 URL에 접속해, gcc-arm-none-eabi-10.3-2021.10-win32.exe를 다운로드 및 설치</dt><dd><ul class="simple">
<li><p><a class="reference external" href="https://developer.arm.com/downloads/-/gnu-rm">https://developer.arm.com/downloads/-/gnu-rm</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>설치 완료 창이 뜨면 “Add path to environment variable”을 반드시 체크 하고 마침 버튼을 눌려야 한다.</p>
</div>
</dd>
</dl>
</li>
</ol>
<br></section>
<section id="technical-report-002003-ubinos-getting-started-guide-win-open-ubinsos-source-tree-with-vscode">
<span id="id8"></span><h3>VSCode로 유비노스 소스트리 열기<a class="headerlink" href="#technical-report-002003-ubinos-getting-started-guide-win-open-ubinsos-source-tree-with-vscode" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p>일반 사용자 권한으로 명령 프롬프트(cmd.exe) 실행</p></li>
<li><dl>
<dt>다음 명령을 실행해 유비노스 소스트리 make 디렉토리로 이동</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd C:\MyWorks\ubinos\ubiworks\make</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령을 실행해 유비노스 개발용 가상환경 활성화</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">..\output\ubinos_venv\Scripts\activate.bat</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>다음 명령을 실행해 VSCode로 유비노스 소스트리 열기</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">code ..</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
<br></section>
<section id="vscode-hello-world">
<span id="technical-report-002003-ubinos-getting-started-guide-win-select-and-build-hello-world-example"></span><h3>VSCode로 유비노스 hello_world 예제 선택, 빌드<a class="headerlink" href="#vscode-hello-world" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<ol class="arabic">
<li><dl>
<dt>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 “Ubinos config selecgtor”를 실행</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xsel</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“Ubinos config selecgtor” 창이 뜨면 다음을 선택한 후 Select 버튼을 클릭</dt><dd><ul class="simple">
<li><p>ubinos project의 hello_world_netduinoplus2_qemu</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 빌드</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make rebuildd</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>빌드가 정상적으로 완료되면 다름과 같이 빌드 정보가 출력됨</dt><dd><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[100%] Linking C executable app.elf


entry address                = 0x0800043c (   134218812)

isr vector start             = 0x08000000 (   134217728)
isr vector end               = 0x08000188 (   134218120)
isr vector size              = 0x00000188 (         392) bytes

relocated isr vector start   = 0x20000000 (   536870912)
relocated isr vector end     = 0x20000200 (   536871424)
relocated isr vector size    = 0x00000200 (         512) bytes

text start                   = 0x08000000 (   134217728)
text end                     = 0x080204a0 (   134349984)
text size                    = 0x000204a0 (      132256) bytes

data start                   = 0x20000200 (   536871424)
data end                     = 0x2000053c (   536872252)
data size                    = 0x0000033c (         828) bytes

bss start                    = 0x2000053c (   536872252)
bss end                      = 0x200019e8 (   536877544)
bss size                     = 0x000014ac (        5292) bytes

heap base                    = 0x200019e8 (   536877544)
heap limit                   = 0x2001f800 (   536999936)
heap size                    = 0x0001de18 (      122392) bytes

stack limit                  = 0x2001f800 (   536999936)
stack top                    = 0x20020000 (   537001984)
stack size                   = 0x00000800 (        2048) bytes

flash start                  = 0x08000000 (   134217728)
flash size                   = 0x00100000 (     1048576) bytes
flash usage                  = 0x000207dc (      133084) bytes

ram start                    = 0x20000000 (   536870912)
ram size                     = 0x00020000 (      131072) bytes
ram static usage             = 0x000019e8 (        6632) bytes


[100%] Built target app
make[1]: Leaving directory &#39;C:/MyWorks/ubinos/ubiworks/output/hello_world_netduinoplus2_qemu&#39;
&quot;&quot;
&quot;# [End   common-build - hello_world_netduinoplus2_qemu]&quot;
&quot;###############################################################################&quot;
&quot;&quot;
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
<br></section>
<section id="technical-report-002003-ubinos-getting-started-guide-win-run-hello-world-example">
<span id="id9"></span><h3>VSCode로 유비노스 hello_world 예제 실행<a class="headerlink" href="#technical-report-002003-ubinos-getting-started-guide-win-run-hello-world-example" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<ol class="arabic">
<li><dl>
<dt>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 빌드된 elf 파일을 load</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make load</span>
</pre></div>
</div>
<ul class="simple">
<li><p>정상적으로 load가 완료되면 QEMU과, qemu-system-arm 창이 나타난다.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 load된 elf 파일을 실행</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xrun</span>
</pre></div>
</div>
<ul class="simple">
<li><p>정상적으로 실행되면 arm-none-eabi-gdb 창이 뜨고, qemu-system-arm 창에 hello world 메시지가 출력된다.</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<br></section>
<section id="id10">
<h3>VSCode로 디버깅하기 위해 필요한 확장 프로그램 설치 및 설정<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<ol class="arabic simple">
<li><dl class="simple">
<dt>VSCode에서 “Extensions” View를 선택한 후, 다음 확장 프로그램을 설치</dt><dd><ul class="simple">
<li><p>C/C++ (by Microsoft)</p></li>
<li><p>C/C++ Themes (by Microsoft)</p></li>
<li><p>C/C++ Extension Pack (by Microsoft)</p></li>
<li><p>Python (by Microsoft)</p></li>
<li><p>CodeLLDB (by Vadim Chugunov)</p></li>
<li><p>ARM Assembly (by dan-c-underwood)</p></li>
<li><p>CMake (by twxs)</p></li>
<li><p>MemoryView (by mcu-debug)</p></li>
<li><p>Open (by sandcastle)</p></li>
<li><p>CMake Tools (by Microsoft)</p></li>
<li><p>Makefile Tools (by Microsoft)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>다음 확장 프로그램을 비활성화</dt><dd><ul class="simple">
<li><p>CMake Tools (by Microsoft)</p></li>
<li><p>Makefile Tools (by Microsoft)</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
<br></section>
<section id="technical-report-002003-ubinos-getting-started-guide-win-debugging-hello-world-example-with-vscode">
<span id="id11"></span><h3>VSCode로 유비노스 hello_world 예제 실행 및 디버깅<a class="headerlink" href="#technical-report-002003-ubinos-getting-started-guide-win-debugging-hello-world-example-with-vscode" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<ol class="arabic">
<li><p>VSCode에서 “Run and Debug” View를 선택한 후, “Run and debug” 구성으로 “ARM Target (build load)”을 선택</p></li>
<li><p>“F5” 키를 눌러 “Start Debugging” 명령 실행</p></li>
<li><dl>
<dt>VSCode의 Breakpoints 창으로 마우스를 옮기면 나타나는 “+” 버튼을 누른 후, 다음을 입력해 main, appmain 함수 symbol에 breakpoint를 설정</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">main</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">appmain</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>다시 “F5” 키를 눌러 “Continue” 명령 실행</p></li>
</ol>
<br></section>
<section id="technical-report-002003-ubinos-getting-started-guide-win-update-ubinos-libraries">
<span id="id12"></span><h3>유비노스 라이브러리 업데이트<a class="headerlink" href="#technical-report-002003-ubinos-getting-started-guide-win-update-ubinos-libraries" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://youtu.be/XMzsgVgeJZc">Ubinos Library Update Guide 동영상</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<ol class="arabic">
<li><dl>
<dt>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 “Ubinos library manager”를 실행</dt><dd><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xmgr</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>“Ubinos library manager” 창이 뜨면 “Hide ubinos default library list” 체크</p></li>
<li><p>“Fetch and check for update all” 버튼 클릭</p></li>
<li><p>“Done” 메시지가 뜨면 “OK” 버튼 클릭</p></li>
<li><dl>
<dt><strong>Update 가능한 library 는 “U” 항목이 “O” 로 표시됨</strong></dt><dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>“M” 항목이 “O”로 표시된 라이브러리는 로컬에서 수정된 라이브러리이기 때문에 업데이트가 불가능하다.
업데이트 하려면 해당 라이브러리를 선택한 다음 “Reset” 버튼을 클릭해 로컬에서 수정된 내용을 삭제해야 한다.</p>
</div>
</dd>
</dl>
</li>
<li><p>Update 가능한 library 가 있으면, 선택 후 “Update” 버튼 클릭 (<strong>없으면 이후 과정은 생략</strong>)</p></li>
<li><p>“Update library commands” 창이 뜨면 “Run” 버튼 클릭</p></li>
<li><p>“Success” 메시지가 뜨면 “OK” 버튼 클릭</p></li>
<li><p>“Update library commands” 창의 “Close” 버튼 클릭, “Ubinos library manager” 창의 “Close” 버튼 클릭을 차례로 클릭</p></li>
</ol>
<br><hr class="docutils" />
</section>
</section>
<section id="technical-report-002006-vscode-tips">
<span id="id14"></span><h2>VSCode 활용 팁<a class="headerlink" href="#technical-report-002006-vscode-tips" title="Link to this heading">¶</a></h2>
<section id="id15">
<h3>단축키<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>“Run build task” 실행</dt><dd><ul>
<li><p>윈도우: “Ctrl + Shift + B”</p></li>
<li><p>리눅스: “Ctrl + Shift + B”</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“Extensions” View 선택</dt><dd><ul>
<li><p>윈도우: “Ctrl + Shift + X”</p></li>
<li><p>리눅스: “Ctrl + Shift + X”</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“Run and Debug” View 선택</dt><dd><ul>
<li><p>윈도우: “Ctrl + Shift + D”</p></li>
<li><p>리눅스: “Ctrl + Shift + D”</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“Source control” View 선택</dt><dd><ul>
<li><p>윈도우: “Ctrl + Shift + G”, “G”</p></li>
<li><p>리눅스: “Ctrl + Shift + G”</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“Explorer” View 선택</dt><dd><ul>
<li><p>윈도우: “Ctrl + Shift + E”</p></li>
<li><p>리눅스: “Ctrl + Shift + E”</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<br><hr class="docutils" />
</section>
</section>
<section id="rx004">
<span id="technical-report-004020-rx004-library-user-guide"></span><h2>RX004 라이브러리 사용 안내서<a class="headerlink" href="#rx004" title="Link to this heading">¶</a></h2>
<p>RX004 연구모임이 개발한 라이브러리 사용 방법을 설명합니다.</p>
<section id="id16">
<h3>1. 유비노스 및 RX004 라이브러리 설치<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<section id="id17">
<h4>1.1. 유비노스 설치<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>디음 과정을 수행해 필요한 패키지들과 소스트리를 설치</p></li>
</ol>
<ul class="simple">
<li><p>윈도우즈: “<a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win"><span class="std std-ref">유비노스 시작 안내서 (윈도우즈)</span></a>”</p></li>
</ul>
</section>
<section id="id18">
<h4>1.2. RX004 라이브러리 설치<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>다음을 참조해 VSCode로 유비노스 소스트리 열기</p></li>
</ol>
<ul class="simple">
<li><p>윈도우즈: “<a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win-open-ubinsos-source-tree-with-vscode"><span class="std std-ref">VSCode로 유비노스 소스트리 열기</span></a>”</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>VSCode에서 “make/liblist.json” 파일 파일 열기</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>“library/ubinos/make/liblist.json”이 아니고, “make/liblist.json”입니다.</p>
</div>
<ol class="arabic simple" start="3">
<li><p>연 파일의 기존 내용을 모두 지우고 아래 내용을 붙여넣기</p></li>
</ol>
<ul>
<li><p>일반 사용자</p>
<blockquote>
<div><ul class="simple">
<li><p>추후 공개 예정</p></li>
</ul>
</div></blockquote>
</li>
<li><p>RX004 연구모임 1조 (접근 권한 필요, 수정 가능)</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rx004&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;git@github.com:sogongbang/rx004.git&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;branch_tag_commit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;branch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rx004_group01&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RX004 library for group 1&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>RX004 연구모임 2조 (접근 권한 필요, 수정 가능)</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rx004&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;git@github.com:sogongbang/rx004.git&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;branch_tag_commit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;branch&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rx004_group02&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RX004 library for group 2&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 “Ubinos library manager”를 실행</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xmgr</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>“Ubinos library manager” 창이 뜨면 “Hide ubinos default library list” 체크</p></li>
<li><p>다음 라이브러리들을 체크 하고, “Install” 버튼 클릭</p></li>
</ol>
<ul class="simple">
<li><p>rx004”</p></li>
</ul>
<ol class="arabic simple" start="7">
<li><p>“Install library commands” 창이 뜨면 “Run” 버튼 클릭</p></li>
<li><p>“Success” 메시지가 뜨면 “OK” 버튼 클릭</p></li>
<li><p>“Install library commands” 창의 “Close” 버튼 클릭, “Ubinos library manager” 창의 “Close” 버튼 클릭을 차례로 클릭</p></li>
</ol>
</section>
</section>
<section id="id19">
<h3>2. RX004 라이브러리 사용 방법<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VSCode에서 “Run build task” 등 실행, 각종 View 선택 방법은 <a class="reference internal" href="#technical-report-002006-vscode-tips"><span class="std std-ref">VSCode 활용 팁</span></a> 참조</p>
</div>
<section id="rx004-home">
<h4>2.1. RX004 Home 문서 편집, 빌드, 결과물 확인<a class="headerlink" href="#rx004-home" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>다음을 참조해 VSCode로 유비노스 소스트리 열기</p></li>
</ol>
<ul class="simple">
<li><p>윈도우즈: “<a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win-open-ubinsos-source-tree-with-vscode"><span class="std std-ref">VSCode로 유비노스 소스트리 열기</span></a>”</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>다음 디렉토리 아래의 RX004 Home 문서 편집</p></li>
</ol>
<ul class="simple">
<li><p>“library/rx004/doc/rx004_home/doc”</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 “Ubinos config selecgtor”를 실행</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xsel</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>“Ubinos config selecgtor” 창이 뜨면 다음을 선택한 후 Select 버튼을 클릭</p></li>
</ol>
<ul class="simple">
<li><p>rx004 project의 rx004_home_html</p></li>
</ul>
<ol class="arabic simple" start="5">
<li><p>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 빌드 실행</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make rebuildd</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>VSCode에서 “Run build task” 실행 후, 다음 명령을 선택해 결과물 확인</p></li>
</ol>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">make xrun</span>
</pre></div>
</div>
</section>
<section id="rx004-github">
<h4>2.2. RX004 수정 내용을 github에 올리기<a class="headerlink" href="#rx004-github" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>VSCode에서 “Source control” View를 선택</p></li>
<li><p>“Source control” View 상단의 “…”을 클릭한 후 “Repositories”를 체크</p></li>
<li><p>“Source control” View의 “Repositories” 창에서 “rx004” 선택</p></li>
<li><p>“Source control” View의 “Changes” 창에서 github에 올릴 파일들을 선택</p></li>
<li><p>우클릭 후 “Stage Changes” 선택</p></li>
<li><p>“Source control” View의 “Commit” 버튼 위에 메시지 입력</p></li>
<li><p>“Source control” View의 “Commit” 버튼 클릭</p></li>
<li><p>“Sync Changes” 버튼 클릭</p></li>
<li><p>확인 창이 뜨면 “OK” 버튼 클릭</p></li>
</ol>
<br><hr class="docutils" />
</section>
</section>
</section>
<section id="technical-report-004015-rx004-01-proposal">
<span id="id20"></span><h2>연구과제004-01 제안서<a class="headerlink" href="#technical-report-004015-rx004-01-proposal" title="Link to this heading">¶</a></h2>
<section id="id21">
<h3>연구 목적<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h3>
<p>초저전력 IoT 장치를 위한 LoRaWAN 기반 무선 통신망을 구축한다.</p>
<figure class="align-center" id="id72">
<span id="figure-004004-technical-report-015-rx004-01-overview-diagram"></span><a class="reference internal image-reference" href="_images/figure_004004_technical_report_015_rx004_01_overview_diagram.png"><img alt="RX004-01 overview diagram" src="_images/figure_004004_technical_report_015_rx004_01_overview_diagram.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 3 </span><span class="caption-text">RX004-01 overview diagram</span><a class="headerlink" href="#id72" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id22">
<h3>연구 내용<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h3>
<section id="id23">
<h4>단말장치 개발<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>RAK WisBlock Starter Kit을 사용해 개발</dt><dd><ul>
<li><p>RAK에서 제공하는 개발키트와 예제 사용</p></li>
<li><p>웹페이지: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak11310/overview">https://docs.rakwireless.com/product-categories/wisblock/rak11310/overview</a></p></li>
<li><p>보드: RAK11310 WisBlock LPWAN Module (RP2040 MCU)</p></li>
<li><p>통신: LoRAWAN KR920</p></li>
<li><p>센서: 온도 습도 센서 (SHTC3)</p></li>
<li><p>소프트웨어 개발 환경: Arduino IDE (C/C++) 또는 Ubiworks(C/C++)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>요구 사항</dt><dd><ul>
<li><p>설정된 주기로 온도 습도 데이터를 수집해 서버로 전송</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id24">
<h4>게이트웨이 개발<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>RAK WisGate Developer D4H+ Kit 개발</dt><dd><ul>
<li><p>RAK에서 제공하는 개발키트와 예제 사용</p></li>
<li><p>웹페이지: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/overview">https://docs.rakwireless.com/product-categories/wisgate/rak7248/overview</a></p></li>
<li><p>보드: Raspberry Pi 4</p></li>
<li><p>통신: LoRAWAN KR920, WiFi</p></li>
<li><p>소프트웨어 개발 환경: Linux console (C/C++) 또는 Ubiworks(C/C++)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>요구 사항</dt><dd><ul>
<li><p>단말장치가 전송하는 데이터를 MQTT 프로토콜을 사용해 서버로 전달</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id25">
<h4>서버 개발<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>AWS IoT Core for LoRaWAN를 사용해 개발</dt><dd><ul>
<li><p>RAK에서 제공하는 개발키트와 예제 사용</p></li>
<li><dl class="simple">
<dt>웹페이지:</dt><dd><ul>
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/lorawan/">https://aws.amazon.com/ko/iot-core/lorawan/</a></p></li>
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/lorawan-network-server-guide">https://docs.rakwireless.com/product-categories/wisgate/rak7248/lorawan-network-server-guide</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><p>소프트웨어 개발 환경: AWS IoT console (Python)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>요구 사항</dt><dd><ul>
<li><p>단말장치들이 전송하는 데이터를 받아서 데이터베이스에 저장</p></li>
<li><p>저장된 데이터 그래프로 시각화</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="id26">
<h3>결과물<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>결과 보고서</p></li>
<li><p>소스 코드</p></li>
<li><p>데모 가능한 단말장치, 게이트웨어, 서버 세트</p></li>
</ul>
</section>
<section id="id27">
<h3>예상 일정<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>3주</p></li>
</ul>
<br><hr class="docutils" />
</section>
</section>
<section id="technical-report-004016-rx004-02-proposal">
<span id="id28"></span><h2>연구과제004-02 제안서<a class="headerlink" href="#technical-report-004016-rx004-02-proposal" title="Link to this heading">¶</a></h2>
<section id="id29">
<h3>연구 목적<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h3>
<p>에너지 수확을 통해 베터리 교체 없이 반 영구적으로 동작하는 저해상도 적외선 카메라 IoT 시험망을 구축한다.</p>
<figure class="align-center" id="id73">
<span id="figure-004005-technical-report-016-rx004-02-overview-diagram"></span><a class="reference internal image-reference" href="_images/figure_004005_technical_report_016_rx004_02_overview_diagram.png"><img alt="RX004-02 overview diagram" src="_images/figure_004005_technical_report_016_rx004_02_overview_diagram.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 4 </span><span class="caption-text">RX004-02 overview diagram</span><a class="headerlink" href="#id73" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id30">
<h3>연구 내용<a class="headerlink" href="#id30" title="Link to this heading">¶</a></h3>
<section id="id31">
<h4>단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가<a class="headerlink" href="#id31" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>연구과제004-01에서 개발한 단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가</dt><dd><ul>
<li><p>RAK에서 제공하는 개발키트와 예제 사용</p></li>
<li><p>웹페이지: <a class="reference external" href="https://store.rakwireless.com/products/unify-enclosure-ip65-100x75x38-solar">https://store.rakwireless.com/products/unify-enclosure-ip65-100x75x38-solar</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>요구 사항</dt><dd><ul>
<li><p>태양광으로 에너지를 수확해 단말 장치가 동작할 수 있도록 함</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id32">
<h4>단말 장치에 저해상도 적외선 카메라 기능 추가<a class="headerlink" href="#id32" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>연구과제004-01에서 개발한 단말 장치에 저해상도 적외선 카메라 기능 추가</dt><dd><ul>
<li><p>RAK에서 제공하는 개발키트와 예제 사용</p></li>
<li><p>웹페이지: <a class="reference external" href="https://store.rakwireless.com/products/32x24-pixel-mlx90640-ir-array-module-rak12052">https://store.rakwireless.com/products/32x24-pixel-mlx90640-ir-array-module-rak12052</a></p></li>
<li><p>소프트웨어 개발 환경: Arduino IDE (C/C++) 또는 Ubiworks(C/C++)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>요구 사항</dt><dd><ul>
<li><p>설정된 주기로 적외선 카메라 영상 파일을 서버로 전송</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id33">
<h4>서버에 영상 데이터 저장 기능 추가<a class="headerlink" href="#id33" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><dl class="simple">
<dt>연구과제004-01에서 개발한 서버에 영상 데이터 저장 기능 추가</dt><dd><ul>
<li><p>소프트웨어 개발 환경: AWS IoT console (Python)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>요구 사항</dt><dd><ul>
<li><p>단말장치들이 전송하는 영상을 받아서 파일시스템에 저장</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="id34">
<h3>결과물<a class="headerlink" href="#id34" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>결과 보고서</p></li>
<li><p>소스 코드</p></li>
<li><p>데모 가능한 단말장치, 게이트웨어, 서버 세트</p></li>
</ul>
</section>
<section id="id35">
<h3>예상 일정<a class="headerlink" href="#id35" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>3주</p></li>
</ul>
<br><hr class="docutils" />
</section>
</section>
<section id="technical-report-004021-rx004-01-result-report-group01">
<span id="id36"></span><h2>연구과제004-01 결과 보고서 01조<a class="headerlink" href="#technical-report-004021-rx004-01-result-report-group01" title="Link to this heading">¶</a></h2>
<section id="id37">
<h3><strong>목표</strong><a class="headerlink" href="#id37" title="Link to this heading">¶</a></h3>
<p>센서로 수집한 온도와 습도 데이터를 게이트웨이를 통해 MQTT메세지로 전달하여 lambda function으로 가공하고 DynamoDB에 저장한다.</p>
</section>
<section id="id38">
<h3><strong>과정</strong><a class="headerlink" href="#id38" title="Link to this heading">¶</a></h3>
<p>참고 링크: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK 1901 guide</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK 7248 guide</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak4631/quickstart/">RAK 4631 guide</a>, <a class="reference external" href="https://www.arduino.cc/en/software?_gl=1*1m5w0yf*_up*MQ..*_ga*OTAwNzY0MjQwLjE3NDA0NjMxMjc.*_ga_NEXN8H46L5*MTc0MDQ2MzEyNy4xLjAuMTc0MDQ2MzEyNy4wLjAuMTY1MDU3Nzc2NA..">Arduino</a>, <a class="reference external" href="https://learn.rakwireless.com/hc/en-us/articles/26687371039383-How-To-Perform-Installation-of-Board-Support-Package-in-Arduino-IDE">adding the BSP in Arduino IDE</a>, <a class="reference external" href="https://doc.sm.tc/station/">LoRa Basic Station</a>, <a class="reference external" href="https://docs.aws.amazon.com/iot-wireless/latest/developerguide/what-is-iot-wireless.html">online guide</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK 7268 guide</a>, <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-ddb-rule.html">Storing device data in a DynamoDB table</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/dynamodbv2/home?region=us-east-1#dashboard">DynamoDB console</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/functions">Lambda console</a>, <a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-lambda-rule.html">Formatting a notification by using an AWS Lambda function</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/home">IAM console</a></p>
<hr class="docutils" />
<ul>
<li><dl>
<dt>하드웨어 세팅</dt><dd><ul>
<li><dl>
<dt>RAK 1901 설정</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK 1901 guide</a> 에 접속한다.</p></li>
<li><p>Hardware Setup 항목을 보고 칩을 보드에 부착한다.</p></li>
</ol>
<figure class="align-center" id="id74">
<img alt="부착 위치" src="_images/figure_004101_tec_w1_1.jpg" />
<figcaption>
<p><span class="caption-number">그림 5 </span><span class="caption-text">부착 위치</span><a class="headerlink" href="#id74" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="3">
<li><p>usb 케이블로 컴퓨터와 연결한다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>RAK 7284 설정</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK 7248 guide</a> 에 접속한한다.</p></li>
<li><p>DAtasheet 탭에 들어가서 LoRa Antenna 위치를 확인하고 안테나를 연결한다.</p></li>
</ol>
<figure class="align-center" id="id75">
<img alt="안테나 위치" src="_images/figure_004102_tec_w1_2.jpg" />
<figcaption>
<p><span class="caption-number">그림 6 </span><span class="caption-text">안테나 위치</span><a class="headerlink" href="#id75" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="3">
<li><p>전원 케이블로 전원을 연결한다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>소프트웨어 세팅</dt><dd><ul>
<li><dl>
<dt>게이트웨이 설정</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK 7248 guide</a> 에 접속한다.</p></li>
<li><p>Quick Start Guide 탭에 들어가 가이드를 수행한다.</p></li>
<li><p>설정을 마치면 wifi 또는 이더넷을 통해 게이트웨이에 접속할 수 있다.</p></li>
</ol>
<figure class="align-center" id="id76">
<img alt="게이트웨이에 접속한 모습" src="_images/figure_004104_tec_w1_4.jpg" />
<figcaption>
<p><span class="caption-number">그림 7 </span><span class="caption-text">게이트웨이에 접속한 모습</span><a class="headerlink" href="#id76" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="4">
<li><p><a class="reference external" href="https://doc.sm.tc/station/">LoRa Basic Station</a> 에 접속한다.</p></li>
<li><p>Quick Start 탭에 들어가서 가이드를 수행한다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>게이트웨이 등록</dt><dd><ol class="arabic simple">
<li><p>AWS의 <a class="reference external" href="https://docs.aws.amazon.com/iot-wireless/latest/developerguide/what-is-iot-wireless.html">online guide</a> 에 접속한다.</p></li>
<li><p>AWS IoT Core for LoRaWAN - Connecting to AWS IoT Core for LoRaWAN - Onboard your gateways to AWS IoT Core for LoRaWAN - Add a gateway to AWS IoT Core for LoRaWAN항목에 들어간다.</p></li>
<li><p>Add a gateway using the console 가이드를 수행한다. 이때 gateway’s EUI가 필요한데 putty로 게이트웨이에 접속하고 다음 코드를 입력해서 나온 화면 상단에 EUI가 나온다.(예: gateway ID:xxxxxxxxxx)</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">gateway</span> <span class="o">-</span><span class="n">config</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>가이드를 수행하면 게이트웨이가 AWS에 등록된 것을 확인할 수 있다.</p></li>
</ol>
<figure class="align-center" id="id77">
<img alt="게이트웨이가 추가된 모습" src="_images/figure_004105_tec_w1_5.jpg" />
<figcaption>
<p><span class="caption-number">그림 8 </span><span class="caption-text">게이트웨이가 추가된 모습</span><a class="headerlink" href="#id77" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="5">
<li><p><a class="reference external" href="https://docs.aws.amazon.com/iot-wireless/latest/developerguide/what-is-iot-wireless.html">online guide</a> 에서 AWS IoT Core for LoRaWAN - Connecting to AWS IoT Core for LoRaWAN - Onboard your gateways to AWS IoT Core for LoRaWAN - Consider frequency band selection and add necessary IAM role에 들어가 가이드를 수행한다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>게이트웨이 연결 테스트</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK 7248 guide</a> 에 접속한다.</p></li>
<li><p>LoRaWAN Network Server Guide 탭에 들어가 스크롤 하면 Configure the Gateway Device가 보이는데 여기서부터 진행하면 된다.</p></li>
<li><p>가이드를 모두 진행하면 게이트웨이의 connection status가 connected로 바뀐다.</p></li>
</ol>
<figure class="align-center" id="id78">
<img alt="게이트웨이가 연결된 모습" src="_images/figure_004106_tec_w1_6.jpg" />
<figcaption>
<p><span class="caption-number">그림 9 </span><span class="caption-text">게이트웨이가 연결된 모습</span><a class="headerlink" href="#id78" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
<li><dl>
<dt>디바이스 설정</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://www.arduino.cc/en/software?_gl=1*1m5w0yf*_up*MQ..*_ga*OTAwNzY0MjQwLjE3NDA0NjMxMjc.*_ga_NEXN8H46L5*MTc0MDQ2MzEyNy4xLjAuMTc0MDQ2MzEyNy4wLjAuMTY1MDU3Nzc2NA..">Arduino</a> 홈페이지에 접속하여 소프트웨어를 다운받는다.</p></li>
<li><p>설치를 완료했으면 <a class="reference external" href="https://learn.rakwireless.com/hc/en-us/articles/26687371039383-How-To-Perform-Installation-of-Board-Support-Package-in-Arduino-IDE">adding the BSP in Arduino IDE</a> 사이트에 들어가 기본 설정을 마친다.</p></li>
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK 1901 guide</a> 에 들어가서 Quick Start Guide 탭에 Software Configuration and Example 부분을 수행한다.</p></li>
<li><p>시리얼 모니터에 온도와 습도가 출력되는 것을 확인한다.</p></li>
</ol>
<figure class="align-center" id="id79">
<img alt="온도와 습도를 측정하고 시리얼 모니터에 출력" src="_images/figure_004103_tec_w1_3.jpg" />
<figcaption>
<p><span class="caption-number">그림 10 </span><span class="caption-text">온도와 습도를 측정하고 시리얼 모니터에 출력</span><a class="headerlink" href="#id79" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic" start="5">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak4631/quickstart/">RAK 4631 guide</a> 에 접속한다.</p></li>
<li><p>Quick Start Guide 탭에 Connecting RAK4631 to LoRaWAN 항목을 찾아서 과정을 따라한다.</p></li>
<li><dl>
<dt>가이드에 코드를 수정하는 부분이 나오는데 다음 부분들을 수정하고 나머지는 그대로 둔다.</dt><dd><ul class="simple">
<li><p>region</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">LoRaMacRegion_t</span><span class="w"> </span><span class="n">g_CurrentRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LORAMAC_REGION_KR920</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>key</p></li>
</ul>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp"># 3가지 모두 본인이 뭔하는 값으로 수정</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="n">nodeDeviceEUI</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">,</span><span class="w"> </span><span class="mh">0x33</span><span class="p">};</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="n">nodeAppEUI</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">0xB8</span><span class="p">,</span><span class="w"> </span><span class="mh">0x27</span><span class="p">,</span><span class="w"> </span><span class="mh">0xEB</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFF</span><span class="p">,</span><span class="w"> </span><span class="mh">0xFE</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00</span><span class="p">};</span>
<span class="kt">uint8_t</span><span class="w"> </span><span class="n">nodeAppKey</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">,</span><span class="w"> </span><span class="mh">0x88</span><span class="p">};</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>디바이스 등록</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK 7268 guide</a> 에 접속해서 LNS Guide 탭에 들어간다.</p></li>
<li><dl class="simple">
<dt>스크롤을 내려 Add a LoRaWAN Device to AWS IoT 항목을 찾아서 가이드를 수행한다. 이때 다음 설정들은 아래의 설정을 따른다.</dt><dd><ul class="simple">
<li><p>Device Profile에서 MAC version을 1.0.2로 설정</p></li>
<li><p>Add Device - Configure LoRaWAN device에서 OTAA v1.0.x 선택</p></li>
<li><p>DevEUI, Appkey, AppEUI는 아두이노에서 본인이 설정한 값을 입력</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Add Device까지 마무리 했다면 스크롤을 내려 Verifying Operation 항목을 찾아서 lambda function과 Destination Rule을 추가한다.</p></li>
<li><p>모두 완료했으면 IoT Core에 디바이스가 추가된 것을 확인할 수 있다.</p></li>
</ol>
<figure class="align-center" id="id80">
<img alt="디바이스가 등록된 모습" src="_images/figure_004107_tec_w1_7.jpg" />
<figcaption>
<p><span class="caption-number">그림 11 </span><span class="caption-text">디바이스가 등록된 모습</span><a class="headerlink" href="#id80" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>디바이스 통신 테스트</dt><dd><p>게이트웨이와 디바이스 설정을 모두 마치면 디바이스에서 보낸 메세지를 AWS의 MQTT Test client에서 받아볼 수 있다.</p>
<ol class="arabic simple">
<li><p>게이트웨이에서 basic station을 실행한다.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>basicstation/examples/corecell/
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./start-station.sh<span class="w"> </span>—l<span class="w"> </span>./lns-aws
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>디바이스 설정에서 수정한 아두이노 코드를 업로드한다.</p></li>
<li><p>IoT Core에 들어가 Test - MQTT test Client에 들어간다.</p></li>
<li><p>topic filter에 #을 입력하고 구독한다.</p></li>
<li><p>payloadData에 base64로 인코딩된 메세지가 도착한다.</p></li>
<li><p>디코딩 해보면 hello!가 나온다. (아두이노 예제가 hello!를 보내는 예제다.)</p></li>
</ol>
<figure class="align-center" id="id81">
<img alt="메세지를 받은 모습" src="_images/figure_004108_tec_w1_8.jpg" />
<figcaption>
<p><span class="caption-number">그림 12 </span><span class="caption-text">메세지를 받은 모습</span><a class="headerlink" href="#id81" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id82">
<img alt="디코딩 사이트를 통해 메세지 확인" src="_images/figure_004109_tec_w1_9.jpg" />
<figcaption>
<p><span class="caption-number">그림 13 </span><span class="caption-text">디코딩 사이트를 통해 메세지 확인</span><a class="headerlink" href="#id82" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
<li><dl>
<dt>온도와 습도 데이터를 받아서 DynamoDB에 저장하기</dt><dd><ul>
<li><dl>
<dt>아두이노 코드 수정</dt><dd><ol class="arabic simple">
<li><p>온도 습도를 측정하여 시리얼 모니터에 출력하는 예제와 LoRaWAN 예제를 합친다.</p></li>
<li><p>이제는 hello! 가 아닌 온도와 습도데이터를 보내야 하므로 void send_lora_frame(void)를 다음과 같이 수정한다.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 온도와 습도를 문자열로 전송하는 코드</span>
<span class="n">void</span> <span class="n">send_lora_frame</span><span class="p">(</span><span class="n">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">lmh_join_status_get</span><span class="p">()</span> <span class="o">!=</span> <span class="n">LMH_SET</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="o">//</span> <span class="n">Not</span> <span class="n">joined</span><span class="p">,</span> <span class="k">try</span> <span class="n">again</span> <span class="n">later</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">memset</span><span class="p">(</span><span class="n">m_lora_app_data</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LORAWAN_APP_DATA_BUFF_SIZE</span><span class="p">);</span>
  <span class="n">m_lora_app_data</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">gAppPort</span><span class="p">;</span>
  <span class="n">uint32_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="o">//</span><span class="n">온도</span> <span class="n">데이터</span> <span class="n">전송</span>
  <span class="nb">float</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">g_shtc3</span><span class="o">.</span><span class="n">toDegC</span><span class="p">();</span>
  <span class="n">char</span> <span class="n">tem</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="n">sprintf</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">uint8_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tem</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">m_lora_app_data</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">tem</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>  <span class="o">//</span> <span class="n">문자</span> <span class="n">한</span> <span class="n">개씩</span> <span class="n">전송</span>
  <span class="p">}</span>
  <span class="o">//</span><span class="n">구분자</span>
  <span class="n">m_lora_app_data</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="p">;</span>
  <span class="o">//</span><span class="n">습도</span> <span class="n">데이터</span> <span class="n">전송</span>
  <span class="nb">float</span> <span class="n">humi</span> <span class="o">=</span> <span class="n">g_shtc3</span><span class="o">.</span><span class="n">toPercent</span><span class="p">();</span>
  <span class="n">char</span> <span class="nb">str</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="n">sprintf</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">humi</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">uint8_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nb">str</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">m_lora_app_data</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>  <span class="o">//</span> <span class="n">문자</span> <span class="n">한</span> <span class="n">개씩</span> <span class="n">전송</span>
  <span class="p">}</span>

  <span class="n">m_lora_app_data</span><span class="o">.</span><span class="n">buffsize</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>  <span class="o">//</span> <span class="n">데이터</span> <span class="n">크기</span> <span class="n">설정</span>

  <span class="o">//</span> <span class="n">LoRaWAN</span> <span class="n">패킷</span> <span class="n">전송</span>
  <span class="n">lmh_error_status</span> <span class="n">error</span> <span class="o">=</span> <span class="n">lmh_send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_lora_app_data</span><span class="p">,</span> <span class="n">g_CurrentConfirm</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="n">LMH_SUCCESS</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="n">Serial</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;lmh_send ok count </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">count_fail</span><span class="o">++</span><span class="p">;</span>
    <span class="n">Serial</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;lmh_send fail count </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count_fail</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>lambda 설정</dt><dd><p><cite>Formatting a notification by using an AWS Lambda function</cite> 가이드를 참고하며 만든다.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/functions">Lambda console</a> 에 접속하고 Creat function을 선택한다.</p></li>
<li><p>Use a blueprint를 선택한다</p></li>
<li><p>Blueprint name은 Hello world function python 3.10 선택</p></li>
<li><p>Function name은 ()</p></li>
<li><p>Execution role에 Create a new role from AWS policy templates을 선택한다.</p></li>
<li><p>Role name은 ()</p></li>
<li><p>Policy templates - optional 은 공백으로 둔다.</p></li>
<li><p>Create function 선택한다.</p></li>
<li><p>code에 다음을 입력한다.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>

<span class="c1"># AWS IoT Core 클라이언트 설정 (리전에 맞게 변경)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;iot-data&quot;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s2">&quot;us-east-1&quot;</span><span class="p">)</span>  <span class="c1"># 필요하면 리전 변경</span>

<span class="c1"># MQTT 설정 (입력/출력 토픽)</span>
<span class="n">INPUT_TOPIC</span> <span class="o">=</span> <span class="s2">&quot;project/sensor/decoded&quot;</span>   <span class="c1"># 입력 토픽</span>
<span class="n">OUTPUT_TOPIC</span> <span class="o">=</span> <span class="s2">&quot;project/sensor/output&quot;</span>   <span class="c1"># 출력 토픽 (디코딩된 메시지를 전송할 토픽)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received event:&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>  <span class="c1"># 로그 출력</span>

        <span class="c1"># PayloadData 디코딩</span>
        <span class="k">if</span> <span class="s2">&quot;PayloadData&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;PayloadData&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Decoded Payload: </span><span class="si">{</span><span class="n">decoded_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># temperature랑 humidity 분리</span>
            <span class="k">if</span> <span class="s2">&quot;|&quot;</span> <span class="ow">in</span> <span class="n">decoded_payload</span><span class="p">:</span>  <span class="c1"># 구분자가 있을 때만 분리</span>
                <span class="n">temp</span><span class="p">,</span> <span class="n">humi</span> <span class="o">=</span> <span class="n">decoded_payload</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># &#39;|&#39; 구분자로 분리</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;temp: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">, humi: </span><span class="si">{</span><span class="n">humi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 혹시라도 안 될때 긴급조치</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="n">decoded_payload</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># 숫자 &quot;10&quot;</span>
                <span class="n">humi</span> <span class="o">=</span> <span class="n">decoded_payload</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>  <span class="c1"># 나머지 문자열 &quot;:humi&quot;</span>

            <span class="c1"># humidity 뒤에 &quot;%&quot; 추가</span>
            <span class="n">humi</span> <span class="o">=</span> <span class="n">humi</span> <span class="o">+</span> <span class="s2">&quot; %&quot;</span>  <span class="c1"># &quot;%&quot;</span>
            <span class="c1"># temp 뒤에 &quot;def C&quot; 추가</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="s2">&quot; deg C&quot;</span>  <span class="c1"># &quot;deg C&quot;</span>

            <span class="c1"># MQTT에 디코딩된 값 전송</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span>
                <span class="n">topic</span><span class="o">=</span><span class="n">OUTPUT_TOPIC</span><span class="p">,</span>
                <span class="n">qos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">payload</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;temp&quot;</span><span class="p">:</span> <span class="n">temp</span><span class="p">,</span> <span class="s2">&quot;humi&quot;</span><span class="p">:</span> <span class="n">humi</span><span class="p">})</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Published to </span><span class="si">{</span><span class="n">OUTPUT_TOPIC</span><span class="si">}</span><span class="s2">: temp: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">, humi: </span><span class="si">{</span><span class="n">humi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;Message processed and sent!&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
                <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;PayloadData not found in event&quot;</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="10">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/home">IAM console</a> 의 왼쪽 메뉴창에 Policies를 선택한다.</p></li>
<li><p>Create policy를 선택한다.</p></li>
<li><p>JSON을 열고 아래 코드를 붙여넣기한다.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;iot:Publish&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iot:Receive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iot:Subscribe&quot;</span><span class="p">,</span>
                <span class="s2">&quot;iot:Connect&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
                <span class="s2">&quot;logs:PutLogEvents&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="13">
<li><p>Next를 선택한다.</p></li>
<li><p>Policy details에서 policy name ()을 입력한다.</p></li>
<li><p>Create policy 선택</p></li>
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iam/home?region=us-east-1#/home">IAM console</a> 의 왼쪽 메뉴창에 Roles를 선택한다.</p></li>
<li><p>이전에 만든 Lamdafuction에 있는 Role과 동일한 이름의 Role을 선택한다.</p></li>
<li><p>Permissions policies에서 add permissions을 선택 attach policy를 선택한다.</p></li>
<li><p>미리 만들어둔 policy를 체크 박스 선택한 뒤, Add permissions를 선택한다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>DynamoDB 설정</dt><dd><p><a class="reference external" href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-ddb-rule.html">Storing device data in a DynamoDB table</a> 가이드를 참고하며 만든다.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/dynamodbv2/home?region=us-east-1#dashboard">DynamoDB console</a> 에 접속하고 Creat table을 선택한다.</p></li>
<li><p>Table name에 본인이 원하는 이름를 입력한다.</p></li>
<li><p>Partition key에 sample_time을 입력하고 오른쪽에 String 대신 Number를 선택한다.</p></li>
<li><p>Sort key는 건드리지 않는다.</p></li>
<li><p>아래에 Create table을 선택한다.</p></li>
</ol>
<figure class="align-center" id="id83">
<img alt="테이블이 생성된 모습" src="_images/figure_004110_tec_w1_10.jpg" />
<figcaption>
<p><span class="caption-number">그림 14 </span><span class="caption-text">테이블이 생성된 모습</span><a class="headerlink" href="#id83" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="6">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 에 접속해서 Message routing - Rules에 들어간다.</p></li>
<li><p>Create rule을 선택한다.</p></li>
<li><p>Rule name에 본인이 원하는 이름을 입력하고 next를 선택한다.</p></li>
<li><p>SQL version은 2016-03-23을 선택하고 다음 코드를 입력한다.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="n">temp</span><span class="p">,</span> <span class="n">humi</span> <span class="n">FROM</span> <span class="s1">&#39;project/sensor/output&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="10">
<li><p>next를 선택하고, Rule actions - Action 1에 DynamoDB를 선택한다.</p></li>
<li><p>Table name에 본인이 만든 테이블을 선택한다.</p></li>
<li><p>partition key에 sample_time을 입력한다.</p></li>
<li><p>partition key type을 Number로 변경한다.</p></li>
<li><p>partition key value에 ${timestamp()}을 입력한다.</p></li>
<li><p>Write message data to this column에 device_data를 입력한다.</p></li>
<li><p>아래에 IAM role에서 Creat new role을 선택한다.</p></li>
<li><p>Role ame에 본인이 원하는 이름을 입력하고 create를 선택한다.</p></li>
<li><p>next를 선택하고 create를 선택한다.</p></li>
</ol>
<figure class="align-center" id="id84">
<img alt="rule이 추가된 모습" src="_images/figure_004111_tec_w1_11.jpg" />
<figcaption>
<p><span class="caption-number">그림 15 </span><span class="caption-text">rule이 추가된 모습</span><a class="headerlink" href="#id84" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id39">
<h3><strong>결과</strong><a class="headerlink" href="#id39" title="Link to this heading">¶</a></h3>
<ul>
<li><dl class="simple">
<dt>동작흐름</dt><dd><ol class="arabic simple">
<li><p>디바이스가 온도, 습도 데이터를 수집하고 게이트웨이를 통해 mqtt메세지를 보냄</p></li>
<li><p>AWS에서 project/sensor/decoded로 메세지가 들어옴</p></li>
<li><p>lambda function이 project/sensor/decoded topic을 감지하여 메세지를 디코딩하고 project/sensor/output으로 다시 mqtt 메세지를 보냄</p></li>
<li><p>DynamoDB에서 설정해준 rule에 따라 project/sensor/output에서 보낸 온도 습도 데이터를 수집하여 DB에 저장</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>결과 사진</dt><dd><figure class="align-center" id="id85">
<img alt="데이터가 DB에 저장된 모습" src="_images/figure_004112_tec_w1_12.jpg" />
<figcaption>
<p><span class="caption-number">그림 16 </span><span class="caption-text">데이터가 DB에 저장된 모습</span><a class="headerlink" href="#id85" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id86">
<img alt="특정 시간대의 온도와 습도를 확인하는 모습" src="_images/figure_004113_tec_w1_13.jpg" />
<figcaption>
<p><span class="caption-number">그림 17 </span><span class="caption-text">특정 시간대의 온도와 습도를 확인하는 모습</span><a class="headerlink" href="#id86" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>결산</dt><dd><dl class="simple">
<dt>센서로 수집한 온도와 습도 데이터를 게이트웨이를 통해 MQTT메세지로 전달하여 lambda function으로 가공하고 DynamoDB에 저장한다.</dt><dd><p>–&gt; 성공</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>고찰</dt><dd><p>온도 습도 데이터를 그냥 float으로 보내면 디코딩 과정에서 숫자가 아닌 의미 없는 문자열이 나와서 어쩔 수 없이 아두이노에서 실수를 강제로 문자열로 바꿔 보내서 lambda function으로 처리한 부분이 조금 아쉽다. 이 부분을 수정하면 좋을 것 같다.</p>
</dd>
</dl>
</li>
</ul>
<br><hr class="docutils" />
</section>
</section>
<section id="technical-report-004022-rx004-01-result-report-group02">
<span id="id40"></span><h2>연구과제004-01 결과 보고서 02조<a class="headerlink" href="#technical-report-004022-rx004-01-result-report-group02" title="Link to this heading">¶</a></h2>
<section id="id41">
<h3>개요<a class="headerlink" href="#id41" title="Link to this heading">¶</a></h3>
<p>본 보고서는 RAK4630을 디바이스로, RAK7248을 게이트웨이로 등록하여 LoRaWAN을 통해 AWS IoT Core에 연결하고, 수집된 데이터를 MQTT를 통해 DynamoDB에 저장하는 과정에 대한 내용을 다룬다. 기초 설정, 예제 코드 실행, 실전 코드 실행을 포함한 전반적인 과정이 정리되어 있다.</p>
</section>
<hr class="docutils" />
<section id="rak7248">
<h3>RAK7248 사전 준비<a class="headerlink" href="#rak7248" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK7248</a></p>
<ol class="arabic simple">
<li><p>RAK7248의 초기 설정은 AP모드 이므로 노트북으로 게이트웨이에 putty에 RAK7248의 기본 ip인 192.168.230.1로 접근 한다.</p></li>
<li><p>이후 사용자 이름: pi 비밀번호:raspberry를 입력하여 로그인 한 후, sudo gateway-config를 입력하여 게이트웨이 설정으로 이동한다.</p></li>
<li><p>이후 거주 국가를 선택한다. ap모드를 해제한 후 클라이언트 모드로 변경한다. 이후 연결할 와이파이 SSID와 비밀번호를 입력한다.</p></li>
<li><p>이제 와이파이에 연결된 RAK7248의 ip주소를 putty에 입력하면 콘솔에 접근할 수 있다.</p></li>
</ol>
<hr class="docutils" />
<p>aws iot core에 gateway RAK7248 등록</p>
<hr class="docutils" />
<p>LoRaWAN을 위해 AWS IoT Core에 게이트웨이를 등록하려면 다음 단계를 실행하세요.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동합니다.</p></li>
<li><p>왼쪽 탐색 패널에서 LPWAN 장치를 선택하세요.</p></li>
<li><p>게이트웨이를 선택한 다음 게이트웨이 추가를 클릭합니다.</p></li>
<li><p>게이트웨이 추가 섹션 에서 게이트웨이의 EUI 및 주파수 대역(RF 지역) 필드를 입력합니다.</p></li>
<li><p>이름 : 선택 필드 에 설명적 이름을 입력합니다 . 이름으로 GatewayEUI를 사용하는 것이 좋습니다.</p></li>
<li><p>게이트웨이 추가를 클릭합니다.</p></li>
<li><p>게이트웨이 구성 페이지 에서 게이트웨이 인증서 라는 섹션을 찾으세요.</p></li>
<li><p>인증서 만들기를 선택하세요.</p></li>
<li><p>인증서가 생성되어 게이트웨이 메시지와 연결 되면 인증서 파일 다운로드를 선택하여 인증서( xxxxx.cert.pem )와 개인 키( xxxxxx.private.key )를 다운로드합니다.</p></li>
<li><p>자격 증명 프로비저닝 섹션에서 서버 신뢰 인증서 다운로드를 선택하여 CUPS(cups.trust) 및 LNS(lns.trust) 서버 신뢰 인증서를 다운로드합니다.</p></li>
<li><p>CUPS 및 LNS 엔드포인트를 복사하여 .txt게이트웨이를 구성하는 동안 사용할 파일에 저장합니다.</p></li>
<li><p>제출을 선택하여 게이트웨이를 추가합니다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-cupsn"><span class="std std-numref">그림 18</span></a> 인증서 파일들</p>
<figure class="align-center" id="id87">
<span id="figure-005-01-cupsn"></span><a class="reference internal image-reference" href="_images/figure_004136_0205-3.png"><img alt="인증서 파일들" src="_images/figure_004136_0205-3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 18 </span><span class="caption-text">인증서 파일들</span><a class="headerlink" href="#id87" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>게이트웨이 디바이스 구성</p>
<ol class="arabic">
<li><p>LoRaWAN용 AWS IoT Core에 연결하려면 BasicsStation을 다운로드하고 컴파일해야 합니다. SSH를 통해 게이트웨이에 성공적으로 액세스했다고 가정하면 업데이트/업그레이드하는 것이 좋은 정책입니다. 그렇게 하면 모든 패키지가 최신 상태로 유지됩니다:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>upgrade
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>이제 LoRaWAN용 AWS IoT Core에서 게이트웨이를 등록합니다. 게이트웨이를 등록하려면 장치의 EUI가 필요합니다. 게이트웨이의 EUI를 찾으려면 아래 명령을 실행하여 그래픽 사용자 인터페이스(GUI)를 엽니다. EUI는 GUI 상단에서 찾을 수 있습니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>gateway-config
</pre></div>
</div>
<p>또한 다음 명령을 실행하여 게이트웨이 버전을 확인할 수도 있습니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>gateway-version
</pre></div>
</div>
<p>출력 예시:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Raspberry Pi 4 Model B Rev 1.1, OS &quot;10 (buster)&quot;, 5.4.79-v7l+.
RAKwireless gateway RAK7248 no LTE version 4.2.7R install from firmware
Gateway ID: DCA632FFFE366417
</pre></div>
</div>
<p>기본 스테이션(Basics Station) 구성</p>
<ol class="arabic simple" start="3">
<li><p>Basics Station 저장소를 복제하고 다운로드한 폴더로 이동합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/lorabasics/basicstation.git
<span class="nb">cd</span><span class="w"> </span>basicstation
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>모든 종속성을 설치합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="nv">platform</span><span class="o">=</span>corecell<span class="w"> </span><span class="nv">variant</span><span class="o">=</span>std
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>특정 파일을 복사하여 교체합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>cp<span class="w"> </span>-f<span class="w"> </span>/opt/ttn-gateway/sx1302_hal/libloragw/src/loragw_stts751.c<span class="w"> </span>deps/lgw1302/platform-corecell/libloragw/src/loragw_stts751.c
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>빌드를 정리하고 다시 컴파일합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>clean
make<span class="w"> </span><span class="nv">platform</span><span class="o">=</span>corecell<span class="w"> </span><span class="nv">variant</span><span class="o">=</span>std
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>설치가 완료되면 Basics Station 프로토콜을 구성해야 합니다. Semtech에서 제공한 예제가 있는 폴더를 입력하고, 특히 빌드가 SX1302용이므로 corecell 폴더를 입력합니다.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/corecell
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>reset_gw.sh를 수정하여 리셋 핀을 17로 변경하세요 .</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1"># This script is intended to be used on SX1302 CoreCell platform, it performs the following actions:</span>
<span class="c1">#        - export/unexport GPI023 and GPI018 used to reset the SX1302 chip and to enable the LDOs</span>
<span class="c1">#</span>
<span class="c1"># Usage examples:</span>
<span class="c1">#       ./reset_lgw.sh stop</span>
<span class="c1">#       ./reset_lgw.sh start</span>
<span class="c1">#</span>
<span class="c1"># GPIO mapping has to be adopted with HW</span>
<span class="c1">#</span>

<span class="nv">SX1302_RESET_PIN</span><span class="o">=</span><span class="m">17</span>
<span class="nv">SX1302_POWER_EN_PIN</span><span class="o">=</span><span class="m">18</span>

WAIT_GPIO<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">0</span>.1
<span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>LoRaWAN을 위한 AWS IoT Core에 연결하기 위한 기본 스테이션의 모든 구성 파일을 저장할 새 폴더를 만듭니다.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>lns-aws
</pre></div>
</div>
<ol class="arabic simple" start="10">
<li><p>기본 스테이션 구성 파일을 복사합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>lns-ttn/station.conf<span class="w"> </span>lns-aws/
</pre></div>
</div>
<ol class="arabic simple" start="11">
<li><p>이전에 다운로드한 인증서를 추가합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>-all<span class="w"> </span>lns-aws
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-cups12"><span class="std std-numref">그림 19</span></a> cups.trust와 cups.uri</p>
<figure class="align-center" id="id88">
<span id="figure-005-01-cups12"></span><a class="reference internal image-reference" href="_images/figure_004131_0204-1.png"><img alt="cups.trust와 cups.uri" src="_images/figure_004131_0204-1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 19 </span><span class="caption-text">cups.trust와 cups.uri</span><a class="headerlink" href="#id88" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-cups22"><span class="std std-numref">그림 20</span></a> cups.crt와 cups.key</p>
<figure class="align-center" id="id89">
<span id="figure-005-01-cups22"></span><a class="reference internal image-reference" href="_images/figure_004132_0204-2.png"><img alt="cups.crt와 cups.key" src="_images/figure_004132_0204-2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 20 </span><span class="caption-text">cups.crt와 cups.key</span><a class="headerlink" href="#id89" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>출력 예시:
<a class="reference internal" href="#figure-005-01-cups32"><span class="std std-numref">그림 21</span></a></p>
<figure class="align-center" id="id90">
<span id="figure-005-01-cups32"></span><a class="reference internal image-reference" href="_images/figure_004133_0204-3.png"><img alt="모든 설치가 끝난 후의 파일들" src="_images/figure_004133_0204-3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 21 </span><span class="caption-text">모든 설치가 끝난 후의 파일들</span><a class="headerlink" href="#id90" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="12">
<li><p>기본 스테이션을 사용하기 전에 기존 패킷 포워더를 비활성화해야 합니다. 패킷 포워더의 서비스를 편집하려면 다음을 실행합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>edit<span class="w"> </span>ttn-gateway.service
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>The<span class="w"> </span>Things<span class="w"> </span>Network<span class="w"> </span>Gateway

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">WorkingDirectory</span><span class="o">=</span>/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/
<span class="nv">ExecStart</span><span class="o">=</span>/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/start.sh
<span class="nv">SyslogIdentifier</span><span class="o">=</span>ttn-gateway
<span class="nv">Restart</span><span class="o">=</span>no
<span class="nv">RestartSec</span><span class="o">=</span><span class="m">5</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<ol class="arabic simple" start="13">
<li><p>파일에 다음 설정을 추가합니다:</p></li>
</ol>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">The Things Network Gateway</span>

<span class="k">[Service]</span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/start.sh</span>
<span class="na">SyslogIdentifier</span><span class="o">=</span><span class="s">ttn-gateway</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">no</span>
<span class="na">RestartSec</span><span class="o">=</span><span class="s">5</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
<ol class="arabic simple" start="14">
<li><p>변경 사항을 적용하려면 다음 명령을 실행합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>ttn-gateway.service
</pre></div>
</div>
<ol class="arabic simple" start="15">
<li><p>기존 패킷 포워더 프로세스를 종료하려면 다음 명령을 실행합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pi@rak-gateway:~/basicstation/example/corecell/lns-aws<span class="w"> </span>$<span class="w"> </span>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ttn-gateway
</pre></div>
</div>
<ol class="arabic simple" start="16">
<li><p>출력된 프로세스 ID(PID)를 찾아 종료합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>&lt;PID&gt;
</pre></div>
</div>
<ol class="arabic simple" start="17">
<li><p>이제 기본 스테이션을 시작할 수 있습니다. 구성 폴더로 이동한 후 실행합니다:</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>..
./start-station.sh<span class="w"> </span>-l<span class="w"> </span>./lns-aws
</pre></div>
</div>
<p>모든 것이 올바르게 구성되었다면, 게이트웨이는 AWS IoT Core for LoRaWAN 콘솔에서 온라인 상태로 나타나야 합니다.</p>
<p><a class="reference internal" href="#figure-005-01-connected2"><span class="std std-numref">그림 22</span></a> aws iot core에 connected된 화면</p>
<figure class="align-center" id="id91">
<span id="figure-005-01-connected2"></span><a class="reference internal image-reference" href="_images/figure_004134_0204-4.png"><img alt="aws iot core에 connected된 화면" src="_images/figure_004134_0204-4.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 22 </span><span class="caption-text">aws iot core에 connected된 화면</span><a class="headerlink" href="#id91" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="rak4630">
<h3>RAK4630 사전 준비<a class="headerlink" href="#rak4630" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisduo/rak4630-module/quickstart/">RAK4630</a></p>
<ol class="arabic simple">
<li><p>아두이노 IDE를 다운받는다.</p></li>
<li><p>RAK1901을 RAK4630에 부착한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-hard3"><span class="std std-numref">그림 23</span></a> 부착부분</p>
<figure class="align-center" id="id92">
<span id="figure-005-01-hard3"></span><a class="reference internal image-reference" href="_images/figure_004148_hard3.png"><img alt="RAK1901" src="_images/figure_004148_hard3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 23 </span><span class="caption-text">RAK1901</span><a class="headerlink" href="#id92" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="3">
<li><p>Arduino IDE를 연다. 환경 설정으로 간다.</p></li>
<li><p>Arduino Boards 목록에 WisBlock Core를 추가하려면 추가 Board Manager URL을 편집해야 한다.</p></li>
<li><p>이 URL을 복사하여 <a class="reference external" href="https://raw.githubusercontent.com/RAKwireless/RAKwireless-Arduino-BSP-Index/main/package_rakwireless_index">https://raw.githubusercontent.com/RAKwireless/RAKwireless-Arduino-BSP-Index/main/package_rakwireless_index</a>.json그림 에 표시된 대로 필드에 붙여넣는다. 다른 URL이 이미 있는 경우 다음 줄에 추가하기만 하면 된다. URL을 추가한 후 확인을 클릭한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-arduino2"><span class="std std-numref">그림 24</span></a> URL추가하는 부분</p>
<figure class="align-center" id="id93">
<span id="figure-005-01-arduino2"></span><a class="reference internal image-reference" href="_images/figure_004137_Arduino.png"><img alt="URL추가" src="_images/figure_004137_Arduino.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 24 </span><span class="caption-text">URL추가</span><a class="headerlink" href="#id93" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="6">
<li><p>Arduino IDE를 다시 시작한다. 도구 메뉴에서 보드 관리자를 연다.</p></li>
<li><p>그러면 Arduino 보드 목록에 추가할 수 있는 사용 가능한 RAKwireless WisBlock Core 보드가 표시된다. 보유한 WisBlock Core를 선택하고 드롭다운 목록에서 업데이트된 버전을 선택한 다음 설치를 클릭한다. (RAKwireless RUI nRF)</p></li>
</ol>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK1901</a></p>
<ol class="arabic simple">
<li><p>먼저, 자신이 가지고 있는 WisBlock Core를 선택해야 한다. (RAK4630)</p></li>
<li><p>SparkFun SHTC3 라이브러리를 설치한다 .</p></li>
<li><p>올바른 직렬 포트를 선택하고 코드를 업로드할 수 있다.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;SparkFun_SHTC3.h&quot;       //Click here to get the library: http://librarymanager/All#SparkFun_SHTC3</span>

SHTC3<span class="w"> </span>g_shtc3<span class="p">;</span><span class="w">                        </span>//<span class="w"> </span>Declare<span class="w"> </span>an<span class="w"> </span>instance<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>SHTC3<span class="w"> </span>class

void<span class="w"> </span>errorDecoder<span class="o">(</span>SHTC3_Status_TypeDef<span class="w"> </span>message<span class="o">)</span><span class="w">   </span>//<span class="w"> </span>The<span class="w"> </span>errorDecoder<span class="w"> </span><span class="k">function</span><span class="w"> </span>prints<span class="w"> </span><span class="s2">&quot;SHTC3_Status_TypeDef&quot;</span><span class="w"> </span>resultsin<span class="w"> </span>a<span class="w"> </span>human-friendly<span class="w"> </span>way
<span class="o">{</span>
switch<span class="w"> </span><span class="o">(</span>message<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>SHTC3_Status_Nominal:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Nominal&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>SHTC3_Status_Error:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Error&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>SHTC3_Status_CRC_Fail:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;CRC Fail&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span>default:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Unknown return code&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>shtc3_read_data<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>float<span class="w"> </span><span class="nv">Temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>float<span class="w"> </span><span class="nv">Humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>

<span class="w">    </span>g_shtc3.update<span class="o">()</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.lastStatus<span class="w"> </span><span class="o">==</span><span class="w"> </span>SHTC3_Status_Nominal<span class="o">)</span><span class="w"> </span>//<span class="w"> </span>You<span class="w"> </span>can<span class="w"> </span>also<span class="w"> </span>assess<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>last<span class="w"> </span><span class="nb">command</span><span class="w"> </span>by<span class="w"> </span>checking<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;.lastStatus&quot;</span><span class="w"> </span>member<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>object
<span class="w">    </span><span class="o">{</span>

<span class="w">        </span><span class="nv">Temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toDegC<span class="o">()</span><span class="p">;</span><span class="w">                   </span>//<span class="w"> </span>Packing<span class="w"> </span>LoRa<span class="w"> </span>data
<span class="w">        </span><span class="nv">Humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toPercent<span class="o">()</span><span class="p">;</span>

<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;RH = &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.print<span class="o">(</span>g_shtc3.toPercent<span class="o">())</span><span class="p">;</span><span class="w">                </span>//<span class="w"> </span><span class="s2">&quot;toPercent&quot;</span><span class="w"> </span>returns<span class="w"> </span>the<span class="w"> </span>percent<span class="w"> </span>humidity<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>floating<span class="w"> </span>point<span class="w"> </span>number
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;% (checksum: &quot;</span><span class="o">)</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.passRHcrc<span class="o">)</span><span class="w">                               </span>//<span class="w"> </span>Like<span class="w"> </span><span class="s2">&quot;passIDcrc&quot;</span><span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span><span class="w"> </span>when<span class="w"> </span>the<span class="w"> </span>RH<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>sensor<span class="w"> </span><span class="o">(</span>but<span class="w"> </span>not<span class="w"> </span>necessarily<span class="w"> </span>up-to-date<span class="w"> </span><span class="k">in</span><span class="w"> </span>terms<span class="w"> </span>of<span class="w"> </span><span class="nb">time</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;pass&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;fail&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;), T = &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.print<span class="o">(</span>g_shtc3.toDegC<span class="o">())</span><span class="p">;</span><span class="w">                  </span>//<span class="w"> </span><span class="s2">&quot;toDegF&quot;</span><span class="w"> </span>and<span class="w"> </span><span class="s2">&quot;toDegC&quot;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>the<span class="w"> </span>temperature<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>flaoting<span class="w"> </span>point<span class="w"> </span>number<span class="w"> </span><span class="k">in</span><span class="w"> </span>deg<span class="w"> </span>F<span class="w"> </span>and<span class="w"> </span>deg<span class="w"> </span>C<span class="w"> </span>respectively
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot; deg C (checksum: &quot;</span><span class="o">)</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.passTcrc<span class="o">)</span><span class="w">                               </span>//<span class="w"> </span>Like<span class="w"> </span><span class="s2">&quot;passIDcrc&quot;</span><span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span><span class="w"> </span>when<span class="w"> </span>the<span class="w"> </span>T<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>sensor<span class="w"> </span><span class="o">(</span>but<span class="w"> </span>not<span class="w"> </span>necessarily<span class="w"> </span>up-to-date<span class="w"> </span><span class="k">in</span><span class="w"> </span>terms<span class="w"> </span>of<span class="w"> </span><span class="nb">time</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;pass&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;fail&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;)&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Update failed, error: &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>errorDecoder<span class="o">(</span>g_shtc3.lastStatus<span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.println<span class="o">()</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>setup<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>time_t<span class="w"> </span><span class="nv">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>millis<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>Serial.begin<span class="o">(</span><span class="m">115200</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="o">(</span>!Serial<span class="o">)</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span>millis<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>timeout<span class="o">)</span><span class="w"> </span>&lt;<span class="w"> </span><span class="m">5000</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>delay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>Wire.begin<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;shtc3 init&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Beginning sensor. Result = &quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>Most<span class="w"> </span>SHTC3<span class="w"> </span>functions<span class="w"> </span><span class="k">return</span><span class="w"> </span>a<span class="w"> </span>variable<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;SHTC3_Status_TypeDef&quot;</span><span class="w"> </span>to<span class="w"> </span>indicate<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>of<span class="w"> </span>their<span class="w"> </span>execution
<span class="w">    </span>errorDecoder<span class="o">(</span>g_shtc3.begin<span class="o">())</span><span class="p">;</span><span class="w">              </span>//<span class="w"> </span>To<span class="w"> </span>start<span class="w"> </span>the<span class="w"> </span>sensor<span class="w"> </span>you<span class="w"> </span>must<span class="w"> </span>call<span class="w"> </span><span class="s2">&quot;begin()&quot;</span>,<span class="w"> </span>the<span class="w"> </span>default<span class="w"> </span>settings<span class="w"> </span>use<span class="w"> </span>Wire<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>Arduino<span class="w"> </span>I2C<span class="w"> </span>port<span class="o">)</span>
<span class="w">    </span>Wire.setClock<span class="o">(</span><span class="m">400000</span><span class="o">)</span><span class="p">;</span><span class="w">                            </span>//<span class="w"> </span>The<span class="w"> </span>sensor<span class="w"> </span>is<span class="w"> </span>listed<span class="w"> </span>to<span class="w"> </span>work<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span><span class="m">1</span><span class="w"> </span>MHz<span class="w"> </span>I2C<span class="w"> </span>speed,<span class="w"> </span>but<span class="w"> </span>the<span class="w"> </span>I2C<span class="w"> </span>clock<span class="w"> </span>speed<span class="w"> </span>is<span class="w"> </span>global<span class="w"> </span><span class="k">for</span><span class="w"> </span>all<span class="w"> </span>sensors<span class="w"> </span>on<span class="w"> </span>that<span class="w"> </span>bus<span class="w"> </span>so<span class="w"> </span>using<span class="w"> </span>400kHz<span class="w"> </span>or<span class="w"> </span>100kHz<span class="w"> </span>is<span class="w"> </span>recommended
<span class="w">    </span>Serial.println<span class="o">()</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.passIDcrc<span class="o">)</span><span class="w">                      </span>//<span class="w"> </span>Whenever<span class="w"> </span>data<span class="w"> </span>is<span class="w"> </span>received<span class="w"> </span>the<span class="w"> </span>associated<span class="w"> </span>checksum<span class="w"> </span>is<span class="w"> </span>calculated<span class="w"> </span>and<span class="w"> </span>verified<span class="w"> </span>so<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>sure<span class="w"> </span>the<span class="w"> </span>data<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="o">{</span><span class="w">                                                        </span>//<span class="w"> </span>The<span class="w"> </span>checksum<span class="w"> </span>pass<span class="w"> </span>indicators<span class="w"> </span>are:<span class="w"> </span>passIDcrc,<span class="w"> </span>passRHcrc,<span class="w"> </span>and<span class="w"> </span>passTcrc<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>ID,<span class="w"> </span>RH,<span class="w"> </span>and<span class="w"> </span>T<span class="w"> </span>readings<span class="w"> </span>respectively
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;ID Passed Checksum. &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;Device ID: 0b&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.println<span class="o">(</span>g_shtc3.ID,<span class="w"> </span>BIN<span class="o">)</span><span class="p">;</span><span class="w">             </span>//<span class="w"> </span>The<span class="w"> </span><span class="m">16</span>-bit<span class="w"> </span>device<span class="w"> </span>ID<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>accessed<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>member<span class="w"> </span>variable<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>object
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;ID Checksum Failed. &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>loop<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>shtc3_read_data<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>delay<span class="o">(</span><span class="m">1000</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-exam2"><span class="std std-numref">그림 25</span></a> 온,습도 예제 업로드 결과​</p>
<figure class="align-center" id="id94">
<span id="figure-005-01-exam2"></span><a class="reference internal image-reference" href="_images/figure_004145_exam.png"><img alt="실행결과" src="_images/figure_004145_exam.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 25 </span><span class="caption-text">실행결과</span><a class="headerlink" href="#id94" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>aws iot core에 디바이스 프로필 추가</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동한다. 탐색 창에서 LPWAN devices(LPWAN 디바이스)를 선택한 다음 Profiles(프로필)를 클릭한다.</p></li>
<li><p>Device Profiles(디바이스 프로필)추가를 클릭하고 매개변수를 설정한다.</p></li>
<li><p>Add service profile(서비스 프로필 추가)을 클릭하고 필요에 따라 매개 변수를 설정한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-device12"><span class="std std-numref">그림 26</span></a> 디바이스 프로필 추가한 모습​</p>
<figure class="align-center" id="id95">
<span id="figure-005-01-device12"></span><a class="reference internal image-reference" href="_images/figure_004139_Device1.png"><img alt="디바이스프로필" src="_images/figure_004139_Device1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 26 </span><span class="caption-text">디바이스프로필</span><a class="headerlink" href="#id95" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-device22"><span class="std std-numref">그림 27</span></a> 서비스 프로필 추가한 모습​</p>
<figure class="align-center" id="id96">
<span id="figure-005-01-device22"></span><a class="reference internal image-reference" href="_images/figure_004140_Device2.png"><img alt="서비스프로필" src="_images/figure_004140_Device2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 27 </span><span class="caption-text">서비스프로필</span><a class="headerlink" href="#id96" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>대상에 IAM 역할 추가</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동한다. 탐색 창에서 정책(Policies)을 선택한다.</p></li>
<li><p>[Create Policy]를 선택한 다음 [JSON] 탭을 선택하여 정책 편집기를 연다. 기존 템플릿을 다음 신뢰 정책 문서로 바꾼다.</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;iot:DescribeEndpoint&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;iot:Publish&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>다음을 클릭하고 Review and create(검토 및 만들기) 페이지에서 선택한다. 이름에 원하는 이름을 입력한다.</p></li>
<li><p>[Description]에 원하는 설명을 입력한다.</p></li>
<li><p>정책 생성을 선택한다. 정책이 생성되었음을 나타내는 확인 메시지가 표시된다.</p></li>
</ol>
<p>(역할 생성)</p>
<ol class="arabic simple" start="6">
<li><p>탐색 창에서 [Roles]를 선택하여 [Roles] 페이지를 연다.</p></li>
<li><p>[Create Role]을 선택한다.</p></li>
<li><p>[Create Role] 페이지에서 [AWS account] &gt; [Another AWS account]를 선택한다.</p></li>
<li><p>계정 ID를 입력하고 다음을 선택한다.</p></li>
<li><p>검색 창에 정책 이름을 입력하여 방금 생성한 IAM 정책을 검색한다.</p></li>
<li><p>검색 결과에서 정책에 해당하는 확인란을 선택한다. 다음을 클릭한다.</p></li>
<li><p>[Role name]에 원하는 적절한 이름을 입력한다.</p></li>
<li><p>[Description]에 원하는 설명을 입력한다.</p></li>
<li><p>[Create role]을 선택한다. 역할이 생성되었음을 나타내는 확인 메시지가 표시된다.</p></li>
</ol>
<p>(신뢰정책 업데이트)</p>
<ol class="arabic simple" start="15">
<li><p>탐색 창에서 [Roles]를 선택하여 [Roles] 페이지를 연다.</p></li>
<li><p>검색 창에서 이전에 생성한 역할의 이름을 입력하고 검색 결과에서 역할 이름을 클릭한다. 그러면 요약 페이지가 열린다.</p></li>
<li><p>신뢰 관계(Trust relationships) 탭을 선택하여 신뢰 관계(Trust relationships) 페이지로 이동한다.</p></li>
<li><p>신뢰 정책 편집을 클릭한다. 신뢰 정책 문서의 보안 주체 AWS 역할은 기본적으로 root로 설정되며 변경해야 한다. 기존 정책을 다음으로 바꾼다.</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;Service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iotwireless.amazonaws.com&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="19">
<li><p>정책 업데이트를 선택한다.</p></li>
</ol>
<p>대상 설정</p>
<ol class="arabic simple">
<li><p>탐색 창에서 LPWAN 디바이스(LPWAN devices)를 선택한 다음 대상(Destinations)을 선택한다.</p></li>
<li><p>[Add Destination]을 선택한다.</p></li>
<li><p>대상 이름에 ProcessLoRa를 입력한 다음 대상 설명 - 선택 사항 아래에 적절한 설명을 추가한다.</p></li>
<li><p>규칙 이름에 LoRaWANRouting을 입력한다. 규칙 구성 – 지금은 선택 사항 섹션을 무시한다.</p></li>
<li><p>[Permissions] 섹션에서 [Select an existing service role]을 선택하고 드롭다운에서 이전에 생성한 IAM 역할을 선택한다.</p></li>
<li><p>[Add Destination]을 선택한다. 대상이 성공적으로 추가되었음을 나타내는 “Destination added(대상이 추가됨)” 메시지가 표시된다.</p></li>
</ol>
<p>대상 규칙</p>
<ol class="arabic">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동한다.</p></li>
<li><p>탐색 창에서 메시지 라우팅(Message routing)을 선택한 다음 규칙(Rules)을 선택한다.</p></li>
<li><p>규칙(Rules) 페이지에서 규칙 생성(Create rule)을 선택한다.</p></li>
<li><dl>
<dt>Create a rule(규칙 생성) 페이지에서 다음과 같이 입력한다.</dt><dd><p>이름: LoRaWANRouting</p>
<p>설명: 선택한 설명입니다.</p>
</dd>
</dl>
</li>
<li><p>기본 규칙 쿼리 문인 ‘SELECT * FROM ‘iot/topic’을 변경하지 않고 그대로 둔다. 이 쿼리는 현재 트래픽이 대상에 따라 규칙 엔진으로 전달되므로 현재 적용되지 않는다. 다음을 클릭한다.</p></li>
<li><p>[Attach rule actions] 페이지에서 [Republish to AWS IoT topic]을 선택한다.</p></li>
<li><p>[Topic]에 project/sensor/decoded를 입력합니다. AWS IoT 규칙 엔진은 이 주제로 메시지를 전달한다.</p></li>
<li><p>IAM 역할에서 새 역할 만들기를 선택한다.</p></li>
<li><p>이름에 원하는 이름을 입력한다. 만들기를 클릭한다.</p></li>
<li><p>그런 다음 [Create]를 선택한다.</p></li>
<li><p>“성공” 메시지가 패널 맨 위에 표시되고 대상에는 규칙이 바인딩되어있다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-device33"><span class="std std-numref">그림 28</span></a> ProcessLoRa 대상이 설정된 모습</p>
<figure class="align-center" id="id97">
<span id="figure-005-01-device33"></span><a class="reference internal image-reference" href="_images/figure_004141_Device33.png"><img alt="ProcessLoRa" src="_images/figure_004141_Device33.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 28 </span><span class="caption-text">ProcessLoRa</span><a class="headerlink" href="#id97" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>장치 등록</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동한다.</p></li>
<li><p>왼쪽의 탐색 패널에서 LPWAN 장치를 선택한다.</p></li>
<li><p>Devices(장치)를 선택한 다음 Add wireless device(무선 장치 추가)를 선택한다.</p></li>
<li><p>Add device(디바이스 추가) 페이지의 Wireless device specification(무선 디바이스 사양) 아래의 드롭다운에서 LoRaWAN 사양 버전을 선택한다.</p></li>
<li><p>LoRaWAN 사양 및 무선 디바이스 구성에서 DevEUI를 입력한다.</p></li>
<li><p>위에서 선택한 OTAA/ABP에 따라 나머지 필드를 입력한다.</p></li>
<li><p>Wireless device name – optional 필드에 장치 이름을 입력한다.</p></li>
<li><p>프로필 섹션의 무선 장치 프로필 아래에 있는 드롭다운 옵션에서 만든 장치 프로필 또는 장치 및 지역에 해당하는 장치 프로필을 찾는다.</p></li>
<li><p>Choose destination(대상 선택) 아래의 드롭다운에서 이전에 생성한 대상(ProcessLoRa)을 선택한다.</p></li>
<li><p>다음을 클릭한다.</p></li>
<li><p>장치 추가를 선택한다. “무선 장치가 추가됨”이라는 메시지가 표시되어 장치가 성공적으로 설정되었음을 나타낸다.</p></li>
<li><p>최종 디바이스를 다시 시작하면 AWS IoT LoRaWAN 서버에 조인된다.</p></li>
<li><p>MQTT로 HELLOW!를 인코딩해서 보내는데 성공​</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="dynamodb">
<h3>dynamoDB 예제 코드 시행<a class="headerlink" href="#dynamodb" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-ddb-rule.html">DynamoDB 자습서</a>
를 수행하여 DynamoDB가 무엇인지와 사용하는 방법을 공부하였다.</p>
<p>DynamoDB 테이블 생성</p>
<p>AWS IoT Core에서 데이터를 저장할 DynamoDB 테이블을 생성한다.</p>
<ol class="arabic">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/pm/dynamodb/">DynamoDB 콘솔</a> 에 접속한다.</p></li>
<li><p>새 테이블 생성(Create Table) 을 선택한다.</p></li>
<li><p>테이블 키 구성:</p>
<blockquote>
<div><p>Partition Key: sample_time (String)</p>
<p>Sort Key: device_id (String)</p>
<p>속성 추가: device_data (String)</p>
</div></blockquote>
</li>
<li><p>생성 완료 후, AWS IoT Core에서 데이터를 저장할 수 있도록 IAM 역할 및 정책을 설정한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-dynamo-db12"><span class="std std-numref">그림 29</span></a> DynamoDB 테이블 생성</p>
<figure class="align-center" id="id98">
<span id="figure-005-01-dynamo-db12"></span><a class="reference internal image-reference" href="_images/figure_004142_DynamoDB1.png"><img alt="DynamoDB테이블" src="_images/figure_004142_DynamoDB1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 29 </span><span class="caption-text">DynamoDB테이블</span><a class="headerlink" href="#id98" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>AWS IoT Core에서 수신한 MQTT 메시지를 DynamoDB에 저장하는 규칙을 생성한다.</p>
<ol class="arabic">
<li><p>AWS IoT 콘솔에서 메시지 라우팅 &gt; 규칙(Rules) 로 이동한다.</p></li>
<li><p>규칙 생성(Create Rule) 을 선택한다.</p></li>
<li><p>규칙 세부 정보 입력:</p>
<blockquote>
<div><p>Rule Name: IoTToDynamoDB
SQL Statement:</p>
</div></blockquote>
</li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">sample_time</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">device_data</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;iot/sensor/data&#39;</span>
</pre></div>
</div>
<ol class="arabic" start="4">
<li><p>Set actions 단계에서 DynamoDBv2 를 선택하고, 다음을 입력한다:</p>
<blockquote>
<div><p>Table Name: 생성한 DynamoDB 테이블 선택
Hash Key: sample_time → ${sample_time}
Sort Key: device_id → ${device_id}</p>
</div></blockquote>
</li>
</ol>
<p>IAM Role: AWS IoT Core가 DynamoDB에 데이터를 삽입할 수 있도록 설정한 IAM 역할 적용</p>
<p><a class="reference internal" href="#figure-005-01-dynamo-db22"><span class="std std-numref">그림 30</span></a> DynamoDB에 데이터를 전송하는 AWS IoT 규칙 생성​</p>
<figure class="align-center" id="id99">
<span id="figure-005-01-dynamo-db22"></span><a class="reference internal image-reference" href="_images/figure_004143_DynamoDB2.png"><img alt="규칙생성" src="_images/figure_004143_DynamoDB2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 30 </span><span class="caption-text">규칙생성</span><a class="headerlink" href="#id99" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-dynamo-db32"><span class="std std-numref">그림 31</span></a> DynamoDB 테이블 테스트</p>
<p>AWS IoT Core에서 DynamoDB로 데이터가 정상적으로 저장되는지 테스트한다.</p>
<ol class="arabic simple">
<li><p>AWS IoT 콘솔에서 MQTT Test 클라이언트 를 실행한다.</p></li>
<li><p>다음과 같은 JSON 메시지를 iot/sensor/data 주제로 게시한다:</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;sample_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-02-27T12:00:00Z&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;device_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sensor_001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;device_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;temperature:22.5,humidity:60&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>DynamoDB 콘솔에서 해당 테이블을 조회하고 데이터가 정상적으로 저장되었는지 확인한다.</p></li>
</ol>
<figure class="align-center" id="id100">
<span id="figure-005-01-dynamo-db32"></span><a class="reference internal image-reference" href="_images/figure_004144_DynamoDB3.png"><img alt="실행결과" src="_images/figure_004144_DynamoDB3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 31 </span><span class="caption-text">실행결과</span><a class="headerlink" href="#id100" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="lambda">
<h3>Lambda 함수 예제 코드 시행<a class="headerlink" href="#lambda" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/getting-started.html">Lambda 함수 생성</a> 여기서 예제를 수행하여 Lambda함수를 사용하는 법을 공부.</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/lambda/">Lambda 콘솔</a> 의 함수 페이지를 연다.</p></li>
<li><p>함수 생성을 선택한다.</p></li>
<li><p>새로 작성을 선택한다.</p></li>
<li><p>기본 정보 창의 함수 이름에 myLambdaFunction을 입력한다.</p></li>
<li><p>런타임에서 Python 3.13을 선택한다.</p></li>
<li><p>아키텍처를 x86_64로 설정된 상태로 두고 함수 생성을 선택한다.</p></li>
<li><p>아래 코드를 넣는다.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span>const<span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>async<span class="w"> </span><span class="o">(</span>event,<span class="w"> </span>context<span class="o">)</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>

const<span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>event.length<span class="p">;</span>
const<span class="w"> </span><span class="nv">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>event.width<span class="p">;</span>
<span class="nb">let</span><span class="w"> </span><span class="nv">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>calculateArea<span class="o">(</span>length,<span class="w"> </span>width<span class="o">)</span><span class="p">;</span>
console.log<span class="o">(</span><span class="sb">`</span>The<span class="w"> </span>area<span class="w"> </span>is<span class="w"> </span><span class="si">${</span><span class="nv">area</span><span class="si">}</span><span class="sb">`</span><span class="o">)</span><span class="p">;</span>

console.log<span class="o">(</span><span class="s1">&#39;CloudWatch log group: &#39;</span>,<span class="w"> </span>context.logGroupName<span class="o">)</span><span class="p">;</span>

<span class="nb">let</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;area&quot;</span>:<span class="w"> </span>area,
<span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>JSON.stringify<span class="o">(</span>data<span class="o">)</span><span class="p">;</span>

<span class="k">function</span><span class="w"> </span>calculateArea<span class="o">(</span>length,<span class="w"> </span>width<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>length<span class="w"> </span>*<span class="w"> </span>width<span class="p">;</span>
<span class="o">}</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-lambda12"><span class="std std-numref">그림 32</span></a> 람다함수를 생성하여 예제코드를 넣은 모습</p>
<figure class="align-center" id="id101">
<span id="figure-005-01-lambda12"></span><a class="reference internal image-reference" href="_images/figure_004149_Lambda1.png"><img alt="Lambda예제코드" src="_images/figure_004149_Lambda1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 32 </span><span class="caption-text">Lambda예제코드</span><a class="headerlink" href="#id101" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="8">
<li><p>Deploy 섹션에서 Deploy를 선택하여 함수의 코드를 업데이트한다.</p></li>
<li><p>콘솔 코드 편집기의 테스트 이벤트 섹션에서 테스트 이벤트 생성을 선택한다.</p></li>
<li><p>Event Name(이벤트 이름)에 myTestEvent를 입력한다.</p></li>
<li><p>이벤트 JSON 섹션에서 기본 JSON을 다음으로 바꾼다.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">7</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-lambda22"><span class="std std-numref">그림 33</span></a> 함수에 전송할 테스트 이벤트​</p>
<figure class="align-center" id="id102">
<span id="figure-005-01-lambda22"></span><a class="reference internal image-reference" href="_images/figure_004150_Lambda2.png"><img alt="Lambda테스트이벤트" src="_images/figure_004150_Lambda2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 33 </span><span class="caption-text">Lambda테스트이벤트</span><a class="headerlink" href="#id102" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="12">
<li><p>콘솔 코드 편집기의 테스트 이벤트 섹션에서 테스트 이벤트 옆에 있는 실행 아이콘을 선택한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-lambda32"><span class="std std-numref">그림 34</span></a> 실행결과 화면</p>
<figure class="align-center" id="id103">
<span id="figure-005-01-lambda32"></span><a class="reference internal image-reference" href="_images/figure_004151_Lambda3.png"><img alt="실행결과" src="_images/figure_004151_Lambda3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 34 </span><span class="caption-text">실행결과</span><a class="headerlink" href="#id103" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="13">
<li><p>CloudWatch 콘솔에서 로그 그룹 페이지를 연다.</p></li>
<li><p>함수에 대한 로그 그룹(/aws/lambda/myLambdaFunction)을 선택한다. 이는 함수가 콘솔에 인쇄한 로그 그룹 이름이다.</p></li>
<li><p>아래로 스크롤하고 확인하고자 하는 함수 간접 호출의 로그 스트림을 선택한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-lambda42"><span class="std std-numref">그림 35</span></a> CloudWatch Logs에서 함수의 간접 호출 레코드 보기​</p>
<figure class="align-center" id="id104">
<span id="figure-005-01-lambda42"></span><a class="reference internal image-reference" href="_images/figure_004152_Lambda4.png"><img alt="CloudWatch Logs" src="_images/figure_004152_Lambda4.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 35 </span><span class="caption-text">CloudWatch Logs</span><a class="headerlink" href="#id104" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="lorawan">
<h3>LoRaWAN으로 온, 습도값 보내기<a class="headerlink" href="#lorawan" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>아두이노 IDE를 연다.</p></li>
<li><p>RAK WisBlock RUI 예제 에서 OTAA_ABP예제 코드를 연다.</p></li>
<li><p>아래 예제로 코드를 바꾼후 업로드 한다. (nodeDeviceEUI, nodeAppEUI, nodeAppKey, 주파수를 본인꺼에 맞게 바꾼다.)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;Arduino.h&gt;</span>
<span class="c1">#include &lt;LoRaWan-RAK4630.h&gt; //http://librarymanager/All#SX126x</span>
<span class="c1">#include &lt;SPI.h&gt;</span>

//<span class="w"> </span>RAK4630<span class="w"> </span>supply<span class="w"> </span>two<span class="w"> </span>LED
<span class="c1">#ifndef LED_BUILTIN</span>
<span class="c1">#define LED_BUILTIN 35</span>
<span class="c1">#endif</span>

<span class="c1">#ifndef LED_BUILTIN2</span>
<span class="c1">#define LED_BUILTIN2 36</span>
<span class="c1">#endif</span>

//<span class="w"> </span>마지막으로<span class="w"> </span>센서를<span class="w"> </span>읽은<span class="w"> </span>시간
unsigned<span class="w"> </span>long<span class="w"> </span><span class="nv">lastSensorReadTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
const<span class="w"> </span>unsigned<span class="w"> </span>long<span class="w"> </span><span class="nv">sensorReadInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>10초마다<span class="w"> </span>읽기
float<span class="w"> </span><span class="nv">lastTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0<span class="p">;</span>
float<span class="w"> </span><span class="nv">lastHumidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0<span class="p">;</span>




<span class="c1">#include &quot;SparkFun_SHTC3.h&quot;       //Click here to get the library: http://librarymanager/All#SparkFun_SHTC3</span>
SHTC3<span class="w"> </span>g_shtc3<span class="p">;</span>
<span class="w">                        </span>//<span class="w"> </span>Declare<span class="w"> </span>an<span class="w"> </span>instance<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>SHTC3<span class="w"> </span>class


bool<span class="w"> </span><span class="nv">doOTAA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>true<span class="p">;</span><span class="w">   </span>//<span class="w"> </span>OTAA<span class="w"> </span>is<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>default.
<span class="c1">#define SCHED_MAX_EVENT_DATA_SIZE APP_TIMER_SCHED_EVENT_DATA_SIZE /**&lt; Maximum size of scheduler events. */</span>
<span class="c1">#define SCHED_QUEUE_SIZE 60                                /**&lt; Maximum number of events in the scheduler queue. */</span>
<span class="c1">#define LORAWAN_DATERATE DR_0                             /*LoRaMac datarates definition, from DR_0 to DR_5*/</span>
<span class="c1">#define LORAWAN_TX_POWER TX_POWER_5                     /*LoRaMac tx power definition, from TX_POWER_0 to TX_POWER_15*/</span>
<span class="c1">#define JOINREQ_NBTRIALS 3                                /**&lt; Number of trials for the join request. */</span>
DeviceClass_t<span class="w"> </span><span class="nv">g_CurrentClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CLASS_A<span class="p">;</span><span class="w">               </span>/*<span class="w"> </span>class<span class="w"> </span>definition*/
LoRaMacRegion_t<span class="w"> </span><span class="nv">g_CurrentRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LORAMAC_REGION_KR920<span class="p">;</span><span class="w">    </span>/*<span class="w"> </span>Region:EU868*/
lmh_confirm<span class="w"> </span><span class="nv">g_CurrentConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LMH_UNCONFIRMED_MSG<span class="p">;</span><span class="w">              </span>/*<span class="w"> </span>confirm/unconfirm<span class="w"> </span>packet<span class="w"> </span>definition*/
uint8_t<span class="w"> </span><span class="nv">gAppPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LORAWAN_APP_PORT<span class="p">;</span><span class="w">                             </span>/*<span class="w"> </span>data<span class="w"> </span>port*/

/**@brief<span class="w"> </span>Structure<span class="w"> </span>containing<span class="w"> </span>LoRaWan<span class="w"> </span>parameters,<span class="w"> </span>needed<span class="w"> </span><span class="k">for</span><span class="w"> </span>lmh_init<span class="o">()</span>
*/
static<span class="w"> </span>lmh_param_t<span class="w"> </span><span class="nv">g_lora_param_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>LORAWAN_ADR_ON,<span class="w"> </span>LORAWAN_DATERATE,<span class="w"> </span>LORAWAN_PUBLIC_NETWORK,<span class="w"> </span>JOINREQ_NBTRIALS,<span class="w"> </span>LORAWAN_TX_POWER,<span class="w"> </span>LORAWAN_DUTYCYCLE_OFF<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>Foward<span class="w"> </span>declaration
static<span class="w"> </span>void<span class="w"> </span>lorawan_has_joined_handler<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>lorawan_join_failed_handler<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>lorawan_rx_handler<span class="o">(</span>lmh_app_data_t<span class="w"> </span>*app_data<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>lorawan_confirm_class_handler<span class="o">(</span>DeviceClass_t<span class="w"> </span>Class<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>send_lora_frame<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>

/**@brief<span class="w"> </span>Structure<span class="w"> </span>containing<span class="w"> </span>LoRaWan<span class="w"> </span>callback<span class="w"> </span>functions,<span class="w"> </span>needed<span class="w"> </span><span class="k">for</span><span class="w"> </span>lmh_init<span class="o">()</span>
*/
static<span class="w"> </span>lmh_callback_t<span class="w"> </span><span class="nv">g_lora_callbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>BoardGetBatteryLevel,<span class="w"> </span>BoardGetUniqueId,<span class="w"> </span>BoardGetRandomSeed,
<span class="w">                                        </span>lorawan_rx_handler,<span class="w"> </span>lorawan_has_joined_handler,<span class="w"> </span>lorawan_confirm_class_handler,<span class="w"> </span>lorawan_join_failed_handler
<span class="w">                                    </span><span class="o">}</span><span class="p">;</span>
//OTAA<span class="w"> </span>keys<span class="w"> </span>!!!!<span class="w"> </span>KEYS<span class="w"> </span>ARE<span class="w"> </span>MSB<span class="w"> </span>!!!!
uint8_t<span class="w"> </span>nodeDeviceEUI<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x32,<span class="w"> </span>0x39<span class="o">}</span><span class="p">;</span>
uint8_t<span class="w"> </span>nodeAppEUI<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0xB8,<span class="w"> </span>0x27,<span class="w"> </span>0xEB,<span class="w"> </span>0xFF,<span class="w"> </span>0xFE,<span class="w"> </span>0x39,<span class="w"> </span>0x12,<span class="w"> </span>0x00<span class="o">}</span><span class="p">;</span>
uint8_t<span class="w"> </span>nodeAppKey<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x88,<span class="w"> </span>0x38,<span class="w"> </span>0x57,<span class="w"> </span>0x86,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>ABP<span class="w"> </span>keys
uint32_t<span class="w"> </span><span class="nv">nodeDevAddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x260116F8<span class="p">;</span>
uint8_t<span class="w"> </span>nodeNwsKey<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x7E,<span class="w"> </span>0xAC,<span class="w"> </span>0xE2,<span class="w"> </span>0x55,<span class="w"> </span>0xB8,<span class="w"> </span>0xA5,<span class="w"> </span>0xE2,<span class="w"> </span>0x69,<span class="w"> </span>0x91,<span class="w"> </span>0x51,<span class="w"> </span>0x96,<span class="w"> </span>0x06,<span class="w"> </span>0x47,<span class="w"> </span>0x56,<span class="w"> </span>0x9D,<span class="w"> </span>0x23<span class="o">}</span><span class="p">;</span>
uint8_t<span class="w"> </span>nodeAppsKey<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0xFB,<span class="w"> </span>0xAC,<span class="w"> </span>0xB6,<span class="w"> </span>0x47,<span class="w"> </span>0xF3,<span class="w"> </span>0x58,<span class="w"> </span>0x45,<span class="w"> </span>0xC7,<span class="w"> </span>0x50,<span class="w"> </span>0x7D,<span class="w"> </span>0xBF,<span class="w"> </span>0x16,<span class="w"> </span>0x8B,<span class="w"> </span>0xA8,<span class="w"> </span>0xC1,<span class="w"> </span>0x7C<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>Private<span class="w"> </span>defination
<span class="c1">#define LORAWAN_APP_DATA_BUFF_SIZE 64                     /**&lt; buffer size of the data to be transmitted. */</span>
<span class="c1">#define LORAWAN_APP_INTERVAL 20000                        /**&lt; Defines for user timer, the application data transmission interval. 20s, value in [ms]. */</span>
static<span class="w"> </span>uint8_t<span class="w"> </span>m_lora_app_data_buffer<span class="o">[</span>LORAWAN_APP_DATA_BUFF_SIZE<span class="o">]</span><span class="p">;</span><span class="w">            </span>//&lt;<span class="w"> </span>Lora<span class="w"> </span>user<span class="w"> </span>application<span class="w"> </span>data<span class="w"> </span>buffer.
static<span class="w"> </span>lmh_app_data_t<span class="w"> </span><span class="nv">m_lora_app_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>m_lora_app_data_buffer,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">}</span><span class="p">;</span><span class="w"> </span>//&lt;<span class="w"> </span>Lora<span class="w"> </span>user<span class="w"> </span>application<span class="w"> </span>data<span class="w"> </span>structure.

TimerEvent_t<span class="w"> </span>appTimer<span class="p">;</span>
static<span class="w"> </span>uint32_t<span class="w"> </span>timers_init<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>uint32_t<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
static<span class="w"> </span>uint32_t<span class="w"> </span><span class="nv">count_fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>

void<span class="w"> </span>setup<span class="o">()</span>
<span class="o">{</span>

pinMode<span class="o">(</span>LED_BUILTIN,<span class="w"> </span>OUTPUT<span class="o">)</span><span class="p">;</span>
digitalWrite<span class="o">(</span>LED_BUILTIN,<span class="w"> </span>LOW<span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>Initialize<span class="w"> </span>Serial<span class="w"> </span><span class="k">for</span><span class="w"> </span>debug<span class="w"> </span>output
time_t<span class="w"> </span><span class="nv">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>millis<span class="o">()</span><span class="p">;</span>
Serial.begin<span class="o">(</span><span class="m">115200</span><span class="o">)</span><span class="p">;</span>
Wire.begin<span class="o">()</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>I2C<span class="w"> </span>초기화는<span class="w"> </span>setup<span class="o">()</span>에서<span class="w"> </span>한<span class="w"> </span>번만<span class="w"> </span>실행
Wire.setClock<span class="o">(</span><span class="m">400000</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>I2C<span class="w"> </span>속도<span class="w"> </span>설정
Wire.setTimeout<span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="p">;</span>

g_shtc3.begin<span class="o">()</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.lastStatus<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>SHTC3_Status_Nominal<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;⚠️ 센서 초기화 실패!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;✅ 센서 정상 연결됨!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="k">while</span><span class="w"> </span><span class="o">(</span>!Serial<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span>millis<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>timeout<span class="o">)</span><span class="w"> </span>&lt;<span class="w"> </span><span class="m">5000</span><span class="o">)</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">    </span>delay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

//<span class="w"> </span>Initialize<span class="w"> </span>LoRa<span class="w"> </span>chip.
lora_rak4630_init<span class="o">()</span><span class="p">;</span>

Serial.println<span class="o">(</span><span class="s2">&quot;=====================================&quot;</span><span class="o">)</span><span class="p">;</span>
Serial.println<span class="o">(</span><span class="s2">&quot;Welcome to RAK4630 LoRaWan!!!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>doOTAA<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Type: OTAA&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Type: ABP&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

switch<span class="w"> </span><span class="o">(</span>g_CurrentRegion<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AU915:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AU915&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_CN470:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: CN470&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_CN779:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: CN779&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_EU433:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: EU433&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_IN865:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: IN865&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_EU868:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: EU868&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_KR920:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: KR920&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_US915:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: US915&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_RU864:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: RU864&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923_2:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923-2&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923_3:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923-3&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923_4:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923-4&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="o">}</span>
Serial.println<span class="o">(</span><span class="s2">&quot;=====================================&quot;</span><span class="o">)</span><span class="p">;</span>

//creat<span class="w"> </span>a<span class="w"> </span>user<span class="w"> </span>timer<span class="w"> </span>to<span class="w"> </span>send<span class="w"> </span>data<span class="w"> </span>to<span class="w"> </span>server<span class="w"> </span>period
Serial.println<span class="o">(</span><span class="s2">&quot;타이머 초기화 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
uint32_t<span class="w"> </span>err_code<span class="p">;</span>
<span class="nv">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>timers_init<span class="o">()</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>err_code<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;timers_init failed - %d\n&quot;</span>,<span class="w"> </span>err_code<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="o">}</span>
Serial.println<span class="o">(</span><span class="s2">&quot;타이머 초기화 완료!&quot;</span><span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>Setup<span class="w"> </span>the<span class="w"> </span>EUIs<span class="w"> </span>and<span class="w"> </span>Keys
<span class="k">if</span><span class="w"> </span><span class="o">(</span>doOTAA<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>lmh_setDevEui<span class="o">(</span>nodeDeviceEUI<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setAppEui<span class="o">(</span>nodeAppEUI<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setAppKey<span class="o">(</span>nodeAppKey<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>lmh_setNwkSKey<span class="o">(</span>nodeNwsKey<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setAppSKey<span class="o">(</span>nodeAppsKey<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setDevAddr<span class="o">(</span>nodeDevAddr<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

//<span class="w"> </span>Initialize<span class="w"> </span>LoRaWan
Serial.println<span class="o">(</span><span class="s2">&quot;LoRa 모듈 초기화 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="nv">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lmh_init<span class="o">(</span><span class="p">&amp;</span>g_lora_callbacks,<span class="w"> </span>g_lora_param_init,<span class="w"> </span>doOTAA,<span class="w"> </span>g_CurrentClass,<span class="w"> </span>g_CurrentRegion<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>err_code<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;lmh_init failed - %d\n&quot;</span>,<span class="w"> </span>err_code<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="o">}</span>
Serial.println<span class="o">(</span><span class="s2">&quot;LoRa 모듈 초기화 완료!&quot;</span><span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>Start<span class="w"> </span>Join<span class="w"> </span>procedure
Serial.println<span class="o">(</span><span class="s2">&quot;LoRaWAN Join 요청 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
lmh_join<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>



/**@brief<span class="w"> </span>LoRa<span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>handling<span class="w"> </span>HasJoined<span class="w"> </span>event.
*/
void<span class="w"> </span>lorawan_has_joined_handler<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
<span class="k">if</span><span class="o">(</span><span class="nv">doOTAA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="o">)</span>
<span class="o">{</span>
Serial.println<span class="o">(</span><span class="s2">&quot;OTAA Mode, Network Joined!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;ABP Mode&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

lmh_error_status<span class="w"> </span><span class="nv">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lmh_class_request<span class="o">(</span>g_CurrentClass<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>LMH_SUCCESS<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;타이머 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>delay<span class="o">(</span><span class="m">1000</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>TimerSetValue<span class="o">(</span><span class="p">&amp;</span>appTimer,<span class="w"> </span>LORAWAN_APP_INTERVAL<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>TimerStart<span class="o">(</span><span class="p">&amp;</span>appTimer<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;타이머 실행됨! 현재 상태: %d\n&quot;</span>,<span class="w"> </span>appTimer.IsRunning<span class="o">)</span><span class="p">;</span>

<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;타이머 강제 실행 테스트!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>tx_lora_periodic_handler<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>


<span class="o">}</span>
/**@brief<span class="w"> </span>LoRa<span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>handling<span class="w"> </span>OTAA<span class="w"> </span>join<span class="w"> </span>failed
*/
static<span class="w"> </span>void<span class="w"> </span>lorawan_join_failed_handler<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
Serial.println<span class="o">(</span><span class="s2">&quot;OTAA join failed!&quot;</span><span class="o">)</span><span class="p">;</span>
Serial.println<span class="o">(</span><span class="s2">&quot;Check your EUI&#39;s and Keys&#39;s!&quot;</span><span class="o">)</span><span class="p">;</span>
Serial.println<span class="o">(</span><span class="s2">&quot;Check if a Gateway is in range!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
/**@brief<span class="w"> </span>Function<span class="w"> </span><span class="k">for</span><span class="w"> </span>handling<span class="w"> </span>LoRaWan<span class="w"> </span>received<span class="w"> </span>data<span class="w"> </span>from<span class="w"> </span>Gateway
*
*<span class="w"> </span>@param<span class="o">[</span><span class="k">in</span><span class="o">]</span><span class="w"> </span>app_data<span class="w">  </span>Pointer<span class="w"> </span>to<span class="w"> </span>rx<span class="w"> </span>data
*/
void<span class="w"> </span>lorawan_rx_handler<span class="o">(</span>lmh_app_data_t<span class="w"> </span>*app_data<span class="o">)</span>
<span class="o">{</span>
Serial.printf<span class="o">(</span><span class="s2">&quot;LoRa Packet received on port %d, size:%d, rssi:%d, snr:%d, data:%s\n&quot;</span>,
<span class="w">        </span>app_data-&gt;port,<span class="w"> </span>app_data-&gt;buffsize,<span class="w"> </span>app_data-&gt;rssi,<span class="w"> </span>app_data-&gt;snr,<span class="w"> </span>app_data-&gt;buffer<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

void<span class="w"> </span>lorawan_confirm_class_handler<span class="o">(</span>DeviceClass_t<span class="w"> </span>Class<span class="o">)</span>
<span class="o">{</span>
Serial.printf<span class="o">(</span><span class="s2">&quot;switch to class %c done\n&quot;</span>,<span class="w"> </span><span class="s2">&quot;ABC&quot;</span><span class="o">[</span>Class<span class="o">])</span><span class="p">;</span>
//<span class="w"> </span>Informs<span class="w"> </span>the<span class="w"> </span>server<span class="w"> </span>that<span class="w"> </span>switch<span class="w"> </span>has<span class="w"> </span>occurred<span class="w"> </span>ASAP
m_lora_app_data.buffsize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
m_lora_app_data.port<span class="w"> </span><span class="o">=</span><span class="w"> </span>gAppPort<span class="p">;</span>
lmh_send<span class="o">(</span><span class="p">&amp;</span>m_lora_app_data,<span class="w"> </span>g_CurrentConfirm<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>


void<span class="w"> </span>send_lora_frame<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>lmh_join_status_get<span class="o">()</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>LMH_SET<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>//Not<span class="w"> </span>joined,<span class="w"> </span>try<span class="w"> </span>again<span class="w"> </span>later
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="o">}</span>

uint32_t<span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
memset<span class="o">(</span>m_lora_app_data.buffer,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>LORAWAN_APP_DATA_BUFF_SIZE<span class="o">)</span><span class="p">;</span>
m_lora_app_data.port<span class="w"> </span><span class="o">=</span><span class="w"> </span>gAppPort<span class="p">;</span>
Serial.printf<span class="o">(</span><span class="s2">&quot;📦 전송 데이터 -&gt; 온도: %.2f°C, 습도: %.2f%%\n&quot;</span>,<span class="w"> </span>lastTemperature,<span class="w"> </span>lastHumidity<span class="o">)</span><span class="p">;</span>

<span class="k">if</span><span class="w"> </span><span class="o">((</span>int<span class="o">)(</span>lastHumidity<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>

Serial.printf<span class="o">(</span><span class="s2">&quot;습도가 0이면 전송x&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">if</span><span class="w"> </span><span class="o">((</span>int<span class="o">)(</span>lastHumidity<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>


//<span class="w"> </span>LoRaWAN<span class="w"> </span>데이터<span class="w"> </span>패킷<span class="w"> </span>생성<span class="w"> </span><span class="o">(</span>온도<span class="w"> </span>및<span class="w"> </span>습도<span class="w"> </span>2바이트씩<span class="w"> </span>전송<span class="o">)</span>
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)</span>lastTemperature<span class="p">;</span><span class="w">                         </span>//<span class="w"> </span>온도<span class="w"> </span>정수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)((</span>lastTemperature<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>int<span class="o">)</span>lastTemperature<span class="o">)</span><span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>온도<span class="w"> </span>소수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)</span>lastHumidity<span class="p">;</span><span class="w">                            </span>//<span class="w"> </span>습도<span class="w"> </span>정수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)((</span>lastHumidity<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>int<span class="o">)</span>lastHumidity<span class="o">)</span><span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>습도<span class="w"> </span>소수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffsize<span class="w"> </span><span class="o">=</span><span class="w"> </span>i<span class="p">;</span>

<span class="o">}</span>



lmh_error_status<span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lmh_send<span class="o">(</span><span class="p">&amp;</span>m_lora_app_data,<span class="w"> </span>g_CurrentConfirm<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>LMH_SUCCESS<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>count++<span class="p">;</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;lmh_send ok count %d\n&quot;</span>,<span class="w"> </span>count<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>count_fail++<span class="p">;</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;lmh_send fail count %d\n&quot;</span>,<span class="w"> </span>count_fail<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>read_shtc3_data<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>millis<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>lastSensorReadTime<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>sensorReadInterval<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nv">lastSensorReadTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>millis<span class="o">()</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>마지막<span class="w"> </span>실행<span class="w"> </span>시간<span class="w"> </span>업데이트

<span class="w">        </span>g_shtc3.update<span class="o">()</span><span class="p">;</span>


<span class="w">        </span>yield<span class="o">()</span><span class="p">;</span>


<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.lastStatus<span class="w"> </span><span class="o">==</span><span class="w"> </span>SHTC3_Status_Nominal<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="nv">lastTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toDegC<span class="o">()</span><span class="p">;</span>
<span class="w">            </span><span class="nv">lastHumidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toPercent<span class="o">()</span><span class="p">;</span>
<span class="w">            </span>Serial.printf<span class="o">(</span><span class="s2">&quot;📊 센서 데이터: 온도 = %.2f°C, 습도 = %.2f%%\n&quot;</span>,<span class="w"> </span>lastTemperature,<span class="w"> </span>lastHumidity<span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>Serial.println<span class="o">(</span><span class="s2">&quot;⚠️ 센서 데이터 읽기 실패!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>


/**@brief<span class="w"> </span>Function<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>Timer<span class="w"> </span>initialization.
*
*<span class="w"> </span>@details<span class="w"> </span>Initializes<span class="w"> </span>the<span class="w"> </span>timer<span class="w"> </span>module.<span class="w"> </span>This<span class="w"> </span>creates<span class="w"> </span>and<span class="w"> </span>starts<span class="w"> </span>application<span class="w"> </span>timers.
*/


void<span class="w"> </span>tx_lora_periodic_handler<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;📡 LoRaWAN 데이터 전송 시작&quot;</span><span class="o">)</span><span class="p">;</span>


<span class="w">    </span>//<span class="w"> </span>LoRa<span class="w"> </span>데이터<span class="w"> </span>전송
<span class="w">    </span>send_lora_frame<span class="o">()</span><span class="p">;</span>

<span class="w">    </span>//<span class="w"> </span>타이머<span class="w"> </span>재설정
<span class="w">    </span>TimerSetValue<span class="o">(</span><span class="p">&amp;</span>appTimer,<span class="w"> </span>LORAWAN_APP_INTERVAL<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>TimerStart<span class="o">(</span><span class="p">&amp;</span>appTimer<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>


//<span class="w"> </span>타이머<span class="w"> </span>초기화
uint32_t<span class="w"> </span>timers_init<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>TimerInit<span class="o">(</span><span class="p">&amp;</span>appTimer,<span class="w"> </span>tx_lora_periodic_handler<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>

void<span class="w"> </span>loop<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>read_shtc3_data<span class="o">()</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>센서<span class="w"> </span>데이터<span class="w"> </span>비동기<span class="w"> </span>읽기
<span class="w">    </span>yield<span class="o">()</span><span class="p">;</span>

<span class="w">    </span>delay<span class="o">(</span><span class="m">3000</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>CPU<span class="w"> </span>점유율<span class="w"> </span>최소화
<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-mqtt2"><span class="std std-numref">그림 36</span></a> MQTT로 인코딩된 온, 습도값을 받는데 성공</p>
<figure class="align-center" id="id105">
<span id="figure-005-01-mqtt2"></span><a class="reference internal image-reference" href="_images/figure_004155_MQTT.png"><img alt="MQTT결과" src="_images/figure_004155_MQTT.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 36 </span><span class="caption-text">MQTT결과</span><a class="headerlink" href="#id105" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="lambda-dynamodb-aws">
<h3>Lambda로 보내서 DynamoDB에 저장 (AWS)<a class="headerlink" href="#lambda-dynamodb-aws" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/pm/dynamodb/">DynamoDB 콘솔</a> 의 테이블 페이지를 연다.</p></li>
<li><p>테이블생성을 선택한다.</p>
<blockquote>
<div><p>테이블 이름: LoRaWAN_SensorData
파티션 키 (Primary Key): DeviceId (String)
정렬 키 (Sort Key): Timestamp (Number)</p>
</div></blockquote>
</li>
<li><p>기타 설정을 기본값으로 두고 생성 한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-lorawan-sensordata"><span class="std std-numref">그림 37</span></a> LoRaWAN_SensorData 테이블 생성 모습</p>
<figure class="align-center" id="id106">
<span id="figure-005-01-lorawan-sensordata"></span><a class="reference internal image-reference" href="_images/figure_004153_LoRaWAN_SensorData.png"><img alt="LoRaWAN_SensorData" src="_images/figure_004153_LoRaWAN_SensorData.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 37 </span><span class="caption-text">LoRaWAN_SensorData</span><a class="headerlink" href="#id106" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="4">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/lambda/">Lambda 콘솔</a> 의 함수 페이지를 연다.</p></li>
<li><p>함수 생성을 선택한다.</p></li>
<li><p>새로 작성을 선택한다.</p></li>
<li><p>기본 정보 창의 함수 이름에 LoRaWAN_SaveToDynamoDB을 입력한다.</p></li>
<li><p>런타임에서 Python 3.13을 선택한다.</p></li>
<li><p>아키텍처를 x86_64로 설정된 상태로 두고 함수 생성을 선택한다.</p></li>
<li><p>아래 코드를 넣는다.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="c1"># ✅ DynamoDB 연결</span>
<span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;LoRaWAN_SensorData&#39;</span><span class="p">)</span>  <span class="c1"># 테이블 이름 확인!</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decode_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base64로 인코딩된 센서 데이터를 디코딩하여 온도와 습도를 추출&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">decoded_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>  <span class="c1"># Base64 디코딩</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">decoded_bytes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;디코딩된 데이터 길이가 너무 짧음&quot;</span><span class="p">)</span>

        <span class="n">temperature</span> <span class="o">=</span> <span class="n">decoded_bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 첫 번째 바이트: 온도 (정수 값)</span>
        <span class="n">humidity</span> <span class="o">=</span> <span class="n">decoded_bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># 두 번째 바이트: 습도 (정수 값)</span>

        <span class="k">return</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">humidity</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ 페이로드 디코딩 실패: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AWS IoT Core에서 수신한 MQTT 메시지를 처리하고 DynamoDB에 저장&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📡 수신된 이벤트: &quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

        <span class="c1"># ✅ JSON 데이터에서 PayloadData 및 메타데이터 추출</span>
        <span class="n">payload_data</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PayloadData&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WirelessMetadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LoRaWAN&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DevEui&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">timestamp_str</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WirelessMetadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LoRaWAN&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🛠️ 디바이스 ID 확인: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ✅ 필수 데이터 확인</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ 디바이스 ID 없음 (DevEui 값 확인 필요)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">timestamp_str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ Timestamp 값 없음!&quot;</span><span class="p">)</span>

        <span class="c1"># ✅ UTC 타임스탬프 변환</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">timestamp_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

        <span class="c1"># ✅ Base64 디코딩하여 온도 및 습도 추출</span>
        <span class="n">temperature</span><span class="p">,</span> <span class="n">humidity</span> <span class="o">=</span> <span class="n">decode_payload</span><span class="p">(</span><span class="n">payload_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">temperature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">humidity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ 온도 또는 습도 데이터를 추출할 수 없음&quot;</span><span class="p">)</span>

        <span class="c1"># ✅ DynamoDB에 저장 (Key 이름 `DeviceId`, `Timestamp` 사용)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span>
            <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;DeviceId&#39;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>  <span class="c1"># 대소문자 구분</span>
                <span class="s1">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>  <span class="c1"># 정렬 키 (Number)</span>
                <span class="s1">&#39;Temperature&#39;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
                <span class="s1">&#39;Humidity&#39;</span><span class="p">:</span> <span class="n">humidity</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ DynamoDB 저장 완료: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s1">&#39;Data successfully stored in DynamoDB!&#39;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ 오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="11">
<li><p>Deploy 섹션에서 Deploy를 선택하여 함수의 코드를 업데이트한다.</p></li>
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동한다.</p></li>
<li><p>탐색 창에서 메시지 라우팅(Message routing)을 선택한 다음 규칙(Rules)을 선택한다.</p></li>
<li><p>위에서 만든 LoRaWANRouting 규칙을 누른다.</p></li>
<li><p>편집을 들어가서 [규칙작업 추가]를 누른다.</p></li>
<li><p>위에서 만든 LoRaWAN_SaveToDynamoDB 람다함수를 추가한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-lorawanrouting"><span class="std std-numref">그림 38</span></a> LoRaWANRouting에 람다작업 추가한 모습</p>
<figure class="align-center" id="id107">
<span id="figure-005-01-lorawanrouting"></span><a class="reference internal image-reference" href="_images/figure_004154_LoRaWANRouting.png"><img alt="LoRaWANRouting 규칙" src="_images/figure_004154_LoRaWANRouting.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 38 </span><span class="caption-text">LoRaWANRouting 규칙</span><a class="headerlink" href="#id107" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="17">
<li><p>업데이트를 클릭한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-005-01-data2"><span class="std std-numref">그림 39</span></a> 와 같이 온, 습도값이 DynamoDB에 쌓인다.</p>
<figure class="align-center" id="id108">
<span id="figure-005-01-data2"></span><a class="reference internal image-reference" href="_images/figure_004138_data.png"><img alt="데이터베이스" src="_images/figure_004138_data.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 39 </span><span class="caption-text">데이터베이스</span><a class="headerlink" href="#id108" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<br><hr class="docutils" />
</section>
</section>
<section id="technical-report-004023-rx004-02-result-report-group01">
<span id="id55"></span><h2>연구과제004-02 결과 보고서 01조<a class="headerlink" href="#technical-report-004023-rx004-02-result-report-group01" title="Link to this heading">¶</a></h2>
<section id="id56">
<h3><strong>목표</strong><a class="headerlink" href="#id56" title="Link to this heading">¶</a></h3>
<p>에너지 수확을 통해 베터리 교체 없이 반 영구적으로 동작하는 저해상도 적외선 카메라IoT 시험망을 구축한다.</p>
</section>
<section id="id57">
<h3><strong>과정</strong><a class="headerlink" href="#id57" title="Link to this heading">¶</a></h3>
<hr class="docutils" />
<p>참고 링크: <a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">Amazon S3</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/functions">lambda</a></p>
<hr class="docutils" />
<ul>
<li><dl class="simple">
<dt>하드웨어 개발</dt><dd><ul class="simple">
<li><p>디바이스에 부착한 ir 카메라에서 mqtt 메세지로 AWS에 보내야 하는데 지금 보낼 수가 없고, 중간에 디바이스 교체도 해서 개발이 중단됨.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>소프트웨어 개발</dt><dd><ul>
<li><p>이미지를 S3에 저장하는 기능을 먼저 구현하기 위해서 Windows PC에서 이미지를 전송해 S3에 저장하는 것을 목표로 기능을 구현했다.</p></li>
<li><dl>
<dt>aws 버킷 생성</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">Amazon S3</a> 로 이동</p></li>
<li><p>Creat bucket 선택</p></li>
<li><p>버킷 이름 지정 (본인이 원하는 이름으로)</p></li>
<li><p>나머지 설정은 기본값을 유지하고 버킷 생성</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id109">
<img alt="생성된 S3 버킷" src="_images/figure_004121_work2_2_1.jpg" />
<figcaption>
<p><span class="caption-number">그림 40 </span><span class="caption-text">생성된 S3 버킷</span><a class="headerlink" href="#id109" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl>
<dt>aws IoT Core 설정(IoT thing 생성)</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 로 이동</p></li>
<li><p>Manage - All device - Things 이동</p></li>
<li><p>Creat things 선택</p></li>
<li><p>본인이 원하는 이름 입력 후 next 선택</p></li>
<li><p>Auto-generate new certificate 선택 후 next 선택</p></li>
<li><p>creat policy 선택</p></li>
<li><p>본인이 원하는 이름 입력</p></li>
<li><p>아래에 policy document 밑에 json 선택</p></li>
<li><p>코드 편집기에 다음 코드 입력(region은 aws 리전, account-id는 본인 aws id)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;Version&quot;</span>:<span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>,
<span class="w">  </span><span class="s2">&quot;Statement&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;Effect&quot;</span>:<span class="w"> </span><span class="s2">&quot;Allow&quot;</span>,
<span class="w">      </span><span class="s2">&quot;Action&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;iot:Publish&quot;</span>,
<span class="w">        </span><span class="s2">&quot;iot:Subscribe&quot;</span>,
<span class="w">        </span><span class="s2">&quot;iot:Receive&quot;</span>,
<span class="w">        </span><span class="s2">&quot;iot:Connect&quot;</span>
<span class="w">      </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;Resource&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:iot:&lt;region&gt;:&lt;account-id&gt;:topic/iot/images&quot;</span>,
<span class="w">        </span><span class="s2">&quot;arn:aws:iot:&lt;region&gt;:&lt;account-id&gt;:topicfilter/iot/images&quot;</span>,
<span class="w">        </span><span class="s2">&quot;arn:aws:iot:&lt;region&gt;:&lt;account-id&gt;:client/*&quot;</span>
<span class="w">      </span><span class="o">]</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="10">
<li><p>create 선택</p></li>
<li><p>방금 생성한 policy 선택 후 create thing 선택</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id110">
<img alt="생성된 thing" src="_images/figure_004122_work2_2_2.jpg" />
<figcaption>
<p><span class="caption-number">그림 41 </span><span class="caption-text">생성된 thing</span><a class="headerlink" href="#id110" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl>
<dt>람다함수 생성하기</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/functions">lambda</a> 로 이동</p></li>
<li><p>Creat function 선택</p></li>
<li><p>본인이 원하는 이름 입력</p></li>
<li><p>Runtime은 python 최신버전 선택</p></li>
<li><p>creat function 선택</p></li>
<li><p>방금 생성한 람다함수 선택</p></li>
<li><p>아래에 Code 탭에 열려있는 lambda_function.py에 다음 코드를 입력</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import<span class="w"> </span>json
import<span class="w"> </span>base64
import<span class="w"> </span>boto3
import<span class="w"> </span><span class="nb">time</span>

<span class="c1"># AWS S3 클라이언트 생성</span>
<span class="nv">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>boto3.client<span class="o">(</span><span class="s1">&#39;s3&#39;</span><span class="o">)</span>

<span class="c1"># S3 버킷 이름 (본인의 버킷 이름으로 변경)</span>
<span class="nv">BUCKET_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;m-bucket-test&quot;</span>

def<span class="w"> </span>lambda_handler<span class="o">(</span>event,<span class="w"> </span>context<span class="o">)</span>:
<span class="w">    </span>try:
<span class="w">        </span><span class="c1"># 로그 출력 (디버깅용)</span>
<span class="w">        </span>print<span class="o">(</span><span class="s2">&quot;Received event:&quot;</span>,<span class="w"> </span>json.dumps<span class="o">(</span>event,<span class="w"> </span><span class="nv">indent</span><span class="o">=</span><span class="m">2</span><span class="o">))</span>

<span class="w">        </span><span class="c1"># MQTT 메시지에서 Base64 인코딩된 이미지 데이터 추출</span>
<span class="w">        </span><span class="nv">image_data_base64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>event.get<span class="o">(</span><span class="s1">&#39;image_data&#39;</span>,<span class="w"> </span>None<span class="o">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>image_data_base64:
<span class="w">            </span>raise<span class="w"> </span>ValueError<span class="o">(</span><span class="s2">&quot;image_data 필드가 존재하지 않습니다.&quot;</span><span class="o">)</span>

<span class="w">        </span><span class="c1"># Base64 인코딩된 이미지 데이터를 디코딩</span>
<span class="w">        </span><span class="nv">image_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base64.b64decode<span class="o">(</span>image_data_base64<span class="o">)</span>

<span class="w">        </span><span class="c1"># 저장할 파일명 생성 (timestamp 기반)</span>
<span class="w">        </span><span class="nv">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;image_{int(time.time())}.jpg&quot;</span>

<span class="w">        </span><span class="c1"># S3에 이미지 업로드</span>
<span class="w">        </span>s3.put_object<span class="o">(</span>
<span class="w">            </span><span class="nv">Bucket</span><span class="o">=</span>BUCKET_NAME,
<span class="w">            </span><span class="nv">Key</span><span class="o">=</span>file_name,
<span class="w">            </span><span class="nv">Body</span><span class="o">=</span>image_data,
<span class="w">            </span><span class="nv">ContentType</span><span class="o">=</span><span class="s2">&quot;image/jpeg&quot;</span>
<span class="w">        </span><span class="o">)</span>

<span class="w">        </span>print<span class="o">(</span>f<span class="s2">&quot;Image successfully saved to S3: {file_name}&quot;</span><span class="o">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s1">&#39;statusCode&#39;</span>:<span class="w"> </span><span class="m">200</span>,
<span class="w">            </span><span class="s1">&#39;body&#39;</span>:<span class="w"> </span>json.dumps<span class="o">(</span>f<span class="s1">&#39;Image uploaded: {file_name}&#39;</span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span>except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
<span class="w">        </span>print<span class="o">(</span>f<span class="s2">&quot;Error processing MQTT message: {str(e)}&quot;</span><span class="o">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s1">&#39;statusCode&#39;</span>:<span class="w"> </span><span class="m">500</span>,
<span class="w">            </span><span class="s1">&#39;body&#39;</span>:<span class="w"> </span>json.dumps<span class="o">(</span>f<span class="s1">&#39;Error: {str(e)}&#39;</span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>왼쪽에 Deploy 선택</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id111">
<img alt="생성된 람다" src="_images/figure_004123_work2_2_3.jpg" />
<figcaption>
<p><span class="caption-number">그림 42 </span><span class="caption-text">생성된 람다</span><a class="headerlink" href="#id111" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
<ol class="arabic simple" start="9">
<li><p>configuration 탭 선택 후 왼쪽의 목록에서 permissions 선택</p></li>
<li><p>Role name 아래에 자동으로 생성된 role 하이퍼링크 클릭</p></li>
<li><p>permissions - Add permissions - Attach policies 선택</p></li>
<li><p>search 탭에 ‘AmazonS3FullAccess’ 검색 후 Add permissions 선택</p></li>
<li><p>같은 방법으로 ‘AWSIoTFullAccess’ permmissions 추가</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id112">
<img alt="permission이 추가된 모습" src="_images/figure_004124_work2_2_4.jpg" />
<figcaption>
<p><span class="caption-number">그림 43 </span><span class="caption-text">permission이 추가된 모습</span><a class="headerlink" href="#id112" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl>
<dt>람다 트리거 설정</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 로 이동</p></li>
<li><p>Manage - Message routing - Rules 이동</p></li>
<li><p>Creat rule 선택</p></li>
<li><p>본인이 원하는 이름 입력 후 next 선택</p></li>
<li><p>SQL version은 2016-03-23, SQL Statement에 다음 입력</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span><span class="s1">&#39;iot/images&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Rule actions에서 Action 1에 Lambda 선택</p></li>
<li><p>Lambda function에서 이전에 만든 Lambda function 선택 후 next 선택</p></li>
<li><p>Creat 선택</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id113">
<img alt="Rule이 추가된 모습" src="_images/figure_004125_work2_2_5.jpg" />
<figcaption>
<p><span class="caption-number">그림 44 </span><span class="caption-text">Rule이 추가된 모습</span><a class="headerlink" href="#id113" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>테스트</dt><dd><ul>
<li><dl>
<dt>이미지를 base64로 인코딩</dt><dd><ol class="arabic simple">
<li><p>S3에 저장하려는 이미지를 jpg로 바탕화면에 저장</p></li>
<li><p>다음 파이썬 코드를 실행</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">image_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\사용자명\Desktop\test.jpg&quot;</span>  <span class="c1"># 변환할 이미지 파일 (파일명을 본인의 이미지로 변경)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
    <span class="n">encoded_string</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">image_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">mqtt_payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;image_data&quot;</span><span class="p">:</span> <span class="n">encoded_string</span><span class="p">})</span>  <span class="c1"># JSON 변환</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mqtt_payload</span><span class="p">)</span>  <span class="c1"># 전체 Base64 문자열 출력</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>저장 테스트</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 로 이동</p></li>
<li><p>Test - MQTT test client로 이동</p></li>
<li><p>Publish to a topic 선택</p></li>
<li><p>Topic name에 iot/images입력</p></li>
<li><p>Message payload에 python 코드를 실행한 결과를 그대로 붙혀넣기</p></li>
<li><p>publish 선택</p></li>
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">Amazon S3</a> 로 이동</p></li>
<li><p>본인이 생성한 버킷에 이미지가 저장됨</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id114">
<img alt="이미지가 저장된 모습" src="_images/figure_004126_work2_2_6.jpg" />
<figcaption>
<p><span class="caption-number">그림 45 </span><span class="caption-text">이미지가 저장된 모습</span><a class="headerlink" href="#id114" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id115">
<img alt="저장된 이미지를 확인할 수 있다" src="_images/figure_004127_work2_2_7.jpg" />
<figcaption>
<p><span class="caption-number">그림 46 </span><span class="caption-text">저장된 이미지를 확인할 수 있다</span><a class="headerlink" href="#id115" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id60">
<h3><strong>결과</strong><a class="headerlink" href="#id60" title="Link to this heading">¶</a></h3>
<ul>
<li><dl class="simple">
<dt>동작흐름</dt><dd><ol class="arabic simple">
<li><p>Python으로 이미지를 incoding 한다.</p></li>
<li><p>컴퓨터에서 mqtt로 이미지 incoding 데이터 보낸다.</p></li>
<li><p>AWS에서 iot/images로 메세지가 들어온다.</p></li>
<li><p>lambda function이 iot/images를 감지하여 메세지를 디코딩하고 S3로 메세지를 전송한다.</p></li>
<li><p>lambda function에서 지정해준 bucket으로 이미지를 저장한다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>결과 사진</dt><dd><figure class="align-center" id="id116">
<img alt="데이터가 S3에 저장된 모습" src="_images/figure_004128_work2_2_8.jpg" />
<figcaption>
<p><span class="caption-number">그림 47 </span><span class="caption-text">데이터가 S3에 저장된 모습</span><a class="headerlink" href="#id116" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>결산</dt><dd><dl class="simple">
<dt><strong>incoding된 이미지 정보를 MQTT로 보내 Message routing rule과 lambda fuction을 이용해 decoding하고 S3로 저장한다.</strong></dt><dd><p>–&gt; 성공</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>고찰</dt><dd><p>encoding된 데이터를 MQTT로 전송하고 lambda function으로 decoding 하여 S3 bucket에 저장하는데는 성공했지만 정작 device의 IR camera로 촬영한 데이터를 아두이노에서 바로 MQTT로 전송하는데는 어려움을 겪고있다. 메세지 크기 제한으로 인해 32X24=768 개의 데이터를 한번에 MQTT로 전송하는데는 성공하지 못 했다. 그래서 여러개로 나누어서 전송하는 방법을 고려해봐야할것같다. 이후 lambda function에서 데이터를 취합하여 S3로 보내는 코드를 작성해야했지만 완성하지 못 하고 최종적으로 마무리하였다.</p>
</dd>
</dl>
</li>
</ul>
<br><hr class="docutils" />
</section>
</section>
<section id="technical-report-004024-rx004-02-result-report-group02">
<span id="id61"></span><h2>연구과제004-02 결과 보고서 02조<a class="headerlink" href="#technical-report-004024-rx004-02-result-report-group02" title="Link to this heading">¶</a></h2>
<section id="id62">
<h3>개요<a class="headerlink" href="#id62" title="Link to this heading">¶</a></h3>
<p>본 문서는 RAK4630에 태양광과 배터리를 연결하여 반영구적으로 작동시키고 AWS IoT Core를 활용하여 MQTT 프로토콜을 통해 이미지를 전송하고, AWS Lambda를 이용하여 S3 버킷에 저장하는 과정에 대한 내용을 포함한다.</p>
</section>
<hr class="docutils" />
<section id="id63">
<h3>RAK4630 반영구적 작동<a class="headerlink" href="#id63" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak11310/quickstart/">여기서</a> Battery and Solar Connection파트에 가서 배터리와 태양광을 맞는 위치에 연결한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-001-01-hard1"><span class="std std-numref">그림 48</span></a></p>
<figure class="align-center" id="id117">
<span id="figure-001-01-hard1"></span><a class="reference internal image-reference" href="_images/figure_004146_hard1.png"><img alt="태양광" src="_images/figure_004146_hard1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 48 </span><span class="caption-text">태양광</span><a class="headerlink" href="#id117" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-001-01-hard2"><span class="std std-numref">그림 49</span></a></p>
<figure class="align-center" id="id118">
<span id="figure-001-01-hard2"></span><a class="reference internal image-reference" href="_images/figure_004147_hard2.png"><img alt="배터리" src="_images/figure_004147_hard2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 49 </span><span class="caption-text">배터리</span><a class="headerlink" href="#id118" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-001-01-hard"><span class="std std-numref">그림 50</span></a> 은 RAK4630을 하드웨어를 연결한 모습이다.</p>
<figure class="align-center" id="id119">
<span id="figure-001-01-hard"></span><a class="reference internal image-reference" href="_images/figure_004158_RAK4630_hard.png"><img alt="RAK4630" src="_images/figure_004158_RAK4630_hard.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 50 </span><span class="caption-text">RAK4630</span><a class="headerlink" href="#id119" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="2">
<li><p>RAK4630에 따로 전원을 주지 않아도 데이터가 전송되는 것을 확인한다.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="aws">
<h3>AWS 설정<a class="headerlink" href="#aws" title="Link to this heading">¶</a></h3>
<p>S3 버킷 생성</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">AWS S3 콘솔</a> 로 이동한다.</p></li>
<li><p>“버킷 만들기”를 클릭한다.</p></li>
<li><p>버킷 이름: tests3coobarha</p></li>
<li><p>퍼블릭 액세스 차단 설정: “모든 퍼블릭 액세스 차단” 유지</p></li>
<li><p>“생성” 버튼을 클릭한다.</p></li>
</ol>
<hr class="docutils" />
<p>AWS IoT Core에서 Thing 생성(노트북으로 이미지 전송)</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 로 이동한다.</p></li>
<li><p>“Manage” → “Things”를 선택한다.</p></li>
<li><p>“Create Things”를 클릭하여 “Create single thing”을 선택한다.</p></li>
<li><p>Thing 이름: iot-image-uploader 입력한다.</p></li>
<li><p>Device Shadow: “섀도우 없음” 선택한다.</p></li>
<li><p>“Next” 클릭 후 “Auto-generate new certificate” 선택한다.</p></li>
<li><p>“Next” → “Create Thing” 클릭한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-001-01-things2"><span class="std std-numref">그림 51</span></a> 생성된 사물</p>
<figure class="align-center" id="id120">
<span id="figure-001-01-things2"></span><a class="reference internal image-reference" href="_images/figure_004165_s3things.png"><img alt="생성된 사물" src="_images/figure_004165_s3things.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 51 </span><span class="caption-text">생성된 사물</span><a class="headerlink" href="#id120" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>AWS IoT Core 인증서 다운로드</p>
<ol class="arabic">
<li><p>위에서  생성한 Thing에서 아래 3개의 인증서 파일을 다운로드한다.</p>
<blockquote>
<div><p>Device Certificate (.crt 파일)
Private Key (.key 파일)
Amazon Root CA (AmazonRootCA1.pem)</p>
</div></blockquote>
</li>
<li><p>다운로드한 파일을 안전한 폴더에 저장한다.</p>
<blockquote>
<div><p>예: C:\Users\dlwng\Downloads\</p>
</div></blockquote>
</li>
</ol>
<hr class="docutils" />
<p>AWS IoT 정책 생성 (MQTT + S3 접근 허용)</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 에서 “Secure” → “Policies” 클릭한다.</p></li>
<li><p>“Create policy” 클릭한다.</p></li>
<li><p>정책 이름: IoT_MQTT_S3_Policy</p></li>
<li><p>정책 문서(JSON) 추가한다.</p></li>
</ol>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="p">{</span>
<span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;iot:Publish&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;iot:Connect&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;iot:Receive&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;iot:Subscribe&quot;</span>
<span class="p">],</span>
<span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;s3:PutObject&quot;</span>
<span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::iot-image-bucket/&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>“Create” 클릭한다.</p></li>
<li><p>“Secure” → “Certificates”에서 Attach policy 선택 후 IoT_MQTT_S3_Policy 정책을 연결한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-001-01-poli2"><span class="std std-numref">그림 52</span></a></p>
<figure class="align-center" id="id121">
<span id="figure-001-01-poli2"></span><a class="reference internal image-reference" href="_images/figure_004162_s3pol.png"><img alt="정책" src="_images/figure_004162_s3pol.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 52 </span><span class="caption-text">정책</span><a class="headerlink" href="#id121" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>AWS Lambda 설정</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/lambda/">Lambda 콘솔</a> 로 이동한다.</p></li>
<li><p>“Create function” 클릭한다.</p></li>
<li><p>Function name: iot-image-handler</p></li>
<li><p>Runtime: Python 선택한다.</p></li>
<li><p>“Create function” 클릭한다.</p></li>
<li><p>AWS IoT Core에서 MQTT 메시지를 받아 S3에 저장하는 Python 코드 작성한다.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
 <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
 <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
 <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>


 <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
 <span class="n">BUCKET_NAME</span> <span class="o">=</span> <span class="s2">&quot;iot-image-bucket&quot;</span>

 <span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
 <span class="k">try</span><span class="p">:</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📡 수신된 이벤트:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

     <span class="n">image_data_base64</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image_data&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">image_data_base64</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ &#39;image_data&#39; 필드가 이벤트에 없음!&quot;</span><span class="p">)</span>

    <span class="n">image_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">image_data_base64</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;image_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">.png&quot;</span>

    <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">BUCKET_NAME</span><span class="p">,</span>
        <span class="n">Key</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">Body</span><span class="o">=</span><span class="n">image_data</span><span class="p">,</span>
        <span class="n">ContentType</span><span class="o">=</span><span class="s2">&quot;image/png&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ S3에 이미지 업로드 완료: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image uploaded to S3: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)}</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ 오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>Lambda에 S3 접근 권한 추가</p>
<ol class="arabic simple">
<li><p>Lambda 콘솔에서 “Configuration” → “Permissions” 클릭한다.</p></li>
<li><p>“Execution role” 아래 “Role name” 클릭한다.</p></li>
<li><p>IAM 콘솔에서 “Add permissions” → “Attach policies” 클릭한다.</p></li>
<li><p>“AmazonS3FullAccess” 선택 후 “Attach policies” 클릭한다.</p></li>
</ol>
<hr class="docutils" />
<p>AWS IoT Core “Rules” 설정</p>
<hr class="docutils" />
<ol class="arabic simple">
<li><p><a class="reference external" href="https://aws.amazon.com/ko/iot-core/">AWS IOT 콘솔</a> 에서 “Message routing” → “Rules” 선택한다.</p></li>
<li><p>기존의 iot-image-rule 클릭한다.</p></li>
<li><p>SQL Statement 수정한다.</p></li>
</ol>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;image/topic&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>“Lambda” 액션 추가한다.</p></li>
<li><p>Lambda 함수 iot-image-handler 선택한다.</p></li>
<li><p>“Update rule” 클릭하여 저장한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-001-01-rules2"><span class="std std-numref">그림 53</span></a> 규칙</p>
<figure class="align-center" id="id122">
<span id="figure-001-01-rules2"></span><a class="reference internal image-reference" href="_images/figure_004164_s3rules.png"><img alt="규칙" src="_images/figure_004164_s3rules.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 53 </span><span class="caption-text">규칙</span><a class="headerlink" href="#id122" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="python-mqtt">
<h3>Python 코드 작성 (MQTT로 이미지 전송)<a class="headerlink" href="#python-mqtt" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p>VScode를 열어 파이썬으로 이미지 파일을 MQTT로 보내는 코드를 작성한다.</p></li>
<li><p>코드의 ENDPOINT, THING_NAME, TOPIC을 Thing에 맞게 고친다.</p></li>
<li><p>코드에 다운받았던 인증서파일의 경로를 추가한다.</p>
<blockquote>
<div><p>CERT_PATH: Device Certificate (.crt 파일)
KEY_PATH: Private Key (.key 파일)
CA_PATH: Amazon Root CA (AmazonRootCA1.pem)</p>
</div></blockquote>
</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AWSIoTPythonSDK.MQTTLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">AWSIoTMQTTClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;a263uq00h584cr-ats.iot.us-east-1.amazonaws.com&quot;</span>
<span class="n">THING_NAME</span> <span class="o">=</span> <span class="s2">&quot;iot-image-uploader&quot;</span>
<span class="n">TOPIC</span> <span class="o">=</span> <span class="s2">&quot;image/topic&quot;</span>

<span class="n">CA_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Downloads\AmazonRootCA1.pem&quot;</span>
<span class="n">CERT_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Downloads\device-certificate.pem.crt&quot;</span>
<span class="n">KEY_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Downloads\private.pem.key&quot;</span>

<span class="n">IMAGE_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Pictures\Screenshots\스크린샷.png&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">AWSIoTMQTTClient</span><span class="p">(</span><span class="n">THING_NAME</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">configureEndpoint</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="mi">8883</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">configureCredentials</span><span class="p">(</span><span class="n">CA_PATH</span><span class="p">,</span> <span class="n">KEY_PATH</span><span class="p">,</span> <span class="n">CERT_PATH</span><span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">IMAGE_PATH</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
<span class="n">image_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">image_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="n">THING_NAME</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span> <span class="s2">&quot;image_data&quot;</span><span class="p">:</span> <span class="n">image_data</span><span class="p">})</span>

<span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
</section>
<hr class="docutils" />
<section id="id69">
<h3>최종 결과 및 테스트<a class="headerlink" href="#id69" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>위에서 만든 코드를 실행하여 이미지파일을 MQTT로 보내면 AWS S3에 전달된다.</p></li>
<li><p>AWS IoT Core의 MQTT Test Client에서 image/topic을 구독하여 이미지 데이터가 정상적으로 전달되는지 확인한다.</p></li>
<li><p>S3 버킷에서 이미지가 정상적으로 저장되는지 확인한다.</p></li>
</ol>
<p><a class="reference internal" href="#figure-001-01-s32"><span class="std std-numref">그림 54</span></a> 는 결과 사진이다.</p>
<figure class="align-center" id="id123">
<span id="figure-001-01-s32"></span><a class="reference internal image-reference" href="_images/figure_004159_s3coobarha.png"><img alt="MQTT로 수신된 이미지파일" src="_images/figure_004159_s3coobarha.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 54 </span><span class="caption-text">MQTT로 수신된 이미지파일</span><a class="headerlink" href="#id123" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="id70">
<h3>실패한 부분<a class="headerlink" href="#id70" title="Link to this heading">¶</a></h3>
<p>카메라로 찍은 데이터를 aws iot core에 보내는 코드를 작성했는데 패킷문제가 발생하여 MQTT로 이미지파일이 보내지지 않았다.</p>
<hr class="docutils" />
<br></section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="research_notes.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Research notes</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="introduction.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Introduction</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, RX004
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Technical reports</a><ul>
<li><a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win">유비노스 시작 안내서 (윈도우즈)</a><ul>
<li><a class="reference internal" href="#id3">운영체제 종속적 패키지 설치</a><ul>
<li><a class="reference internal" href="#chocolatey">Chocolatey 설치</a></li>
<li><a class="reference internal" href="#id4">필요한 패키지 설치</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ssh-key-github">SSH key 생성 및 github에 등록</a><ul>
<li><a class="reference internal" href="#ssh-key">SSH key 생성</a></li>
<li><a class="reference internal" href="#ssh-github">생성한 SSH 공개키를 github에 등록</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">유비노스 소스트리 다운로드 및 개발용 가상환경 생성</a><ul>
<li><a class="reference internal" href="#id6">유비노스 소스트리 다운로드</a></li>
<li><a class="reference internal" href="#id7">개발용 가상환경 생성</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vscode">VSCode 설치</a></li>
<li><a class="reference internal" href="#gnu-arm-embedded-toolchain">GNU ARM Embedded Toolchain 설치</a></li>
<li><a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win-open-ubinsos-source-tree-with-vscode">VSCode로 유비노스 소스트리 열기</a></li>
<li><a class="reference internal" href="#vscode-hello-world">VSCode로 유비노스 hello_world 예제 선택, 빌드</a></li>
<li><a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win-run-hello-world-example">VSCode로 유비노스 hello_world 예제 실행</a></li>
<li><a class="reference internal" href="#id10">VSCode로 디버깅하기 위해 필요한 확장 프로그램 설치 및 설정</a></li>
<li><a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win-debugging-hello-world-example-with-vscode">VSCode로 유비노스 hello_world 예제 실행 및 디버깅</a></li>
<li><a class="reference internal" href="#technical-report-002003-ubinos-getting-started-guide-win-update-ubinos-libraries">유비노스 라이브러리 업데이트</a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-002006-vscode-tips">VSCode 활용 팁</a><ul>
<li><a class="reference internal" href="#id15">단축키</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rx004">RX004 라이브러리 사용 안내서</a><ul>
<li><a class="reference internal" href="#id16">1. 유비노스 및 RX004 라이브러리 설치</a><ul>
<li><a class="reference internal" href="#id17">1.1. 유비노스 설치</a></li>
<li><a class="reference internal" href="#id18">1.2. RX004 라이브러리 설치</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19">2. RX004 라이브러리 사용 방법</a><ul>
<li><a class="reference internal" href="#rx004-home">2.1. RX004 Home 문서 편집, 빌드, 결과물 확인</a></li>
<li><a class="reference internal" href="#rx004-github">2.2. RX004 수정 내용을 github에 올리기</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-004015-rx004-01-proposal">연구과제004-01 제안서</a><ul>
<li><a class="reference internal" href="#id21">연구 목적</a></li>
<li><a class="reference internal" href="#id22">연구 내용</a><ul>
<li><a class="reference internal" href="#id23">단말장치 개발</a></li>
<li><a class="reference internal" href="#id24">게이트웨이 개발</a></li>
<li><a class="reference internal" href="#id25">서버 개발</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id26">결과물</a></li>
<li><a class="reference internal" href="#id27">예상 일정</a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-004016-rx004-02-proposal">연구과제004-02 제안서</a><ul>
<li><a class="reference internal" href="#id29">연구 목적</a></li>
<li><a class="reference internal" href="#id30">연구 내용</a><ul>
<li><a class="reference internal" href="#id31">단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가</a></li>
<li><a class="reference internal" href="#id32">단말 장치에 저해상도 적외선 카메라 기능 추가</a></li>
<li><a class="reference internal" href="#id33">서버에 영상 데이터 저장 기능 추가</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id34">결과물</a></li>
<li><a class="reference internal" href="#id35">예상 일정</a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-004021-rx004-01-result-report-group01">연구과제004-01 결과 보고서 01조</a><ul>
<li><a class="reference internal" href="#id37"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id38"><strong>과정</strong></a></li>
<li><a class="reference internal" href="#id39"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-004022-rx004-01-result-report-group02">연구과제004-01 결과 보고서 02조</a><ul>
<li><a class="reference internal" href="#id41">개요</a></li>
<li><a class="reference internal" href="#rak7248">RAK7248 사전 준비</a></li>
<li><a class="reference internal" href="#rak4630">RAK4630 사전 준비</a></li>
<li><a class="reference internal" href="#dynamodb">dynamoDB 예제 코드 시행</a></li>
<li><a class="reference internal" href="#lambda">Lambda 함수 예제 코드 시행</a></li>
<li><a class="reference internal" href="#lorawan">LoRaWAN으로 온, 습도값 보내기</a></li>
<li><a class="reference internal" href="#lambda-dynamodb-aws">Lambda로 보내서 DynamoDB에 저장 (AWS)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-004023-rx004-02-result-report-group01">연구과제004-02 결과 보고서 01조</a><ul>
<li><a class="reference internal" href="#id56"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id57"><strong>과정</strong></a></li>
<li><a class="reference internal" href="#id60"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#technical-report-004024-rx004-02-result-report-group02">연구과제004-02 결과 보고서 02조</a><ul>
<li><a class="reference internal" href="#id62">개요</a></li>
<li><a class="reference internal" href="#id63">RAK4630 반영구적 작동</a></li>
<li><a class="reference internal" href="#aws">AWS 설정</a></li>
<li><a class="reference internal" href="#python-mqtt">Python 코드 작성 (MQTT로 이미지 전송)</a></li>
<li><a class="reference internal" href="#id69">최종 결과 및 테스트</a></li>
<li><a class="reference internal" href="#id70">실패한 부분</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=10f1778b"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
    </body>
</html>