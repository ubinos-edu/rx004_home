<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Seminar" href="seminar.html" /><link rel="prev" title="Technical reports" href="technical_reports.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Research notes - RX004</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=da9162aa" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">RX004</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">RX004</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="technical_reports.html">Technical reports</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Technical reports</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-002003-ubinos-getting-started-guide-win">유비노스 시작 안내서 (윈도우즈)</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-002006-vscode-tips">VSCode 활용 팁</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#rx004">RX004 라이브러리 사용 안내서</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-004015-rx004-01-proposal">연구과제004-01 제안서</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-004016-rx004-02-proposal">연구과제004-02 제안서</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-004021-rx004-01-result-report-group01">연구과제004-01 결과 보고서 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-004022-rx004-01-result-report-group02">연구과제004-01 결과 보고서 02조</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-004023-rx004-02-result-report-group01">연구과제004-02 결과 보고서 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="technical_reports.html#technical-report-004024-rx004-02-result-report-group02">연구과제004-02 결과 보고서 02조</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children current-page"><a class="current reference internal" href="#">Research notes</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Research notes</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="#sprt-03-06-rx004-01">연구 노트 2025_0112_0208_SPRT_03_06 RX004 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sprt-03-06-rx004-02">연구 노트 2025_0112_0208_SPRT_03_06 RX004 02조</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sprt-07-09-rx004-01">연구 노트 2025_0209_0301_SPRT_07_09 RX004 01조</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sprt-07-09-rx004-02">연구 노트 2025_0209_0301_SPRT_07_09 RX004 02조</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="seminar.html">Seminar</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="rx004_01.html">Project RX0004-01</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Project RX0004-01</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-aws-setting-guide">RX004 AWS Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-aws-cli-setting-guide">RX004 AWS CLI Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-dynamodb-and-access-policy-setting-guide">RX004 DynamoDB and Access Policy Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-iotcore-lorawan-gateway-setting-guide">RX004 IoTCore LoRaWAN Gateway Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-iotcore-lorawan-device-setting-guide">RX004 IoTCore LoRaWAN Device Setting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="rx004_01.html#rx004-amplify-sensor-data-view-deployment-guide">RX004 Amplify Sensor Data View Deployment Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions_and_answers.html">Questions and answers</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="appendix.html">Appendix</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Appendix</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="appendix.html#restructuredtext-basic">reStructuredText basic</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="research-notes">
<span id="id1"></span><h1>Research notes<a class="headerlink" href="#research-notes" title="Link to this heading">¶</a></h1>
<br><hr class="docutils" />
<section id="sprt-03-06-rx004-01">
<span id="research-note-004015-2025-0112-0208-sprt-03-06-rx004-group01"></span><h2>연구 노트 2025_0112_0208_SPRT_03_06 RX004 01조<a class="headerlink" href="#sprt-03-06-rx004-01" title="Link to this heading">¶</a></h2>
<section id="id2">
<h3>개요<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<p>센서로 수집한 온도와 습도 데이터를 게이트웨이를 통해 MQTT메세지로 전달하여 lambda function으로 가공하고 DynamoDB에 저장한다.</p>
</section>
<hr class="docutils" />
<section id="id3">
<h3>01월 12일 - 01월 18일 (01주차)<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<section id="id4">
<h4><strong>목표</strong><a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>rak 1901 센서 보드에 장착하고 동작여부 확인하기</p></li>
<li><p>rak 7248 게이트웨이 aws iot core에 등록하기</p></li>
</ol>
<hr class="docutils" />
<p>참고 링크: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK 7248 guide</a> , <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak4631/quickstart/">RAK 4631 guide</a> , <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK 1901 guide</a></p>
</section>
<hr class="docutils" />
<section id="id5">
<h4><strong>과정</strong><a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<section id="rak-1901">
<h5>• rak 1901 동작 테스트<a class="headerlink" href="#rak-1901" title="Link to this heading">¶</a></h5>
<ul class="simple">
<li><dl class="simple">
<dt>rak 1901 설정</dt><dd><ol class="arabic simple">
<li><p>rak 1901을 사용하기 위해서는 기본적으로 아두이노 IDE가 설치되어 있어야 한다.(윈도우 10 이상을 사용하고 있다면 윈도우 스토어에서 다운받으면 안 되고 공식 웹사이트에서 다운 받아야 한다.)</p></li>
<li><p>아두이노를 설치하였으면 <a class="reference external" href="https://learn.rakwireless.com/hc/en-us/articles/26687371039383-How-To-Perform-Installation-of-Board-Support-Package-in-Arduino-IDE">adding the BSP in Arduino IDE</a> 를 들어가 기본 설정을 마친다.</p></li>
<li><p><strong>RAK 1901 guide</strong> 의 설명을 따라 센서를 보드에 부착하고 아두이노 가이드도 그대로 따라하면 문제없이 동작한다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id6">
<h5>• 게이트웨이 등록하기<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h5>
<ul>
<li><dl>
<dt>게이트웨이 설정</dt><dd><ol class="arabic simple">
<li><p><strong>RAK 7248 guide</strong> 링크를 들어가서 먼저 datasheet 항목에 들어간다. 그리고 아래롤 스크롤하면 어느 위치에 안테나를 꽂아야 하는지 그림이 나와 있다. 그림을 참고해서 안테나를 꽂는다.</p></li>
<li><p>다음으로 quick start guide 항목에 들어간다. 가이드에 SD카드를 이용해서 펌웨어 설치를 하는 과정이 있지만 이 과정은 이미 되어 있어서 바로 다음 과정으로 넘어간다. 자신이 wifi를 사용할지 이더넷 케이블을 사용할지 정한 다음 각가의 가이드를 따라서 수행하면 문제없이 완료된다. 이때 <strong>optional configuration</strong> 은 수행할 필요없다. 이 과정을 완료하면 게이트웨이에 접속하여 로그인까지 가능하다.</p></li>
</ol>
<p>이 다음으로 LoRaWAN Network Server Guide를 해야하는데 게이트웨이에 문제가 생겨서 더이상 진행하지 못 했다.</p>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="id7">
<h4><strong>결과</strong><a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><dl class="simple">
<dt>rak 1901 센서 보드에 장착하고 동작여부 확인하기</dt><dd><p>–&gt; 보드에 장착하고 동작하는것을 확인했음</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>rak 7248 게이트웨이 aws iot core에 등록하기</dt><dd><p>–&gt; 게이트웨이 로그인은 가능했지만 iot core에 등록은 실패</p>
</dd>
</dl>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="id8">
<h3>01월 19일 - 01월 25일 (02주차)<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<section id="id9">
<h4><strong>목표</strong><a class="headerlink" href="#id9" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>rak 7248 게이트웨이 aws iot core에 등록하기</p></li>
<li><p>rak 4631 디바이스 aws iot core에 등록하기</p></li>
</ol>
<hr class="docutils" />
<p>참고 링크: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK 7248 guide</a> , <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak4631/quickstart/">RAK 4631 guide</a> , <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK 7268 guide</a></p>
</section>
<hr class="docutils" />
<section id="id12">
<h4><strong>과정</strong><a class="headerlink" href="#id12" title="Link to this heading">¶</a></h4>
<section id="id13">
<h5>• 게이트웨이 설정<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h5>
<p>시작하기 앞서 게이트웨이를 iot core에 등록하려면 deviceEUI가 필요한데 무슨 이유인지 가지고 있던 게이트웨이에 deviceEUI가 들어가 있지 않아서 교수님의 도움으로 deviceEUI를 강제로 등록했다. 그리고 aws계정을 생성해야하는데 계정을 생성하고 <a class="reference external" href="https://computer-science-student.tistory.com/m/781">예산설정</a> 을 해줘야 지나친 요금 청구를 막을 수 있다.</p>
<ul class="simple">
<li><dl class="simple">
<dt>게이트웨이를 AWS IoT Core에 등록</dt><dd><ol class="arabic simple">
<li><p><strong>RAK 7248 guide</strong> 에서 LoRaWAN Network Server Guide에 들어간다. 먼저 게이트웨이에 basic staion을 설치해야한다. basic station 설치 가이드는 <a class="reference external" href="https://doc.sm.tc/station/">LoRa Basic Station</a> 의 Quick Start 항목을 그대로 따라하면 된다. 다른 항목은 안 해도 지금 작업에는 문제 없어서 하지 않았다.</p></li>
<li><p>게이트웨이를 iot core에 등록하려면 인증서가 필요하다. 인증서 발급을 위해서 aws의 <a class="reference external" href="https://docs.aws.amazon.com/iot-wireless/latest/developerguide/what-is-iot-wireless.html">online guide</a> 에 들어가서 AWS IoT Core for LoRaWAN - Connecting to AWS IoT Core for LoRaWAN - Onboard your gateways to AWS IoT Core for LoRaWAN - Add a gateway to AWS IoT Core for LoRaWA항목에 들어간다. (<strong>주의</strong> : online guide에서 제공하는 게에트웨이 등록방법을 따라하면 안 된다. online guide의 내용은 기본적으로로 <strong>RAK 7248 guide</strong> 의 가이드를 따라가면서 필요할 때에만 참고해야한다.) 우리는 처음 등록하는 것이므로 Add a gateway using the console 방법을 따라한다. 이 방법을 수행했으면 다른 방법은 따라하지 않아도 된다.</p></li>
<li><p>LoRa 게이트웨이는 Configuration and Update Service Protocol(CUPS)프로토콜을 사용하는데 이 프로토콜이 게이트웨이 인증서를 관리하기위해서는 IAM role을 추가해줘야한다. 이를 수행하기 위해 <a class="reference external" href="https://docs.aws.amazon.com/iot-wireless/latest/developerguide/what-is-iot-wireless.html">online guide</a> 에 들어가서 Select frequency band and add IAM role항목에 들어가서 가이드를 따라하면 된다.</p></li>
<li><p>RAK7248 LoRaWAN Network Server Guide에서 스크롤을 하면 Configure the Gateway Device 항목이 보이는데 여기서부터 진행하면 된다. putty를 통해 게이트웨이에 로그인 하고 가이드에 있는 명령어를 한 줄씩 입력하면 된다. 이때 파일을 수정해야할 필요가 있는데 &lt;nano ‘수정할 파일명’&gt;을 입력하면 편집기가 열린다. 수정한 다음에 Ctrl+x를 눌러 저정한다. 수정된 파일의 내용을 보려면 &lt;cat ‘파일명’&gt;을 입력하면 편집기를 열지 않아도 바로 볼 수 있다. 또한 11번 단계에서 이전에 만든 인증서를 게이트웨이의 lns-aws폴더에 추가해야하는데 추가할 때 인증서 형식을 정확히 맞춰서 넣어야 오류가 발생하지 않는다.</p></li>
<li><p>4번 과정을 모두 끝내고 게이트웨이에서 basic station을 실행하면 aws iot core에서 게이트웨이의 status가 connected로 되어있는 것을 확인할 수 있다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id16">
<h5>• 디바이스 등록<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h5>
<p>디바이스를 iot core에 추가하고 연결 테스트를 할려면 아두이노와 aws에서 설정을 해줘야 한다.</p>
<ul class="simple">
<li><dl class="simple">
<dt>아두이노 설정</dt><dd><ol class="arabic simple">
<li><p><strong>RAK 4631 guide</strong> 에 들어가서 Quick Start Guide 항목에 들어간다. 그리고 스크롤을 내리면 Connecting RAK4631 to LoRaWAN이 보인다. 이제 이 과정을 따라하면 되는데 region은 KR920, 5번 설정의 nodeDeviceEUI[8], nodeAppEUI[8], nodeAppkey[8]를 본인인 하고싶은 값으로 설정하고 기억해둔다. 그 외의 나머지 항목은 수정하지 않는다.</p></li>
<li><p>코드 수정이 완료되었으면 스크롤을 내려 Uploading the LoRaWAN Code 항목을 찾아서 설치하라는 라이브러리를 설치하면 아두이노에서 필요한 작업은 끝난다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>aws 설정</dt><dd><ol class="arabic simple">
<li><p><strong>RAK 7268 guide</strong> 들어가서 LNS Guide 항목에 들어간다.</p></li>
<li><p>스크롤을 내려 Add a LoRaWAN Device to AWS IoT 항목을 찾아서 가이드 대로 따라한다. 3번, 4번은 가이드를 따라하면서 특별히 설정해줘야 사항들이다.</p></li>
<li><p>Device Profile을 추가할 때, MAC version은 1.0.2로 설정한다.</p></li>
<li><p>Add Device - Configure LoRaWAN device에서 OTAA v1.0.x 선택, DevEUI, Appkey, AppEUI는 아두이노에서 본인이 설정한 값을 입력한다.</p></li>
<li><p>Add Device까지 마무리 했다면 스크롤을 내려 Verifying Operation 항목을 찾아서 lambda function과 Destination Rule을 추가한다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
<p>위의 두 가지 영역에서의 설정을 모두 마쳤으면 연결 테스트를 할 수 있다.</p>
<ul>
<li><dl>
<dt>연결 테스트</dt><dd><ol class="arabic simple">
<li><p>게이트웨이에서 basic station을 실행한다.</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>basicstation/examples/corecell/
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./start-station.sh<span class="w"> </span>—l<span class="w"> </span>./lns-aws
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>아두이노 코드를 컴파일 하고 업로드를 한다.</p></li>
<li><p>iot core에 들어가 Test - MQTT test Client에 들어간다.</p></li>
<li><p>topic filter에 #을 입력하고 구독한다.</p></li>
<li><p>payloadData에 base64로 인코딩된 메세지가 도착한다.</p></li>
<li><p>디코딩 해보면 hello!가 나온다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="id17">
<h4><strong>결과</strong><a class="headerlink" href="#id17" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><dl class="simple">
<dt>rak 7248 게이트웨이 aws iot core에 등록하기</dt><dd><p>–&gt; 성공</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>rak 4631 디바이스 aws iot core에 등록하기</dt><dd><p>–&gt; 성공, MQTT 메세지 보내기도 성공</p>
</dd>
</dl>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="id18">
<h3>01월 26일 - 02월 01일 (설 연휴)<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h3>
<p>재충전</p>
</section>
<hr class="docutils" />
<section id="id19">
<h3>02월 02일 - 02월 08일 (03주차)<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h3>
<section id="id20">
<h4><strong>목표</strong><a class="headerlink" href="#id20" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>DynamoDB Tutorial</p></li>
<li><p>Lambda Tutorial</p></li>
<li><p>device에서 온도 습도 읽어서 Aws IOT core로 보내고 Lambda fuction 사용하여 DB에 저장</p></li>
</ol>
<hr class="docutils" />
<p>참고 링크: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/lorawan-network-server-guide/">RAK7248 가이드</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK7268 가이드</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK1901 가이드</a>, <a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-ddb-rule.html">DynamoDB 문서</a> , <a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-lambda-rule.html">Lambda 문서</a></p>
</section>
<hr class="docutils" />
<section id="id21">
<h4><strong>과정</strong><a class="headerlink" href="#id21" title="Link to this heading">¶</a></h4>
<ul>
<li><p>Tutorial: Storing device data in a DynamoDB table</p>
<blockquote>
<div><ul>
<li><p><a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-ddb-rule.html">DynamoDB 문서</a> 를 그대로 진행한다.</p></li>
<li><p>진행 중 주의사항</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>IMA role 로 만들어낸 role의 policy에 AmazonDynamoDBFullAccess 집어넣으니 진행 되었다. role 생성시 policy가 자동으로 생성 되지 않는 경우도 있으니 주의한다.</p></li>
<li><p>DynamoDB의 table 생성 방법과, IAM rule, IAM policy 사용 방법을 숙지해둔다.</p></li>
</ol>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
<li><p>Tutorial: Formatting a notification by using an AWS Lambda function</p>
<blockquote>
<div><ul>
<li><p><a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-lambda-rule.html">Lambda 문서</a> 를 그대로 진행한다.</p></li>
<li><p>진행 중 주의사항</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>위의 튜토리얼을 진행하기 전에 해야할 사이트가 먼저 존재한다.</p></li>
<li><p>위 문서에서 Tutorial: Sending an Amazon SNS notification 를 찾아 먼저 적용해보되 전화번호로 하면 지출이 발생하므로 email로 진행한다.</p></li>
<li><p>mqtt에서 Publish to a topic에서 ID를 만들어주고 publish 해주면 Subscribe to a topic으로도 같은 내용 전달되고 적용한 이메일로도 같은 내용이 전달된다.</p></li>
</ol>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>이제 다시 <a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-lambda-rule.html">Lambda 문서</a> lamda function으로 돌아가서 진행하자.</dt><dd><ol class="arabic simple">
<li><p>람다 펑션에서 test로 보내기를 해볼건데 iot core에서 rules 만들 때 action에 Amazon SNS-Topics-high_temp_notice_ARN 의 ARN을 action에 추가해준다. 그럼 rules의 action을 통해 람다 함수가 실행된뒤 다시 iot core로 test를 보내준다.</p></li>
<li><p>action은 이후에도 사용할 예정이니 잘 숙지해둔다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p>device에서 온도 습도 읽어서 Aws IOT core로 보내고 MQTT로 확인</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/lorawan-network-server-guide/">RAK7248 가이드</a> 와 <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK7268 가이드</a> 를 참고하여 device의 destination 설정을 완료하고 Message routing-Rules-action-role: IAMrole/LoRaWANRougint 까지 진행 해준다.</p></li>
<li><p>이후 device에서 Aws IOT core 까지 전송된 data 처리를 하기 위해 필요한 과정 중 하나인 LoRaWANRouting에 action으로 MQTT test client로 device에서 전송된 데이터를 주고받기위해 이를 인식할 수 있는 Topic을 가진 Message routing_Rules를 만들었다. 이후 여기에 넣을 IAM_role을 추가하기 위한 IAM_Policies를 추가해줬다. policies의 JSON 코드를 고쳐서 수신가능하게 넣어줘야한다. 그렇지 않으면 device의 destination에 device의 정보가 도착해도 그 어떠한 일도 일어나지 않는다. 그렇기에 rule인 LoRaWANRouting에 action으로 정보를 ‘어떻게’ 할 것인지 결정해줘야 한다. MQTT로 정보를 전달하는 JSON을 policy에 직접 수동으로 주가해서 rule에 집어넣어도 되고 아니면 이미 만들어져 있는 policy를 그대로 rule에 추가해줘도 된다.</p></li>
<li><p>device에서 destinaitin 설정을 할때 rules 에서 LoRaWANRouting을 만들텐데 <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK7268 가이드</a> 에서 Ctrl+F 를 눌러 ‘LoRaWANRouting’을 찾고 2번째 글을 참고해야한다. 둘이 떨어져 있어 자칫하면 설정이 누락될 수 있으니 주의한다.</p></li>
<li><p>온습도 예제를 <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK1901 가이드</a> 에서 찾아 가이드를 따라 진행해준다. MQTT로 전송이 되는 걸 확인하면 성공이다.</p></li>
<li><p>topic:project/sensor/decoded로 전송 될 것이다. 참고로 어떤 topic으로 전송되고 받는지는 IAM policy의 JSON 혹은 Message routing-Rules에서 처음 rule을 생성할때, Lambdafunction을 사용해서 모두 가능하다.</p></li>
</ol>
</div></blockquote>
</li>
<li><p>device에서 온도 습도 읽어서 Aws IOT core로 보내고 Lambda fuction 사용하여 DB에 저장</p>
<blockquote>
<div><ul>
<li><dl class="simple">
<dt>전체 과정</dt><dd><ol class="arabic simple">
<li><p>device data– 아두이노 코드 – aws 서버 – MQTT 서버로 이동</p></li>
<li><p>AWS IoT/Message routing/Rules/LoRaWANRouting(device의 destination에 있음) destination에서 어떤 역할을 할지 정해주는게 추가할 action</p></li>
<li><p>LoRaWANRouting의 action1 에 Republish to AWS IoT topic 설정</p></li>
<li><p>mqtt 서버(topic:project/sensor/decoded) 보냄</p></li>
<li><p>LoRaWANRouting의 action2 에 Lambdafunction(role(policy)) 작동, 이후 MQTT로 data 받으면 디코딩해서 topic:project/sensor/output으로 송신</p></li>
<li><p>DB table로 rule인 send_to_DB_rule(role(policy(topic:project/sensor/output 내용을 받아서 db로 자동으로 보냄)))</p></li>
<li><p>DB table에 저장되는 것을 DynamoDB consol 에서 확인 할 수 있다.</p></li>
</ol>
</dd>
</dl>
</li>
<li><dl>
<dt>추가 사항 Aduino</dt><dd><ol class="arabic simple">
<li><p>아두이노에서 기본적으로 제공되는 온습도 예제와 전송 코드를 사용해야한다.</p></li>
<li><p>도구/보드:WisBlock RAK4631/RAKwireless nRF Boards/WisBlock RAK4631 보드 선택</p></li>
<li><p>파일/예제/RAK WisBlock examples/RAK4631/Communications/LoRa/LoRaWAN/LoRaWAN_OTAA_ABP 송신 예제를 열어준다.</p></li>
<li><p>파일/예제/RAK WisBlock examples/RAK4631/Sensors/RAK 1901_Temperatiure_Humidity_SHTC3 온습도 예제를 열어준다.</p></li>
<li><p>코드를 사용하여 적절히 만들어준다.</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">send_lora_frame</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lmh_join_status_get</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">LMH_SET</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Not joined, try again later</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">memset</span><span class="p">(</span><span class="n">m_lora_app_data</span><span class="p">.</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">LORAWAN_APP_DATA_BUFF_SIZE</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_lora_app_data</span><span class="p">.</span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gAppPort</span><span class="p">;</span>
<span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">  </span><span class="c1">//온도 데이터 전송</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_shtc3</span><span class="p">.</span><span class="n">toDegC</span><span class="p">();</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">tem</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">tem</span><span class="p">,</span><span class="s">&quot;%.2f&quot;</span><span class="p">,</span><span class="n">temp</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">tem</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_lora_app_data</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tem</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w">  </span><span class="c1">// 문자 한 개씩 전송</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1">//구분자</span>
<span class="w">  </span><span class="n">m_lora_app_data</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;|&#39;</span><span class="p">;</span>
<span class="w">  </span><span class="c1">//습도 데이터 전송</span>
<span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">humi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g_shtc3</span><span class="p">.</span><span class="n">toPercent</span><span class="p">();</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="w">  </span><span class="n">sprintf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="s">&quot;%.2f&quot;</span><span class="p">,</span><span class="n">humi</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;\0&#39;</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_lora_app_data</span><span class="p">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w">  </span><span class="c1">// 문자 한 개씩 전송</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="n">m_lora_app_data</span><span class="p">.</span><span class="n">buffsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">  </span><span class="c1">// 데이터 크기 설정</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>추가 사항 Lambda</dt><dd><ol class="arabic simple">
<li><p>Aws IOT core consol에서 Manage/LPWAN devices/Destinations 설정과, Message routing/Rules/LoRaWANRouting 설정이 다 되어 있는 상태여야한다.</p></li>
<li><p>LoRaWANRouting에 새로운 action2 를 만들어주고 이에 해당되는 Lambdafunction을 만들어준다. Lambdafunction을 미리 만들어도 되고 나중에 추가해줘도 된다. Bluprint 설정과 Hello에 python을 설정해주는것을 잊지말자.</p></li>
<li><p>Lambdafunction을 만들었으면 rule을 추가해줘야한다. rule에는 role이 들어가고 role에는 DynamoDB로 전송해주는 Policy를 추가해줘야한다. IAM role의 roles와 policies에서 새롭게 만들거나 기존에 동일한 기능을 하는 것이 있는 경우 같은 것을 사용해도 무방하다.</p></li>
<li><p>Lambdafunction에 코드를 추가해줘야한다. 코드는 원하는 것을 사용해도 되나 여기선 python을 사용한다.</p></li>
<li><p>우리는 아두이노에서 MQTT로 송신하는 data를 받아서 Lambda에서 가공할 것이다. 다만 아두이노에서 전송할때 숫자형으로 보내는 것이 안 되어 자료형으로 바꾸어 전송했고 구분자를 두어 온도, 습도를 구분했다.</p></li>
<li><p>코드 예시는 다음과 같다.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># PayloadData 디코딩</span>
<span class="k">if</span> <span class="s2">&quot;PayloadData&quot;</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
    <span class="n">decoded_payload</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;PayloadData&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Decoded Payload: </span><span class="si">{</span><span class="n">decoded_payload</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># temperature랑 humidity 분리</span>
      <span class="k">if</span> <span class="s2">&quot;|&quot;</span> <span class="ow">in</span> <span class="n">decoded_payload</span><span class="p">:</span>  <span class="c1"># 구분자가 있을 때만 분리</span>
          <span class="n">temp</span><span class="p">,</span> <span class="n">humi</span> <span class="o">=</span> <span class="n">decoded_payload</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># &#39;|&#39; 구분자로 분리</span>
       <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;temp: </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">, humi: </span><span class="si">{</span><span class="n">humi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
          <span class="c1"># 혹시라도 안 될때 긴급조치</span>
       <span class="n">temp</span> <span class="o">=</span> <span class="n">decoded_payload</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># 숫자 &quot;10&quot;</span>
       <span class="n">humi</span> <span class="o">=</span> <span class="n">decoded_payload</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>  <span class="c1"># 나머지 문자열 &quot;:humi&quot;</span>

   <span class="c1"># humidity 뒤에 &quot;%&quot; 추가</span>
   <span class="n">humi</span> <span class="o">=</span> <span class="n">humi</span> <span class="o">+</span> <span class="s2">&quot; %&quot;</span>  <span class="c1"># &quot;%&quot;</span>
      <span class="c1"># temp 뒤에 &quot;def C&quot; 추가</span>
      <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="s2">&quot; deg C&quot;</span>  <span class="c1"># &quot;deg C&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>추가 사항 DynamoDB</dt><dd><ol class="arabic simple">
<li><p>DynamoDB consol에서 table 을 만들어준다.</p></li>
<li><p>여기서는 Lambdafunction 에서 바로 가공한 data를 보내는 것이 아니라 다시 특정 topic MQTT로 전송된 데이터를 IOT core가 다시 DB table로 보낼 수 있게 해준다.</p></li>
<li><p>따라서 IOT core 의 Message routing/Rules 에 새로운 rule 을 추가하여 특정 topic으로 data를 받은 IOT core가 지저오딘 DynamoDB의 table로 data를 저장할 수 있게 해준다.</p></li>
<li><p>rule에 들어갈 SQL구문에 rule이 받는 Topic을 FROM으로 지정해주고, action에 DynamoDB를 추가하여 IOT core가 data를 전송 할 수 있게 한다. 예시: (SELECT temp, humi FROM ‘project/sensor/output’)</p></li>
<li><p>rule에 들어갈 Policy는 이미 AWS에서 제공하고 있으므로 aws-iot-rule-send_to_DB_rule-action-1-role-send_to_DB_rule_role을 그대로 사용하면 된다.</p></li>
<li><p>정상적으로 설정이 완료되었다면 Aduino code에 따라 DynamoDB의 특정 table로 데이터가 저장되는 것을 확인할 수 있다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="id22">
<h4><strong>결과</strong><a class="headerlink" href="#id22" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><dl class="simple">
<dt>DynamoDB Tutorial</dt><dd><p>→ 성공</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Lambda Tutorial</dt><dd><p>→ 성공</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>device에서 온도 습도 읽어서 Aws IOT core로 보내고 Lambda fuction 사용하여 DB에 저장</dt><dd><p>→ 성공</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>device에서 온도 습도 읽어서 Aws IOT core로 보내고 Lambda fuction 사용하여 DB에 저장</dt><dd><p>→ 성공</p>
</dd>
</dl>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="id23">
<h3>결산<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><dl>
<dt>단말장치 개발</dt><dd><div class="line-block">
<div class="line"><strong>• 설정된 주기로 온도 습도 데이터를 수집해 서버로 전송</strong></div>
<div class="line-block">
<div class="line">–&gt; rak 4630, rak 1901을 사용하여 개발 완료</div>
</div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>게이트웨이 개발</dt><dd><div class="line-block">
<div class="line"><strong>• 단말장치가 전송하는 데이터를 MQTT 프로토콜을 사용해 서버로 전달</strong></div>
<div class="line">–&gt; rak 7248을 사용하여 개발 완료</div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>서버 개발</dt><dd><div class="line-block">
<div class="line"><strong>• 단말장치들이 전송하는 데이터를 받아서 데이터베이스에 저장</strong></div>
<div class="line"><strong>• 저장된 데이터 그래프로 시각화</strong></div>
<div class="line-block">
<div class="line">–&gt; lambda function과 DynamoDB를 사용해 데이터 저장기능 개발 완료</div>
<div class="line">–&gt; 그래프로 시각화는 미구현</div>
</div>
</div>
</dd>
</dl>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="id24">
<h3>기타<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h3>
<br><hr class="docutils" />
</section>
</section>
<section id="sprt-03-06-rx004-02">
<span id="research-note-004016-2025-0112-0208-sprt-03-06-rx004-group02"></span><h2>연구 노트 2025_0112_0208_SPRT_03_06 RX004 02조<a class="headerlink" href="#sprt-03-06-rx004-02" title="Link to this heading">¶</a></h2>
<section id="id25">
<h3>개요<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h3>
<p>AWS IOT Core에 RAK4630을 디바이스로 등록하고
RAK7248을 게이트웨이로 등록하여 LoRaWAN으로 연결한다.
RAK4630에서 보낸 온, 습도 값을 MQTT로 받아 Lambda함수로 보낸다.
Lambda함수에서 값을 뽑아 DynamoDB로 보낸 후 데이터를 쌓는다.</p>
</section>
<hr class="docutils" />
<section id="id26">
<h3>01월 12일 - 01월 18일 (01주차)<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h3>
<p>RAK11310 사전 준비</p>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak11310/quickstart/">RAK11310</a></p>
<p>1.아두이노 IDE를 다운받는다.</p>
<p>2.RAK1901을 RAK11310에 부착한다.</p>
<p>3.Arduino IDE를 연다. 환경 설정으로 간다.</p>
<p>4.Arduino Boards 목록에 WisBlock Core를 추가하려면 추가 Board Manager URL을 편집해야 한다.</p>
<p>5.이 URL을 복사하여 <a class="reference external" href="https://raw.githubusercontent.com/RAKwireless/RAKwireless-Arduino-BSP-Index/main/package_rakwireless_index">https://raw.githubusercontent.com/RAKwireless/RAKwireless-Arduino-BSP-Index/main/package_rakwireless_index</a>.json그림 에 표시된 대로 필드에 붙여넣는다. 다른 URL이 이미 있는 경우 다음 줄에 추가하기만 하면 된다. URL을 추가한 후 확인을 클릭한다.</p>
<p><a class="reference internal" href="#figure-005-01-arduino"><span class="std std-numref">그림 55</span></a> URL추가하는 부분</p>
<figure class="align-center" id="id67">
<span id="figure-005-01-arduino"></span><a class="reference internal image-reference" href="_images/figure_004137_Arduino.png"><img alt="URL추가" src="_images/figure_004137_Arduino.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 55 </span><span class="caption-text">URL추가</span><a class="headerlink" href="#id67" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>6.Arduino IDE를 다시 시작한다. 도구 메뉴에서 보드 관리자를 연다.</p>
<p>7.그러면 Arduino 보드 목록에 추가할 수 있는 사용 가능한 RAKwireless WisBlock Core 보드가 표시된다. 보유한 WisBlock Core를 선택하고 드롭다운 목록에서 업데이트된 버전을 선택한 다음 설치를 클릭한다. (RAKwireless RP Boards)</p>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK1901</a></p>
<p>1.먼저, 자신이 가지고 있는 WisBlock Core를 선택해야 한다. (RAK11310)</p>
<p>2.SparkFun SHTC3 라이브러리를 설치한다 .</p>
<p>3.올바른 직렬 포트를 선택하고 코드를 업로드할 수 있다.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;SparkFun_SHTC3.h&quot;       //Click here to get the library: http://librarymanager/All#SparkFun_SHTC3</span>

SHTC3<span class="w"> </span>g_shtc3<span class="p">;</span><span class="w">                        </span>//<span class="w"> </span>Declare<span class="w"> </span>an<span class="w"> </span>instance<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>SHTC3<span class="w"> </span>class

void<span class="w"> </span>errorDecoder<span class="o">(</span>SHTC3_Status_TypeDef<span class="w"> </span>message<span class="o">)</span><span class="w">   </span>//<span class="w"> </span>The<span class="w"> </span>errorDecoder<span class="w"> </span><span class="k">function</span><span class="w"> </span>prints<span class="w"> </span><span class="s2">&quot;SHTC3_Status_TypeDef&quot;</span><span class="w"> </span>resultsin<span class="w"> </span>a<span class="w"> </span>human-friendly<span class="w"> </span>way
<span class="o">{</span>
switch<span class="w"> </span><span class="o">(</span>message<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>SHTC3_Status_Nominal:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Nominal&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>SHTC3_Status_Error:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Error&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>SHTC3_Status_CRC_Fail:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;CRC Fail&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span>default:
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Unknown return code&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>shtc3_read_data<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>float<span class="w"> </span><span class="nv">Temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="w">    </span>float<span class="w"> </span><span class="nv">Humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>

<span class="w">    </span>g_shtc3.update<span class="o">()</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.lastStatus<span class="w"> </span><span class="o">==</span><span class="w"> </span>SHTC3_Status_Nominal<span class="o">)</span><span class="w"> </span>//<span class="w"> </span>You<span class="w"> </span>can<span class="w"> </span>also<span class="w"> </span>assess<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>last<span class="w"> </span><span class="nb">command</span><span class="w"> </span>by<span class="w"> </span>checking<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;.lastStatus&quot;</span><span class="w"> </span>member<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>object
<span class="w">    </span><span class="o">{</span>

<span class="w">        </span><span class="nv">Temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toDegC<span class="o">()</span><span class="p">;</span><span class="w">                   </span>//<span class="w"> </span>Packing<span class="w"> </span>LoRa<span class="w"> </span>data
<span class="w">        </span><span class="nv">Humidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toPercent<span class="o">()</span><span class="p">;</span>

<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;RH = &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.print<span class="o">(</span>g_shtc3.toPercent<span class="o">())</span><span class="p">;</span><span class="w">                </span>//<span class="w"> </span><span class="s2">&quot;toPercent&quot;</span><span class="w"> </span>returns<span class="w"> </span>the<span class="w"> </span>percent<span class="w"> </span>humidity<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>floating<span class="w"> </span>point<span class="w"> </span>number
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;% (checksum: &quot;</span><span class="o">)</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.passRHcrc<span class="o">)</span><span class="w">                               </span>//<span class="w"> </span>Like<span class="w"> </span><span class="s2">&quot;passIDcrc&quot;</span><span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span><span class="w"> </span>when<span class="w"> </span>the<span class="w"> </span>RH<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>sensor<span class="w"> </span><span class="o">(</span>but<span class="w"> </span>not<span class="w"> </span>necessarily<span class="w"> </span>up-to-date<span class="w"> </span><span class="k">in</span><span class="w"> </span>terms<span class="w"> </span>of<span class="w"> </span><span class="nb">time</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;pass&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;fail&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>

<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;), T = &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.print<span class="o">(</span>g_shtc3.toDegC<span class="o">())</span><span class="p">;</span><span class="w">                  </span>//<span class="w"> </span><span class="s2">&quot;toDegF&quot;</span><span class="w"> </span>and<span class="w"> </span><span class="s2">&quot;toDegC&quot;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span>the<span class="w"> </span>temperature<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>flaoting<span class="w"> </span>point<span class="w"> </span>number<span class="w"> </span><span class="k">in</span><span class="w"> </span>deg<span class="w"> </span>F<span class="w"> </span>and<span class="w"> </span>deg<span class="w"> </span>C<span class="w"> </span>respectively
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot; deg C (checksum: &quot;</span><span class="o">)</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.passTcrc<span class="o">)</span><span class="w">                               </span>//<span class="w"> </span>Like<span class="w"> </span><span class="s2">&quot;passIDcrc&quot;</span><span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span><span class="w"> </span>when<span class="w"> </span>the<span class="w"> </span>T<span class="w"> </span>value<span class="w"> </span>is<span class="w"> </span>valid<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>sensor<span class="w"> </span><span class="o">(</span>but<span class="w"> </span>not<span class="w"> </span>necessarily<span class="w"> </span>up-to-date<span class="w"> </span><span class="k">in</span><span class="w"> </span>terms<span class="w"> </span>of<span class="w"> </span><span class="nb">time</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;pass&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>Serial.print<span class="o">(</span><span class="s2">&quot;fail&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;)&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Update failed, error: &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>errorDecoder<span class="o">(</span>g_shtc3.lastStatus<span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.println<span class="o">()</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>setup<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>time_t<span class="w"> </span><span class="nv">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>millis<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>Serial.begin<span class="o">(</span><span class="m">115200</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="o">(</span>!Serial<span class="o">)</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">((</span>millis<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>timeout<span class="o">)</span><span class="w"> </span>&lt;<span class="w"> </span><span class="m">5000</span><span class="o">)</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span>delay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>

<span class="w">    </span>Wire.begin<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;shtc3 init&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>Serial.print<span class="o">(</span><span class="s2">&quot;Beginning sensor. Result = &quot;</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>Most<span class="w"> </span>SHTC3<span class="w"> </span>functions<span class="w"> </span><span class="k">return</span><span class="w"> </span>a<span class="w"> </span>variable<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="s2">&quot;SHTC3_Status_TypeDef&quot;</span><span class="w"> </span>to<span class="w"> </span>indicate<span class="w"> </span>the<span class="w"> </span>status<span class="w"> </span>of<span class="w"> </span>their<span class="w"> </span>execution
<span class="w">    </span>errorDecoder<span class="o">(</span>g_shtc3.begin<span class="o">())</span><span class="p">;</span><span class="w">              </span>//<span class="w"> </span>To<span class="w"> </span>start<span class="w"> </span>the<span class="w"> </span>sensor<span class="w"> </span>you<span class="w"> </span>must<span class="w"> </span>call<span class="w"> </span><span class="s2">&quot;begin()&quot;</span>,<span class="w"> </span>the<span class="w"> </span>default<span class="w"> </span>settings<span class="w"> </span>use<span class="w"> </span>Wire<span class="w"> </span><span class="o">(</span>default<span class="w"> </span>Arduino<span class="w"> </span>I2C<span class="w"> </span>port<span class="o">)</span>
<span class="w">    </span>Wire.setClock<span class="o">(</span><span class="m">400000</span><span class="o">)</span><span class="p">;</span><span class="w">                            </span>//<span class="w"> </span>The<span class="w"> </span>sensor<span class="w"> </span>is<span class="w"> </span>listed<span class="w"> </span>to<span class="w"> </span>work<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span><span class="m">1</span><span class="w"> </span>MHz<span class="w"> </span>I2C<span class="w"> </span>speed,<span class="w"> </span>but<span class="w"> </span>the<span class="w"> </span>I2C<span class="w"> </span>clock<span class="w"> </span>speed<span class="w"> </span>is<span class="w"> </span>global<span class="w"> </span><span class="k">for</span><span class="w"> </span>all<span class="w"> </span>sensors<span class="w"> </span>on<span class="w"> </span>that<span class="w"> </span>bus<span class="w"> </span>so<span class="w"> </span>using<span class="w"> </span>400kHz<span class="w"> </span>or<span class="w"> </span>100kHz<span class="w"> </span>is<span class="w"> </span>recommended
<span class="w">    </span>Serial.println<span class="o">()</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.passIDcrc<span class="o">)</span><span class="w">                      </span>//<span class="w"> </span>Whenever<span class="w"> </span>data<span class="w"> </span>is<span class="w"> </span>received<span class="w"> </span>the<span class="w"> </span>associated<span class="w"> </span>checksum<span class="w"> </span>is<span class="w"> </span>calculated<span class="w"> </span>and<span class="w"> </span>verified<span class="w"> </span>so<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>sure<span class="w"> </span>the<span class="w"> </span>data<span class="w"> </span>is<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span><span class="o">{</span><span class="w">                                                        </span>//<span class="w"> </span>The<span class="w"> </span>checksum<span class="w"> </span>pass<span class="w"> </span>indicators<span class="w"> </span>are:<span class="w"> </span>passIDcrc,<span class="w"> </span>passRHcrc,<span class="w"> </span>and<span class="w"> </span>passTcrc<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>ID,<span class="w"> </span>RH,<span class="w"> </span>and<span class="w"> </span>T<span class="w"> </span>readings<span class="w"> </span>respectively
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;ID Passed Checksum. &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.print<span class="o">(</span><span class="s2">&quot;Device ID: 0b&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span>Serial.println<span class="o">(</span>g_shtc3.ID,<span class="w"> </span>BIN<span class="o">)</span><span class="p">;</span><span class="w">             </span>//<span class="w"> </span>The<span class="w"> </span><span class="m">16</span>-bit<span class="w"> </span>device<span class="w"> </span>ID<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>accessed<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>member<span class="w"> </span>variable<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>object
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;ID Checksum Failed. &quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>loop<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>shtc3_read_data<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>delay<span class="o">(</span><span class="m">1000</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-exam"><span class="std std-numref">그림 56</span></a> 온,습도 예제 업로드 결과​</p>
<figure class="align-center" id="id68">
<span id="figure-005-01-exam"></span><a class="reference internal image-reference" href="_images/figure_004145_exam.png"><img alt="실행결과" src="_images/figure_004145_exam.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 56 </span><span class="caption-text">실행결과</span><a class="headerlink" href="#id68" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>RAK7248 사전 준비</p>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/quickstart/">RAK7248</a></p>
<blockquote>
<div><p>1.RAK7248의 초기 설정은 AP모드 이므로 노트북으로 게이트웨이에 putty에 RAK7248의 기본 ip인 192.168.230.1로 접근 한다.</p>
<p>2.이후 사용자 이름: pi 비밀번호:raspberry를 입력하여 로그인 한 후, sudo gateway-config를 입력하여 게이트웨이 설정으로 이동한다.</p>
<p>3.이후 거주 국가를 선택한다. ap모드를 해제한 후 클라이언트 모드로 변경한다. 이후 연결할 와이파이 SSID와 비밀번호를 입력한다.</p>
<p>4.이제 와이파이에 연결된 RAK7248의 ip주소를 putty에 입력하면 콘솔에 접근할 수 있다.</p>
</div></blockquote>
</section>
<hr class="docutils" />
<section id="id29">
<h3>01월 19일 - 01월 25일 (02주차)<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://aws.amazon.com/ko/pm/dynamodb/">DynamoDB 콘솔</a></p>
<p><a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-ddb-rule.html">DynamoDB 자습서</a> 를 수행하여 DynamoDB가 무엇인지와 사용하는 방법을 공부하였다.</p>
<p>DynamoDB 테이블 생성</p>
<blockquote>
<div><p>AWS IoT Core에서 데이터를 저장할 DynamoDB 테이블을 생성한다.</p>
<p>1.dynamoDB 콘솔 &lt;<a class="reference external" href="https://aws.amazon.com/ko/pm/dynamodb/">https://aws.amazon.com/ko/pm/dynamodb/</a>&gt;_ 에 접속한다.
2.새 테이블 생성(Create Table) 을 선택한다.
3.테이블 키 구성:</p>
<blockquote>
<div><p>Partition Key: sample_time (String)</p>
<p>Sort Key: device_id (String)</p>
<p>속성 추가: device_data (String)</p>
</div></blockquote>
<p>4.생성 완료 후, AWS IoT Core에서 데이터를 저장할 수 있도록 IAM 역할 및 정책을 설정한다.</p>
</div></blockquote>
<p><a class="reference internal" href="#figure-005-01-dynamo-db1"><span class="std std-numref">그림 57</span></a> DynamoDB 테이블 생성</p>
<figure class="align-center" id="id69">
<span id="figure-005-01-dynamo-db1"></span><a class="reference internal image-reference" href="_images/figure_004142_DynamoDB1.png"><img alt="DynamoDB테이블" src="_images/figure_004142_DynamoDB1.png" style="width: 600px; height: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">그림 57 </span><span class="caption-text">DynamoDB테이블</span><a class="headerlink" href="#id69" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>AWS IoT Core에서 수신한 MQTT 메시지를 DynamoDB에 저장하는 규칙을 생성한다.</p>
<p>1.AWS IoT 콘솔에서 메시지 라우팅 &gt; 규칙(Rules) 로 이동한다.</p>
<p>2.규칙 생성(Create Rule) 을 선택한다.</p>
<p>3.규칙 세부 정보 입력:</p>
<blockquote>
<div><p>Rule Name: IoTToDynamoDB
SQL Statement:</p>
</div></blockquote>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">sample_time</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">device_data</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;iot/sensor/data&#39;</span>
</pre></div>
</div>
<p>4.Set actions 단계에서 DynamoDBv2 를 선택하고, 다음을 입력한다:</p>
<blockquote>
<div><p>Table Name: 생성한 DynamoDB 테이블 선택
Hash Key: sample_time → ${sample_time}
Sort Key: device_id → ${device_id}</p>
</div></blockquote>
<p>IAM Role: AWS IoT Core가 DynamoDB에 데이터를 삽입할 수 있도록 설정한 IAM 역할 적용</p>
<p><a class="reference internal" href="#figure-005-01-dynamo-db2"><span class="std std-numref">그림 58</span></a> DynamoDB에 데이터를 전송하는 AWS IoT 규칙 생성​</p>
<figure class="align-center" id="id70">
<span id="figure-005-01-dynamo-db2"></span><a class="reference internal image-reference" href="_images/figure_004143_DynamoDB2.png"><img alt="규칙생성" src="_images/figure_004143_DynamoDB2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 58 </span><span class="caption-text">규칙생성</span><a class="headerlink" href="#id70" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-dynamo-db3"><span class="std std-numref">그림 59</span></a> DynamoDB 테이블 테스트</p>
<p>AWS IoT Core에서 DynamoDB로 데이터가 정상적으로 저장되는지 테스트한다.</p>
<blockquote>
<div><p>1.AWS IoT 콘솔에서 MQTT Test 클라이언트 를 실행한다.
2.다음과 같은 JSON 메시지를 iot/sensor/data 주제로 게시한다:</p>
</div></blockquote>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">   </span><span class="nt">&quot;sample_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-02-27T12:00:00Z&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;device_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sensor_001&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nt">&quot;device_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;temperature:22.5,humidity:60&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>3.DynamoDB 콘솔에서 해당 테이블을 조회하고 데이터가 정상적으로 저장되었는지 확인한다.</p>
<figure class="align-center" id="id71">
<span id="figure-005-01-dynamo-db3"></span><a class="reference internal image-reference" href="_images/figure_004144_DynamoDB3.png"><img alt="실행결과" src="_images/figure_004144_DynamoDB3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 59 </span><span class="caption-text">실행결과</span><a class="headerlink" href="#id71" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Lambda 함수</p>
<p><a class="reference external" href="https://aws.amazon.com/ko/lambda/">Lambda 콘솔</a></p>
<p><a class="reference external" href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/getting-started.html">Lambda 함수 생성</a> 여기서 예제를 수행하여 Lambda함수를 사용하는 법을 공부.</p>
<p>1.Lambda 콘솔의 함수 페이지를 연다.</p>
<p>2.함수 생성을 선택한다.</p>
<p>3.새로 작성을 선택한다.</p>
<p>4.기본 정보 창의 함수 이름에 myLambdaFunction을 입력한다.</p>
<p>5.런타임에서 Node.js 22.x 또는 Python 3.13을 선택한다.</p>
<p>6.아키텍처를 x86_64로 설정된 상태로 두고 함수 생성을 선택한다.</p>
<p>7.아래 코드를 넣는다.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span>const<span class="w"> </span><span class="nv">handler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>async<span class="w"> </span><span class="o">(</span>event,<span class="w"> </span>context<span class="o">)</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>

const<span class="w"> </span><span class="nv">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>event.length<span class="p">;</span>
const<span class="w"> </span><span class="nv">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>event.width<span class="p">;</span>
<span class="nb">let</span><span class="w"> </span><span class="nv">area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>calculateArea<span class="o">(</span>length,<span class="w"> </span>width<span class="o">)</span><span class="p">;</span>
console.log<span class="o">(</span><span class="sb">`</span>The<span class="w"> </span>area<span class="w"> </span>is<span class="w"> </span><span class="si">${</span><span class="nv">area</span><span class="si">}</span><span class="sb">`</span><span class="o">)</span><span class="p">;</span>

console.log<span class="o">(</span><span class="s1">&#39;CloudWatch log group: &#39;</span>,<span class="w"> </span>context.logGroupName<span class="o">)</span><span class="p">;</span>

<span class="nb">let</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;area&quot;</span>:<span class="w"> </span>area,
<span class="o">}</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>JSON.stringify<span class="o">(</span>data<span class="o">)</span><span class="p">;</span>

<span class="k">function</span><span class="w"> </span>calculateArea<span class="o">(</span>length,<span class="w"> </span>width<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>length<span class="w"> </span>*<span class="w"> </span>width<span class="p">;</span>
<span class="o">}</span>
<span class="o">}</span><span class="p">;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-lambda1"><span class="std std-numref">그림 60</span></a> 람다함수를 생성하여 예제코드를 넣은 모습</p>
<figure class="align-center" id="id72">
<span id="figure-005-01-lambda1"></span><a class="reference internal image-reference" href="_images/figure_004149_Lambda1.png"><img alt="Lambda예제코드" src="_images/figure_004149_Lambda1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 60 </span><span class="caption-text">Lambda예제코드</span><a class="headerlink" href="#id72" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>8.Deploy 섹션에서 Deploy를 선택하여 함수의 코드를 업데이트한다.</p>
<p>9.콘솔 코드 편집기의 테스트 이벤트 섹션에서 테스트 이벤트 생성을 선택한다.</p>
<p>10.Event Name(이벤트 이름)에 myTestEvent를 입력한다.</p>
<p>11.이벤트 JSON 섹션에서 기본 JSON을 다음으로 바꾼다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;length&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
<span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">7</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-lambda2"><span class="std std-numref">그림 61</span></a> 함수에 전송할 테스트 이벤트​</p>
<figure class="align-center" id="id73">
<span id="figure-005-01-lambda2"></span><a class="reference internal image-reference" href="_images/figure_004150_Lambda2.png"><img alt="Lambda테스트이벤트" src="_images/figure_004150_Lambda2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 61 </span><span class="caption-text">Lambda테스트이벤트</span><a class="headerlink" href="#id73" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>12.콘솔 코드 편집기의 테스트 이벤트 섹션에서 테스트 이벤트 옆에 있는 실행 아이콘을 선택한다.</p>
<p><a class="reference internal" href="#figure-005-01-lambda3"><span class="std std-numref">그림 62</span></a> 실행결과 화면</p>
<figure class="align-center" id="id74">
<span id="figure-005-01-lambda3"></span><a class="reference internal image-reference" href="_images/figure_004151_Lambda3.png"><img alt="실행결과" src="_images/figure_004151_Lambda3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 62 </span><span class="caption-text">실행결과</span><a class="headerlink" href="#id74" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>13.CloudWatch 콘솔에서 로그 그룹 페이지를 연다.</p>
<p>14.함수에 대한 로그 그룹(/aws/lambda/myLambdaFunction)을 선택한다. 이는 함수가 콘솔에 인쇄한 로그 그룹 이름이다.</p>
<p>15.아래로 스크롤하고 확인하고자 하는 함수 간접 호출의 로그 스트림을 선택한다.</p>
<p><a class="reference internal" href="#figure-005-01-lambda4"><span class="std std-numref">그림 63</span></a> CloudWatch Logs에서 함수의 간접 호출 레코드 보기​</p>
<figure class="align-center" id="id75">
<span id="figure-005-01-lambda4"></span><a class="reference internal image-reference" href="_images/figure_004152_Lambda4.png"><img alt="CloudWatch Logs" src="_images/figure_004152_Lambda4.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 63 </span><span class="caption-text">CloudWatch Logs</span><a class="headerlink" href="#id75" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="id34">
<h3>01월 26일 - 02월 01일 (설 연휴)<a class="headerlink" href="#id34" title="Link to this heading">¶</a></h3>
<p>재충전</p>
</section>
<hr class="docutils" />
<section id="id35">
<h3>02월 02일 - 02월 08일 (03주차)<a class="headerlink" href="#id35" title="Link to this heading">¶</a></h3>
<p>RAK11310보드를 RAK4630보드로 교체했다.</p>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisduo/rak4630-module/quickstart/">RAK4630</a></p>
<p>1.Arduino IDE를 엽니다.</p>
<p>2.도구 메뉴 에서 보드 관리자를 엽니다. 최신 버전의 RAKwireless RUI nRF 보드를 선택하여 설치합니다.</p>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK1901</a></p>
<p>보드와 직렬포트를 선택하고 위의 온,습도 예제코드를 업로드한다.</p>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">aws iot core에 새로운 게이트웨이 등록</a>
<a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/lorawan-network-server-guide/">RAK7248 게이트웨이 등록</a></p>
<p>LoRaWAN을 위해 AWS IoT Core에 게이트웨이를 등록하려면 다음 단계를 실행하세요.</p>
<p>1.AWS IoT 콘솔 로 이동합니다.</p>
<p>2.왼쪽 탐색 패널에서 LPWAN 장치를 선택하세요.</p>
<p>3.게이트웨이를 선택한 다음 게이트웨이 추가를 클릭합니다.</p>
<p>4.게이트웨이 추가 섹션 에서 게이트웨이의 EUI 및 주파수 대역(RF 지역) 필드를 입력합니다.</p>
<p>5.이름 : 선택 필드 에 설명적 이름을 입력합니다 . 이름으로 GatewayEUI를 사용하는 것이 좋습니다.</p>
<p>6.게이트웨이 추가를 클릭합니다.</p>
<p>7.게이트웨이 구성 페이지 에서 게이트웨이 인증서 라는 섹션을 찾으세요.</p>
<p>8.인증서 만들기를 선택하세요.</p>
<p>9.인증서가 생성되어 게이트웨이 메시지와 연결 되면 인증서 파일 다운로드를 선택하여 인증서( xxxxx.cert.pem )와 개인 키( xxxxxx.private.key )를 다운로드합니다.</p>
<p>10.자격 증명 프로비저닝 섹션에서 서버 신뢰 인증서 다운로드를 선택하여 CUPS(cups.trust) 및 LNS(lns.trust) 서버 신뢰 인증서를 다운로드합니다.</p>
<p>11.CUPS 및 LNS 엔드포인트를 복사하여 .txt게이트웨이를 구성하는 동안 사용할 파일에 저장합니다.</p>
<p>12.제출을 선택하여 게이트웨이를 추가합니다.</p>
<p><a class="reference internal" href="#figure-005-01-cups"><span class="std std-numref">그림 64</span></a> 인증서 파일들</p>
<figure class="align-center" id="id76">
<span id="figure-005-01-cups"></span><a class="reference internal image-reference" href="_images/figure_004136_0205-3.png"><img alt="인증서 파일들" src="_images/figure_004136_0205-3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 64 </span><span class="caption-text">인증서 파일들</span><a class="headerlink" href="#id76" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>게이트웨이 디바이스 구성</p>
<p>1.LoRaWAN용 AWS IoT Core에 연결하려면 BasicsStation을 다운로드하고 컴파일해야 합니다. SSH를 통해 게이트웨이에 성공적으로 액세스했다고 가정하면 업데이트/업그레이드하는 것이 좋은 정책입니다. 그렇게 하면 모든 패키지가 최신 상태로 유지됩니다:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>upgrade
</pre></div>
</div>
</div></blockquote>
<p>2.이제 LoRaWAN용 AWS IoT Core에서 게이트웨이를 등록합니다. 게이트웨이를 등록하려면 장치의 EUI가 필요합니다. 게이트웨이의 EUI를 찾으려면 아래 명령을 실행하여 그래픽 사용자 인터페이스(GUI)를 엽니다. EUI는 GUI 상단에서 찾을 수 있습니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>gateway-config
</pre></div>
</div>
<p>또한 다음 명령을 실행하여 게이트웨이 버전을 확인할 수도 있습니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>gateway-version
</pre></div>
</div>
<p>출력 예시:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Raspberry Pi 4 Model B Rev 1.1, OS &quot;10 (buster)&quot;, 5.4.79-v7l+.
RAKwireless gateway RAK7248 no LTE version 4.2.7R install from firmware
Gateway ID: DCA632FFFE366417
</pre></div>
</div>
<p>기본 스테이션(Basics Station) 구성</p>
<p>3.Basics Station 저장소를 복제하고 다운로드한 폴더로 이동합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/lorabasics/basicstation.git
<span class="nb">cd</span><span class="w"> </span>basicstation
</pre></div>
</div>
<p>4.모든 종속성을 설치합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span><span class="nv">platform</span><span class="o">=</span>corecell<span class="w"> </span><span class="nv">variant</span><span class="o">=</span>std
</pre></div>
</div>
<p>5.특정 파일을 복사하여 교체합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>cp<span class="w"> </span>-f<span class="w"> </span>/opt/ttn-gateway/sx1302_hal/libloragw/src/loragw_stts751.c<span class="w"> </span>deps/lgw1302/platform-corecell/libloragw/src/loragw_stts751.c
</pre></div>
</div>
<p>6.빌드를 정리하고 다시 컴파일합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>clean
make<span class="w"> </span><span class="nv">platform</span><span class="o">=</span>corecell<span class="w"> </span><span class="nv">variant</span><span class="o">=</span>std
</pre></div>
</div>
<p>7.설치가 완료되면 Basics Station 프로토콜을 구성해야 합니다. Semtech에서 제공한 예제가 있는 폴더를 입력하고, 특히 빌드가 SX1302용이므로 corecell 폴더를 입력합니다.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/corecell
</pre></div>
</div>
<p>8.reset_gw.sh를 수정하여 리셋 핀을 17로 변경하세요 .</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1"># This script is intended to be used on SX1302 CoreCell platform, it performs the following actions:</span>
<span class="c1">#        - export/unexport GPI023 and GPI018 used to reset the SX1302 chip and to enable the LDOs</span>
<span class="c1">#</span>
<span class="c1"># Usage examples:</span>
<span class="c1">#       ./reset_lgw.sh stop</span>
<span class="c1">#       ./reset_lgw.sh start</span>
<span class="c1">#</span>
<span class="c1"># GPIO mapping has to be adopted with HW</span>
<span class="c1">#</span>

<span class="nv">SX1302_RESET_PIN</span><span class="o">=</span><span class="m">17</span>
<span class="nv">SX1302_POWER_EN_PIN</span><span class="o">=</span><span class="m">18</span>

WAIT_GPIO<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>sleep<span class="w"> </span><span class="m">0</span>.1
<span class="o">}</span>
</pre></div>
</div>
<p>9.LoRaWAN을 위한 AWS IoT Core에 연결하기 위한 기본 스테이션의 모든 구성 파일을 저장할 새 폴더를 만듭니다.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>lns-aws
</pre></div>
</div>
<p>10.기본 스테이션 구성 파일을 복사합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>lns-ttn/station.conf<span class="w"> </span>lns-aws/
</pre></div>
</div>
<p>11.이전에 다운로드한 인증서를 추가합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>-all<span class="w"> </span>lns-aws
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-cups1"><span class="std std-numref">그림 65</span></a> cups.trust와 cups.uri</p>
<figure class="align-center" id="id77">
<span id="figure-005-01-cups1"></span><a class="reference internal image-reference" href="_images/figure_004131_0204-1.png"><img alt="cups.trust와 cups.uri" src="_images/figure_004131_0204-1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 65 </span><span class="caption-text">cups.trust와 cups.uri</span><a class="headerlink" href="#id77" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-cups2"><span class="std std-numref">그림 66</span></a> cups.crt와 cups.key</p>
<figure class="align-center" id="id78">
<span id="figure-005-01-cups2"></span><a class="reference internal image-reference" href="_images/figure_004132_0204-2.png"><img alt="cups.crt와 cups.key" src="_images/figure_004132_0204-2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 66 </span><span class="caption-text">cups.crt와 cups.key</span><a class="headerlink" href="#id78" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>출력 예시:
<a class="reference internal" href="#figure-005-01-cups3"><span class="std std-numref">그림 67</span></a></p>
<figure class="align-center" id="id79">
<span id="figure-005-01-cups3"></span><a class="reference internal image-reference" href="_images/figure_004133_0204-3.png"><img alt="모든 설치가 끝난 후의 파일들" src="_images/figure_004133_0204-3.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 67 </span><span class="caption-text">모든 설치가 끝난 후의 파일들</span><a class="headerlink" href="#id79" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>12.기본 스테이션을 사용하기 전에 기존 패킷 포워더를 비활성화해야 합니다. 패킷 포워더의 서비스를 편집하려면 다음을 실행합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>edit<span class="w"> </span>ttn-gateway.service
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>The<span class="w"> </span>Things<span class="w"> </span>Network<span class="w"> </span>Gateway

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">WorkingDirectory</span><span class="o">=</span>/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/
<span class="nv">ExecStart</span><span class="o">=</span>/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/start.sh
<span class="nv">SyslogIdentifier</span><span class="o">=</span>ttn-gateway
<span class="nv">Restart</span><span class="o">=</span>no
<span class="nv">RestartSec</span><span class="o">=</span><span class="m">5</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></div>
</div>
<p>13.파일에 다음 설정을 추가합니다:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">The Things Network Gateway</span>

<span class="k">[Service]</span>
<span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/opt/ttn-gateway/packet_forwarder/lora_pkt_fwd/start.sh</span>
<span class="na">SyslogIdentifier</span><span class="o">=</span><span class="s">ttn-gateway</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">no</span>
<span class="na">RestartSec</span><span class="o">=</span><span class="s">5</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</pre></div>
</div>
<p>14.변경 사항을 적용하려면 다음 명령을 실행합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>ttn-gateway.service
</pre></div>
</div>
<p>15.기존 패킷 포워더 프로세스를 종료하려면 다음 명령을 실행합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pi@rak-gateway:~/basicstation/example/corecell/lns-aws<span class="w"> </span>$<span class="w"> </span>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ttn-gateway
</pre></div>
</div>
<p>16.출력된 프로세스 ID(PID)를 찾아 종료합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>&lt;PID&gt;
</pre></div>
</div>
<p>17.이제 기본 스테이션을 시작할 수 있습니다. 구성 폴더로 이동한 후 실행합니다:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>..
./start-station.sh<span class="w"> </span>-l<span class="w"> </span>./lns-aws
</pre></div>
</div>
<p>모든 것이 올바르게 구성되었다면, 게이트웨이는 AWS IoT Core for LoRaWAN 콘솔에서 온라인 상태로 나타나야 합니다.</p>
<p><a class="reference internal" href="#figure-005-01-connected"><span class="std std-numref">그림 68</span></a> aws iot core에 connected된 화면</p>
<figure class="align-center" id="id80">
<span id="figure-005-01-connected"></span><a class="reference internal image-reference" href="_images/figure_004134_0204-4.png"><img alt="aws iot core에 connected된 화면" src="_images/figure_004134_0204-4.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 68 </span><span class="caption-text">aws iot core에 connected된 화면</span><a class="headerlink" href="#id80" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-sendex"><span class="std std-numref">그림 69</span></a> 예제 실행결과</p>
<figure class="align-center" id="id81">
<span id="figure-005-01-sendex"></span><a class="reference internal image-reference" href="_images/figure_004135_0205.png"><img alt="예제 실행결과" src="_images/figure_004135_0205.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 69 </span><span class="caption-text">예제 실행결과</span><a class="headerlink" href="#id81" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>아두이노 IDE 예제코드 수정</p>
<p>1.RAK WisBlock RUI 예제 에서 예제 코드를 연다.</p>
<p><a class="reference internal" href="#figure-005-01-otaa-abp"><span class="std std-numref">그림 70</span></a> LoRaWAN예제 여는법</p>
<figure class="align-center" id="id82">
<span id="figure-005-01-otaa-abp"></span><a class="reference internal image-reference" href="_images/figure_004156_OTAA_ABP.png"><img alt="OTAA예제" src="_images/figure_004156_OTAA_ABP.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 70 </span><span class="caption-text">OTAA예제</span><a class="headerlink" href="#id82" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>2.예제 코드에서 nodeDeviceEUI와 nodeAppEUI, nodeAppKey를 수정한다.</p>
<p>3.주파수를 사용하는 주파수에 맞게 수정한다. (KR920)</p>
<p><a class="reference internal" href="#figure-005-01-otaa-abp2"><span class="std std-numref">그림 71</span></a> LoRaWAN예제 키와 주파수 수정​</p>
<figure class="align-center" id="id83">
<span id="figure-005-01-otaa-abp2"></span><a class="reference internal image-reference" href="_images/figure_004157_OTAA_ABP2.png"><img alt="OTAA예제수정" src="_images/figure_004157_OTAA_ABP2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 71 </span><span class="caption-text">OTAA예제수정</span><a class="headerlink" href="#id83" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK4630 디바이스 등록</a></p>
<p>프로필 추가</p>
<p>1.AWS IoT 콘솔로 이동한다. 탐색 창에서 LPWAN devices(LPWAN 디바이스)를 선택한 다음 Profiles(프로필)를 클릭한다.</p>
<p>2.Device Profiles(디바이스 프로필)추가를 클릭하고 매개변수를 설정한다.</p>
<p>3.Add service profile(서비스 프로필 추가)을 클릭하고 필요에 따라 매개 변수를 설정한다.</p>
<p><a class="reference internal" href="#figure-005-01-device1"><span class="std std-numref">그림 72</span></a> 디바이스 프로필 추가한 모습​</p>
<figure class="align-center" id="id84">
<span id="figure-005-01-device1"></span><a class="reference internal image-reference" href="_images/figure_004139_Device1.png"><img alt="디바이스프로필" src="_images/figure_004139_Device1.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 72 </span><span class="caption-text">디바이스프로필</span><a class="headerlink" href="#id84" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p><a class="reference internal" href="#figure-005-01-device2"><span class="std std-numref">그림 73</span></a> 서비스 프로필 추가한 모습​</p>
<figure class="align-center" id="id85">
<span id="figure-005-01-device2"></span><a class="reference internal image-reference" href="_images/figure_004140_Device2.png"><img alt="서비스프로필" src="_images/figure_004140_Device2.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 73 </span><span class="caption-text">서비스프로필</span><a class="headerlink" href="#id85" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>대상에 IAM 역할 추가</p>
<p>1.IAM 콘솔로 이동한다. 탐색 창에서 정책(Policies)을 선택한다.</p>
<p>2.[Create Policy]를 선택한 다음 [JSON] 탭을 선택하여 정책 편집기를 연다. 기존 템플릿을 다음 신뢰 정책 문서로 바꾼다.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;iot:DescribeEndpoint&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s2">&quot;iot:Publish&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>3.다음을 클릭하고 Review and create(검토 및 만들기) 페이지에서 선택한다. 이름에 원하는 이름을 입력한다.</p>
<p>4.[Description]에 원하는 설명을 입력한다.</p>
<p>5.정책 생성을 선택한다. 정책이 생성되었음을 나타내는 확인 메시지가 표시된다.</p>
<p>(역할 생성)</p>
<p>6.탐색 창에서 [Roles]를 선택하여 [Roles] 페이지를 연다.</p>
<p>7.[Create Role]을 선택한다.</p>
<p>8.[Create Role] 페이지에서 [AWS account] &gt; [Another AWS account]를 선택한다.</p>
<p>9.계정 ID를 입력하고 다음을 선택한다.</p>
<p>10.검색 창에 정책 이름을 입력하여 방금 생성한 IAM 정책을 검색한다.</p>
<p>11.검색 결과에서 정책에 해당하는 확인란을 선택한다. 다음을 클릭한다.</p>
<p>12.[Role name]에 원하는 적절한 이름을 입력한다.</p>
<p>13.[Description]에 원하는 설명을 입력한다.</p>
<p>14.[Create role]을 선택한다. 역할이 생성되었음을 나타내는 확인 메시지가 표시된다.</p>
<p>(신뢰정책 업데이트)</p>
<p>15.탐색 창에서 [Roles]를 선택하여 [Roles] 페이지를 연다.</p>
<p>16.검색 창에서 이전에 생성한 역할의 이름을 입력하고 검색 결과에서 역할 이름을 클릭한다. 그러면 요약 페이지가 열린다.</p>
<p>17.신뢰 관계(Trust relationships) 탭을 선택하여 신뢰 관계(Trust relationships) 페이지로 이동한다.</p>
<p>18.신뢰 정책 편집을 클릭한다. 신뢰 정책 문서의 보안 주체 AWS 역할은 기본적으로 root로 설정되며 변경해야 한다. 기존 정책을 다음으로 바꾼다.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Principal&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;Service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;iotwireless.amazonaws.com&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;sts:AssumeRole&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>19.정책 업데이트를 선택한다.</p>
<p>대상 설정</p>
<p>1.탐색 창에서 LPWAN 디바이스(LPWAN devices)를 선택한 다음 대상(Destinations)을 선택한다.</p>
<p>2.[Add Destination]을 선택한다.</p>
<p>3.대상 이름에 ProcessLoRa를 입력한 다음 대상 설명 - 선택 사항 아래에 적절한 설명을 추가한다.</p>
<p>4.규칙 이름에 LoRaWANRouting을 입력한다. 규칙 구성 – 지금은 선택 사항 섹션을 무시한다.</p>
<p>5.[Permissions] 섹션에서 [Select an existing service role]을 선택하고 드롭다운에서 이전에 생성한 IAM 역할을 선택한다.</p>
<p>6.[Add Destination]을 선택한다. 대상이 성공적으로 추가되었음을 나타내는 “Destination added(대상이 추가됨)” 메시지가 표시된다.</p>
<p>대상 규칙</p>
<p>1.AWS IoT 콘솔로 이동한다.</p>
<p>2.탐색 창에서 메시지 라우팅(Message routing)을 선택한 다음 규칙(Rules)을 선택한다.</p>
<p>3.규칙(Rules) 페이지에서 규칙 생성(Create rule)을 선택한다.</p>
<dl>
<dt>5.Create a rule(규칙 생성) 페이지에서 다음과 같이 입력한다.</dt><dd><p>이름: LoRaWANRouting</p>
<p>설명: 선택한 설명입니다.다음을 클릭합니다.</p>
</dd>
</dl>
<p>6.기본 규칙 쿼리 문인 ‘SELECT * FROM ‘iot/topic’을 변경하지 않고 그대로 둔다. 이 쿼리는 현재 트래픽이 대상에 따라 규칙 엔진으로 전달되므로 현재 적용되지 않는다. 다음을 클릭한다.</p>
<p>7.[Attach rule actions] 페이지에서 [Republish to AWS IoT topic]을 선택한다.</p>
<p>8.[Topic]에 project/sensor/decoded를 입력합니다. AWS IoT 규칙 엔진은 이 주제로 메시지를 전달한다.</p>
<p>9.IAM 역할에서 새 역할 만들기를 선택한다.</p>
<p>10.이름에 원하는 이름을 입력한다. 만들기를 클릭한다.</p>
<p>11.그런 다음 [Create]를 선택한다.</p>
<p>12.”성공” 메시지가 패널 맨 위에 표시되고 대상에는 규칙이 바인딩되어 있다.</p>
<p>장치 등록</p>
<p>1.AWS IoT 콘솔로 이동한다.</p>
<p>2.왼쪽의 탐색 패널에서 LPWAN 장치를 선택한다.</p>
<p>3.Devices(장치)를 선택한 다음 Add wireless device(무선 장치 추가)를 선택한다.</p>
<p>4.Add device(디바이스 추가) 페이지의 Wireless device specification(무선 디바이스 사양) 아래의 드롭다운에서 LoRaWAN 사양 버전을 선택한다.</p>
<p>5.LoRaWAN 사양 및 무선 디바이스 구성에서 DevEUI를 입력한다.</p>
<p>6.위에서 선택한 OTAA/ABP에 따라 나머지 필드를 입력한다.</p>
<p>7.Wireless device name – optional 필드에 장치 이름을 입력한다.</p>
<p>8.프로필 섹션의 무선 장치 프로필 아래에 있는 드롭다운 옵션에서 만든 장치 프로필 또는 장치 및 지역에 해당하는 장치 프로필을 찾는다.</p>
<p>9.Choose destination(대상 선택) 아래의 드롭다운에서 이전에 생성한 대상(ProcessLoRa)을 선택한다.</p>
<p>10.다음을 클릭한다.</p>
<p>11.장치 추가를 선택한다. “무선 장치가 추가됨”이라는 메시지가 표시되어 장치가 성공적으로 설정되었음을 나타낸다.</p>
<p>12.최종 디바이스를 다시 시작하면 AWS IoT LoRaWAN 서버에 조인된다.</p>
<p>13.MQTT로 HELLOW!를 인코딩해서 보내는데 성공​</p>
<p>LoRaWAN으로 온, 습도값 보내기</p>
<p>1.아두이노 IDE를 연다.</p>
<p>2.RAK WisBlock RUI 예제 에서 OTAA_ABP예제 코드를 연다.</p>
<p>3.아래 예제로 코드를 바꾼후 업로드 한다.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;Arduino.h&gt;</span>
<span class="c1">#include &lt;LoRaWan-RAK4630.h&gt; //http://librarymanager/All#SX126x</span>
<span class="c1">#include &lt;SPI.h&gt;</span>

//<span class="w"> </span>RAK4630<span class="w"> </span>supply<span class="w"> </span>two<span class="w"> </span>LED
<span class="c1">#ifndef LED_BUILTIN</span>
<span class="c1">#define LED_BUILTIN 35</span>
<span class="c1">#endif</span>

<span class="c1">#ifndef LED_BUILTIN2</span>
<span class="c1">#define LED_BUILTIN2 36</span>
<span class="c1">#endif</span>

//<span class="w"> </span>마지막으로<span class="w"> </span>센서를<span class="w"> </span>읽은<span class="w"> </span>시간
unsigned<span class="w"> </span>long<span class="w"> </span><span class="nv">lastSensorReadTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
const<span class="w"> </span>unsigned<span class="w"> </span>long<span class="w"> </span><span class="nv">sensorReadInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>10초마다<span class="w"> </span>읽기
float<span class="w"> </span><span class="nv">lastTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0<span class="p">;</span>
float<span class="w"> </span><span class="nv">lastHumidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0<span class="p">;</span>




<span class="c1">#include &quot;SparkFun_SHTC3.h&quot;       //Click here to get the library: http://librarymanager/All#SparkFun_SHTC3</span>
SHTC3<span class="w"> </span>g_shtc3<span class="p">;</span>
<span class="w">                        </span>//<span class="w"> </span>Declare<span class="w"> </span>an<span class="w"> </span>instance<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>SHTC3<span class="w"> </span>class


bool<span class="w"> </span><span class="nv">doOTAA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>true<span class="p">;</span><span class="w">   </span>//<span class="w"> </span>OTAA<span class="w"> </span>is<span class="w"> </span>used<span class="w"> </span>by<span class="w"> </span>default.
<span class="c1">#define SCHED_MAX_EVENT_DATA_SIZE APP_TIMER_SCHED_EVENT_DATA_SIZE /**&lt; Maximum size of scheduler events. */</span>
<span class="c1">#define SCHED_QUEUE_SIZE 60                                /**&lt; Maximum number of events in the scheduler queue. */</span>
<span class="c1">#define LORAWAN_DATERATE DR_0                             /*LoRaMac datarates definition, from DR_0 to DR_5*/</span>
<span class="c1">#define LORAWAN_TX_POWER TX_POWER_5                     /*LoRaMac tx power definition, from TX_POWER_0 to TX_POWER_15*/</span>
<span class="c1">#define JOINREQ_NBTRIALS 3                                /**&lt; Number of trials for the join request. */</span>
DeviceClass_t<span class="w"> </span><span class="nv">g_CurrentClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CLASS_A<span class="p">;</span><span class="w">               </span>/*<span class="w"> </span>class<span class="w"> </span>definition*/
LoRaMacRegion_t<span class="w"> </span><span class="nv">g_CurrentRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LORAMAC_REGION_KR920<span class="p">;</span><span class="w">    </span>/*<span class="w"> </span>Region:EU868*/
lmh_confirm<span class="w"> </span><span class="nv">g_CurrentConfirm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LMH_UNCONFIRMED_MSG<span class="p">;</span><span class="w">              </span>/*<span class="w"> </span>confirm/unconfirm<span class="w"> </span>packet<span class="w"> </span>definition*/
uint8_t<span class="w"> </span><span class="nv">gAppPort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>LORAWAN_APP_PORT<span class="p">;</span><span class="w">                             </span>/*<span class="w"> </span>data<span class="w"> </span>port*/

/**@brief<span class="w"> </span>Structure<span class="w"> </span>containing<span class="w"> </span>LoRaWan<span class="w"> </span>parameters,<span class="w"> </span>needed<span class="w"> </span><span class="k">for</span><span class="w"> </span>lmh_init<span class="o">()</span>
*/
static<span class="w"> </span>lmh_param_t<span class="w"> </span><span class="nv">g_lora_param_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>LORAWAN_ADR_ON,<span class="w"> </span>LORAWAN_DATERATE,<span class="w"> </span>LORAWAN_PUBLIC_NETWORK,<span class="w"> </span>JOINREQ_NBTRIALS,<span class="w"> </span>LORAWAN_TX_POWER,<span class="w"> </span>LORAWAN_DUTYCYCLE_OFF<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>Foward<span class="w"> </span>declaration
static<span class="w"> </span>void<span class="w"> </span>lorawan_has_joined_handler<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>lorawan_join_failed_handler<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>lorawan_rx_handler<span class="o">(</span>lmh_app_data_t<span class="w"> </span>*app_data<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>lorawan_confirm_class_handler<span class="o">(</span>DeviceClass_t<span class="w"> </span>Class<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>void<span class="w"> </span>send_lora_frame<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>

/**@brief<span class="w"> </span>Structure<span class="w"> </span>containing<span class="w"> </span>LoRaWan<span class="w"> </span>callback<span class="w"> </span>functions,<span class="w"> </span>needed<span class="w"> </span><span class="k">for</span><span class="w"> </span>lmh_init<span class="o">()</span>
*/
static<span class="w"> </span>lmh_callback_t<span class="w"> </span><span class="nv">g_lora_callbacks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>BoardGetBatteryLevel,<span class="w"> </span>BoardGetUniqueId,<span class="w"> </span>BoardGetRandomSeed,
<span class="w">                                        </span>lorawan_rx_handler,<span class="w"> </span>lorawan_has_joined_handler,<span class="w"> </span>lorawan_confirm_class_handler,<span class="w"> </span>lorawan_join_failed_handler
<span class="w">                                    </span><span class="o">}</span><span class="p">;</span>
//OTAA<span class="w"> </span>keys<span class="w"> </span>!!!!<span class="w"> </span>KEYS<span class="w"> </span>ARE<span class="w"> </span>MSB<span class="w"> </span>!!!!
uint8_t<span class="w"> </span>nodeDeviceEUI<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x32,<span class="w"> </span>0x39<span class="o">}</span><span class="p">;</span>
uint8_t<span class="w"> </span>nodeAppEUI<span class="o">[</span><span class="m">8</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0xB8,<span class="w"> </span>0x27,<span class="w"> </span>0xEB,<span class="w"> </span>0xFF,<span class="w"> </span>0xFE,<span class="w"> </span>0x39,<span class="w"> </span>0x12,<span class="w"> </span>0x00<span class="o">}</span><span class="p">;</span>
uint8_t<span class="w"> </span>nodeAppKey<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x88,<span class="w"> </span>0x38,<span class="w"> </span>0x57,<span class="w"> </span>0x86,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88,<span class="w"> </span>0x88<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>ABP<span class="w"> </span>keys
uint32_t<span class="w"> </span><span class="nv">nodeDevAddr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>0x260116F8<span class="p">;</span>
uint8_t<span class="w"> </span>nodeNwsKey<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0x7E,<span class="w"> </span>0xAC,<span class="w"> </span>0xE2,<span class="w"> </span>0x55,<span class="w"> </span>0xB8,<span class="w"> </span>0xA5,<span class="w"> </span>0xE2,<span class="w"> </span>0x69,<span class="w"> </span>0x91,<span class="w"> </span>0x51,<span class="w"> </span>0x96,<span class="w"> </span>0x06,<span class="w"> </span>0x47,<span class="w"> </span>0x56,<span class="w"> </span>0x9D,<span class="w"> </span>0x23<span class="o">}</span><span class="p">;</span>
uint8_t<span class="w"> </span>nodeAppsKey<span class="o">[</span><span class="m">16</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>0xFB,<span class="w"> </span>0xAC,<span class="w"> </span>0xB6,<span class="w"> </span>0x47,<span class="w"> </span>0xF3,<span class="w"> </span>0x58,<span class="w"> </span>0x45,<span class="w"> </span>0xC7,<span class="w"> </span>0x50,<span class="w"> </span>0x7D,<span class="w"> </span>0xBF,<span class="w"> </span>0x16,<span class="w"> </span>0x8B,<span class="w"> </span>0xA8,<span class="w"> </span>0xC1,<span class="w"> </span>0x7C<span class="o">}</span><span class="p">;</span>

//<span class="w"> </span>Private<span class="w"> </span>defination
<span class="c1">#define LORAWAN_APP_DATA_BUFF_SIZE 64                     /**&lt; buffer size of the data to be transmitted. */</span>
<span class="c1">#define LORAWAN_APP_INTERVAL 20000                        /**&lt; Defines for user timer, the application data transmission interval. 20s, value in [ms]. */</span>
static<span class="w"> </span>uint8_t<span class="w"> </span>m_lora_app_data_buffer<span class="o">[</span>LORAWAN_APP_DATA_BUFF_SIZE<span class="o">]</span><span class="p">;</span><span class="w">            </span>//&lt;<span class="w"> </span>Lora<span class="w"> </span>user<span class="w"> </span>application<span class="w"> </span>data<span class="w"> </span>buffer.
static<span class="w"> </span>lmh_app_data_t<span class="w"> </span><span class="nv">m_lora_app_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>m_lora_app_data_buffer,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span><span class="m">0</span><span class="o">}</span><span class="p">;</span><span class="w"> </span>//&lt;<span class="w"> </span>Lora<span class="w"> </span>user<span class="w"> </span>application<span class="w"> </span>data<span class="w"> </span>structure.

TimerEvent_t<span class="w"> </span>appTimer<span class="p">;</span>
static<span class="w"> </span>uint32_t<span class="w"> </span>timers_init<span class="o">(</span>void<span class="o">)</span><span class="p">;</span>
static<span class="w"> </span>uint32_t<span class="w"> </span><span class="nv">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
static<span class="w"> </span>uint32_t<span class="w"> </span><span class="nv">count_fail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>

void<span class="w"> </span>setup<span class="o">()</span>
<span class="o">{</span>

pinMode<span class="o">(</span>LED_BUILTIN,<span class="w"> </span>OUTPUT<span class="o">)</span><span class="p">;</span>
digitalWrite<span class="o">(</span>LED_BUILTIN,<span class="w"> </span>LOW<span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>Initialize<span class="w"> </span>Serial<span class="w"> </span><span class="k">for</span><span class="w"> </span>debug<span class="w"> </span>output
time_t<span class="w"> </span><span class="nv">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>millis<span class="o">()</span><span class="p">;</span>
Serial.begin<span class="o">(</span><span class="m">115200</span><span class="o">)</span><span class="p">;</span>
Wire.begin<span class="o">()</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>I2C<span class="w"> </span>초기화는<span class="w"> </span>setup<span class="o">()</span>에서<span class="w"> </span>한<span class="w"> </span>번만<span class="w"> </span>실행
Wire.setClock<span class="o">(</span><span class="m">400000</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>I2C<span class="w"> </span>속도<span class="w"> </span>설정
Wire.setTimeout<span class="o">(</span><span class="m">10</span><span class="o">)</span><span class="p">;</span>

g_shtc3.begin<span class="o">()</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.lastStatus<span class="w"> </span>!<span class="o">=</span><span class="w"> </span>SHTC3_Status_Nominal<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;⚠️ 센서 초기화 실패!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span>Serial.println<span class="o">(</span><span class="s2">&quot;✅ 센서 정상 연결됨!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="k">while</span><span class="w"> </span><span class="o">(</span>!Serial<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">((</span>millis<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>timeout<span class="o">)</span><span class="w"> </span>&lt;<span class="w"> </span><span class="m">5000</span><span class="o">)</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">    </span>delay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>

//<span class="w"> </span>Initialize<span class="w"> </span>LoRa<span class="w"> </span>chip.
lora_rak4630_init<span class="o">()</span><span class="p">;</span>

Serial.println<span class="o">(</span><span class="s2">&quot;=====================================&quot;</span><span class="o">)</span><span class="p">;</span>
Serial.println<span class="o">(</span><span class="s2">&quot;Welcome to RAK4630 LoRaWan!!!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>doOTAA<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Type: OTAA&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Type: ABP&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

switch<span class="w"> </span><span class="o">(</span>g_CurrentRegion<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AU915:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AU915&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_CN470:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: CN470&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_CN779:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: CN779&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_EU433:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: EU433&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_IN865:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: IN865&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_EU868:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: EU868&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_KR920:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: KR920&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span>LORAMAC_REGION_US915:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: US915&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_RU864:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: RU864&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923_2:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923-2&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923_3:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923-3&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="k">case</span><span class="w"> </span>LORAMAC_REGION_AS923_4:
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;Region: AS923-4&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="o">}</span>
Serial.println<span class="o">(</span><span class="s2">&quot;=====================================&quot;</span><span class="o">)</span><span class="p">;</span>

//creat<span class="w"> </span>a<span class="w"> </span>user<span class="w"> </span>timer<span class="w"> </span>to<span class="w"> </span>send<span class="w"> </span>data<span class="w"> </span>to<span class="w"> </span>server<span class="w"> </span>period
Serial.println<span class="o">(</span><span class="s2">&quot;타이머 초기화 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
uint32_t<span class="w"> </span>err_code<span class="p">;</span>
<span class="nv">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>timers_init<span class="o">()</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>err_code<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;timers_init failed - %d\n&quot;</span>,<span class="w"> </span>err_code<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="o">}</span>
Serial.println<span class="o">(</span><span class="s2">&quot;타이머 초기화 완료!&quot;</span><span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>Setup<span class="w"> </span>the<span class="w"> </span>EUIs<span class="w"> </span>and<span class="w"> </span>Keys
<span class="k">if</span><span class="w"> </span><span class="o">(</span>doOTAA<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>lmh_setDevEui<span class="o">(</span>nodeDeviceEUI<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setAppEui<span class="o">(</span>nodeAppEUI<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setAppKey<span class="o">(</span>nodeAppKey<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>lmh_setNwkSKey<span class="o">(</span>nodeNwsKey<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setAppSKey<span class="o">(</span>nodeAppsKey<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>lmh_setDevAddr<span class="o">(</span>nodeDevAddr<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

//<span class="w"> </span>Initialize<span class="w"> </span>LoRaWan
Serial.println<span class="o">(</span><span class="s2">&quot;LoRa 모듈 초기화 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="nv">err_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lmh_init<span class="o">(</span><span class="p">&amp;</span>g_lora_callbacks,<span class="w"> </span>g_lora_param_init,<span class="w"> </span>doOTAA,<span class="w"> </span>g_CurrentClass,<span class="w"> </span>g_CurrentRegion<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>err_code<span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;lmh_init failed - %d\n&quot;</span>,<span class="w"> </span>err_code<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="o">}</span>
Serial.println<span class="o">(</span><span class="s2">&quot;LoRa 모듈 초기화 완료!&quot;</span><span class="o">)</span><span class="p">;</span>

//<span class="w"> </span>Start<span class="w"> </span>Join<span class="w"> </span>procedure
Serial.println<span class="o">(</span><span class="s2">&quot;LoRaWAN Join 요청 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
lmh_join<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>



/**@brief<span class="w"> </span>LoRa<span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>handling<span class="w"> </span>HasJoined<span class="w"> </span>event.
*/
void<span class="w"> </span>lorawan_has_joined_handler<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
<span class="k">if</span><span class="o">(</span><span class="nv">doOTAA</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">true</span><span class="o">)</span>
<span class="o">{</span>
Serial.println<span class="o">(</span><span class="s2">&quot;OTAA Mode, Network Joined!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;ABP Mode&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

lmh_error_status<span class="w"> </span><span class="nv">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lmh_class_request<span class="o">(</span>g_CurrentClass<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>LMH_SUCCESS<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;타이머 시작!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>delay<span class="o">(</span><span class="m">1000</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>TimerSetValue<span class="o">(</span><span class="p">&amp;</span>appTimer,<span class="w"> </span>LORAWAN_APP_INTERVAL<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>TimerStart<span class="o">(</span><span class="p">&amp;</span>appTimer<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;타이머 실행됨! 현재 상태: %d\n&quot;</span>,<span class="w"> </span>appTimer.IsRunning<span class="o">)</span><span class="p">;</span>

<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;타이머 강제 실행 테스트!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>tx_lora_periodic_handler<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>


<span class="o">}</span>
/**@brief<span class="w"> </span>LoRa<span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>handling<span class="w"> </span>OTAA<span class="w"> </span>join<span class="w"> </span>failed
*/
static<span class="w"> </span>void<span class="w"> </span>lorawan_join_failed_handler<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
Serial.println<span class="o">(</span><span class="s2">&quot;OTAA join failed!&quot;</span><span class="o">)</span><span class="p">;</span>
Serial.println<span class="o">(</span><span class="s2">&quot;Check your EUI&#39;s and Keys&#39;s!&quot;</span><span class="o">)</span><span class="p">;</span>
Serial.println<span class="o">(</span><span class="s2">&quot;Check if a Gateway is in range!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
/**@brief<span class="w"> </span>Function<span class="w"> </span><span class="k">for</span><span class="w"> </span>handling<span class="w"> </span>LoRaWan<span class="w"> </span>received<span class="w"> </span>data<span class="w"> </span>from<span class="w"> </span>Gateway
*
*<span class="w"> </span>@param<span class="o">[</span><span class="k">in</span><span class="o">]</span><span class="w"> </span>app_data<span class="w">  </span>Pointer<span class="w"> </span>to<span class="w"> </span>rx<span class="w"> </span>data
*/
void<span class="w"> </span>lorawan_rx_handler<span class="o">(</span>lmh_app_data_t<span class="w"> </span>*app_data<span class="o">)</span>
<span class="o">{</span>
Serial.printf<span class="o">(</span><span class="s2">&quot;LoRa Packet received on port %d, size:%d, rssi:%d, snr:%d, data:%s\n&quot;</span>,
<span class="w">        </span>app_data-&gt;port,<span class="w"> </span>app_data-&gt;buffsize,<span class="w"> </span>app_data-&gt;rssi,<span class="w"> </span>app_data-&gt;snr,<span class="w"> </span>app_data-&gt;buffer<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>

void<span class="w"> </span>lorawan_confirm_class_handler<span class="o">(</span>DeviceClass_t<span class="w"> </span>Class<span class="o">)</span>
<span class="o">{</span>
Serial.printf<span class="o">(</span><span class="s2">&quot;switch to class %c done\n&quot;</span>,<span class="w"> </span><span class="s2">&quot;ABC&quot;</span><span class="o">[</span>Class<span class="o">])</span><span class="p">;</span>
//<span class="w"> </span>Informs<span class="w"> </span>the<span class="w"> </span>server<span class="w"> </span>that<span class="w"> </span>switch<span class="w"> </span>has<span class="w"> </span>occurred<span class="w"> </span>ASAP
m_lora_app_data.buffsize<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
m_lora_app_data.port<span class="w"> </span><span class="o">=</span><span class="w"> </span>gAppPort<span class="p">;</span>
lmh_send<span class="o">(</span><span class="p">&amp;</span>m_lora_app_data,<span class="w"> </span>g_CurrentConfirm<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>


void<span class="w"> </span>send_lora_frame<span class="o">(</span>void<span class="o">)</span>
<span class="o">{</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span>lmh_join_status_get<span class="o">()</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>LMH_SET<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>//Not<span class="w"> </span>joined,<span class="w"> </span>try<span class="w"> </span>again<span class="w"> </span>later
<span class="w">    </span><span class="k">return</span><span class="p">;</span>
<span class="o">}</span>

uint32_t<span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
memset<span class="o">(</span>m_lora_app_data.buffer,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>LORAWAN_APP_DATA_BUFF_SIZE<span class="o">)</span><span class="p">;</span>
m_lora_app_data.port<span class="w"> </span><span class="o">=</span><span class="w"> </span>gAppPort<span class="p">;</span>
Serial.printf<span class="o">(</span><span class="s2">&quot;📦 전송 데이터 -&gt; 온도: %.2f°C, 습도: %.2f%%\n&quot;</span>,<span class="w"> </span>lastTemperature,<span class="w"> </span>lastHumidity<span class="o">)</span><span class="p">;</span>

<span class="k">if</span><span class="w"> </span><span class="o">((</span>int<span class="o">)(</span>lastHumidity<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>

Serial.printf<span class="o">(</span><span class="s2">&quot;습도가 0이면 전송x&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">if</span><span class="w"> </span><span class="o">((</span>int<span class="o">)(</span>lastHumidity<span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">)</span>
<span class="o">{</span>


//<span class="w"> </span>LoRaWAN<span class="w"> </span>데이터<span class="w"> </span>패킷<span class="w"> </span>생성<span class="w"> </span><span class="o">(</span>온도<span class="w"> </span>및<span class="w"> </span>습도<span class="w"> </span>2바이트씩<span class="w"> </span>전송<span class="o">)</span>
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)</span>lastTemperature<span class="p">;</span><span class="w">                         </span>//<span class="w"> </span>온도<span class="w"> </span>정수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)((</span>lastTemperature<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>int<span class="o">)</span>lastTemperature<span class="o">)</span><span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>온도<span class="w"> </span>소수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)</span>lastHumidity<span class="p">;</span><span class="w">                            </span>//<span class="w"> </span>습도<span class="w"> </span>정수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffer<span class="o">[</span>i++<span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>uint8_t<span class="o">)((</span>lastHumidity<span class="w"> </span>-<span class="w"> </span><span class="o">(</span>int<span class="o">)</span>lastHumidity<span class="o">)</span><span class="w"> </span>*<span class="w"> </span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>습도<span class="w"> </span>소수<span class="w"> </span>부분
<span class="w">    </span>m_lora_app_data.buffsize<span class="w"> </span><span class="o">=</span><span class="w"> </span>i<span class="p">;</span>

<span class="o">}</span>



lmh_error_status<span class="w"> </span><span class="nv">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lmh_send<span class="o">(</span><span class="p">&amp;</span>m_lora_app_data,<span class="w"> </span>g_CurrentConfirm<span class="o">)</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="o">(</span><span class="nv">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>LMH_SUCCESS<span class="o">)</span>
<span class="o">{</span>
<span class="w">    </span>count++<span class="p">;</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;lmh_send ok count %d\n&quot;</span>,<span class="w"> </span>count<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="k">else</span>
<span class="o">{</span>
<span class="w">    </span>count_fail++<span class="p">;</span>
<span class="w">    </span>Serial.printf<span class="o">(</span><span class="s2">&quot;lmh_send fail count %d\n&quot;</span>,<span class="w"> </span>count_fail<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
<span class="o">}</span>

void<span class="w"> </span>read_shtc3_data<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>millis<span class="o">()</span><span class="w"> </span>-<span class="w"> </span>lastSensorReadTime<span class="w"> </span>&gt;<span class="o">=</span><span class="w"> </span>sensorReadInterval<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nv">lastSensorReadTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>millis<span class="o">()</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>마지막<span class="w"> </span>실행<span class="w"> </span>시간<span class="w"> </span>업데이트

<span class="w">        </span>g_shtc3.update<span class="o">()</span><span class="p">;</span>


<span class="w">        </span>yield<span class="o">()</span><span class="p">;</span>


<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">(</span>g_shtc3.lastStatus<span class="w"> </span><span class="o">==</span><span class="w"> </span>SHTC3_Status_Nominal<span class="o">)</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="nv">lastTemperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toDegC<span class="o">()</span><span class="p">;</span>
<span class="w">            </span><span class="nv">lastHumidity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>g_shtc3.toPercent<span class="o">()</span><span class="p">;</span>
<span class="w">            </span>Serial.printf<span class="o">(</span><span class="s2">&quot;📊 센서 데이터: 온도 = %.2f°C, 습도 = %.2f%%\n&quot;</span>,<span class="w"> </span>lastTemperature,<span class="w"> </span>lastHumidity<span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span>Serial.println<span class="o">(</span><span class="s2">&quot;⚠️ 센서 데이터 읽기 실패!&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>


/**@brief<span class="w"> </span>Function<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>Timer<span class="w"> </span>initialization.
*
*<span class="w"> </span>@details<span class="w"> </span>Initializes<span class="w"> </span>the<span class="w"> </span>timer<span class="w"> </span>module.<span class="w"> </span>This<span class="w"> </span>creates<span class="w"> </span>and<span class="w"> </span>starts<span class="w"> </span>application<span class="w"> </span>timers.
*/


void<span class="w"> </span>tx_lora_periodic_handler<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;📡 LoRaWAN 데이터 전송 시작&quot;</span><span class="o">)</span><span class="p">;</span>


<span class="w">    </span>//<span class="w"> </span>LoRa<span class="w"> </span>데이터<span class="w"> </span>전송
<span class="w">    </span>send_lora_frame<span class="o">()</span><span class="p">;</span>

<span class="w">    </span>//<span class="w"> </span>타이머<span class="w"> </span>재설정
<span class="w">    </span>TimerSetValue<span class="o">(</span><span class="p">&amp;</span>appTimer,<span class="w"> </span>LORAWAN_APP_INTERVAL<span class="o">)</span><span class="p">;</span>
<span class="w">    </span>TimerStart<span class="o">(</span><span class="p">&amp;</span>appTimer<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>


void<span class="w"> </span>resetI2CBus<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;🔄 I2C 버스 리셋 실행&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>Wire.end<span class="o">()</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>기존<span class="w"> </span>I2C<span class="w"> </span>종료
<span class="w">    </span>delay<span class="o">(</span><span class="m">100</span><span class="o">)</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>잠시<span class="w"> </span>대기
<span class="w">    </span>Wire.begin<span class="o">()</span><span class="p">;</span><span class="w">  </span>//<span class="w"> </span>다시<span class="w"> </span>시작
<span class="w">    </span>Wire.setClock<span class="o">(</span><span class="m">100000</span><span class="o">)</span><span class="p">;</span>
<span class="w">    </span>Serial.println<span class="o">(</span><span class="s2">&quot;✅ I2C 버스 재시작 완료&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
//<span class="w"> </span>타이머<span class="w"> </span>초기화
uint32_t<span class="w"> </span>timers_init<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>TimerInit<span class="o">(</span><span class="p">&amp;</span>appTimer,<span class="w"> </span>tx_lora_periodic_handler<span class="o">)</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="m">0</span><span class="p">;</span>
<span class="o">}</span>

void<span class="w"> </span>loop<span class="o">()</span>
<span class="o">{</span>
<span class="w">    </span>read_shtc3_data<span class="o">()</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>센서<span class="w"> </span>데이터<span class="w"> </span>비동기<span class="w"> </span>읽기
<span class="w">    </span>yield<span class="o">()</span><span class="p">;</span>

<span class="w">    </span>delay<span class="o">(</span><span class="m">3000</span><span class="o">)</span><span class="p">;</span><span class="w"> </span>//<span class="w"> </span>CPU<span class="w"> </span>점유율<span class="w"> </span>최소화
<span class="o">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure-005-01-mqtt"><span class="std std-numref">그림 74</span></a> MQTT로 인코딩된 온, 습도값을 받는데 성공</p>
<figure class="align-center" id="id86">
<span id="figure-005-01-mqtt"></span><a class="reference internal image-reference" href="_images/figure_004155_MQTT.png"><img alt="MQTT결과" src="_images/figure_004155_MQTT.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 74 </span><span class="caption-text">MQTT결과</span><a class="headerlink" href="#id86" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>람다로 보내서 DynamoDB에 저장</p>
<p>1.DvnamoDB 콘솔의 테이블 페이지를 연다.</p>
<p>2.테이블생성을 선택한다.</p>
<blockquote>
<div><p>테이블 이름: LoRaWAN_SensorData
파티션 키 (Primary Key): DeviceId (String)
정렬 키 (Sort Key): Timestamp (Number)</p>
</div></blockquote>
<p>3.기타 설정을 기본값으로 두고 생성 한다.</p>
<p>4.Lambda 콘솔의 함수 페이지를 연다.</p>
<p>5.함수 생성을 선택한다.</p>
<p>6.새로 작성을 선택한다.</p>
<p>7.기본 정보 창의 함수 이름에 LoRaWAN_SaveToDynamoDB을 입력한다.</p>
<p>8.런타임에서 Python 3.13을 선택한다.</p>
<p>9.아키텍처를 x86_64로 설정된 상태로 두고 함수 생성을 선택한다.</p>
<p>10.아래 코드를 넣는다.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>

<span class="c1"># ✅ DynamoDB 연결</span>
<span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">)</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;LoRaWAN_SensorData&#39;</span><span class="p">)</span>  <span class="c1"># 테이블 이름 확인!</span>

<span class="k">def</span><span class="w"> </span><span class="nf">decode_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base64로 인코딩된 센서 데이터를 디코딩하여 온도와 습도를 추출&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">decoded_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>  <span class="c1"># Base64 디코딩</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">decoded_bytes</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;디코딩된 데이터 길이가 너무 짧음&quot;</span><span class="p">)</span>

        <span class="n">temperature</span> <span class="o">=</span> <span class="n">decoded_bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 첫 번째 바이트: 온도 (정수 값)</span>
        <span class="n">humidity</span> <span class="o">=</span> <span class="n">decoded_bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># 두 번째 바이트: 습도 (정수 값)</span>

        <span class="k">return</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">humidity</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ 페이로드 디코딩 실패: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;AWS IoT Core에서 수신한 MQTT 메시지를 처리하고 DynamoDB에 저장&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📡 수신된 이벤트: &quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

        <span class="c1"># ✅ JSON 데이터에서 PayloadData 및 메타데이터 추출</span>
        <span class="n">payload_data</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PayloadData&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WirelessMetadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LoRaWAN&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DevEui&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">timestamp_str</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;WirelessMetadata&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LoRaWAN&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🛠️ 디바이스 ID 확인: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ✅ 필수 데이터 확인</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ 디바이스 ID 없음 (DevEui 값 확인 필요)&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">timestamp_str</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ Timestamp 값 없음!&quot;</span><span class="p">)</span>

        <span class="c1"># ✅ UTC 타임스탬프 변환</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">timestamp_str</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>

        <span class="c1"># ✅ Base64 디코딩하여 온도 및 습도 추출</span>
        <span class="n">temperature</span><span class="p">,</span> <span class="n">humidity</span> <span class="o">=</span> <span class="n">decode_payload</span><span class="p">(</span><span class="n">payload_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">temperature</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">humidity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ 온도 또는 습도 데이터를 추출할 수 없음&quot;</span><span class="p">)</span>

        <span class="c1"># ✅ DynamoDB에 저장 (Key 이름 `DeviceId`, `Timestamp` 사용)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span>
            <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
                <span class="s1">&#39;DeviceId&#39;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>  <span class="c1"># 대소문자 구분</span>
                <span class="s1">&#39;Timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>  <span class="c1"># 정렬 키 (Number)</span>
                <span class="s1">&#39;Temperature&#39;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
                <span class="s1">&#39;Humidity&#39;</span><span class="p">:</span> <span class="n">humidity</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ DynamoDB 저장 완료: </span><span class="si">{</span><span class="n">response</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s1">&#39;Data successfully stored in DynamoDB!&#39;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ 오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;statusCode&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
<p>11.Deploy 섹션에서 Deploy를 선택하여 함수의 코드를 업데이트한다.</p>
<p>12.AWS IoT 콘솔로 이동한다.</p>
<p>13.탐색 창에서 메시지 라우팅(Message routing)을 선택한 다음 규칙(Rules)을 선택한다.</p>
<p>14.위에서 만든 LoRaWANRouting 규칙을 누른다.</p>
<p>15.편집을 들어가서 [규칙작업 추가]를 누른다.</p>
<p>16.위에서 만든 LoRaWAN_SaveToDynamoDB 람다함수를 추가한다.</p>
<p>17.업데이트를 클릭한다.</p>
<p><a class="reference internal" href="#figure-005-01-data"><span class="std std-numref">그림 75</span></a> 와 같이 온, 습도값이 DynamoDB에 쌓인다.</p>
<figure class="align-center" id="id87">
<span id="figure-005-01-data"></span><a class="reference internal image-reference" href="_images/figure_004138_data.png"><img alt="데이터베이스" src="_images/figure_004138_data.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 75 </span><span class="caption-text">데이터베이스</span><a class="headerlink" href="#id87" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="id39">
<h3>결산<a class="headerlink" href="#id39" title="Link to this heading">¶</a></h3>
<p>RAK11310에서 RAK4630으로 보드를 바꿈.
AWS에 대해 공부함.
디바이스와 게이트웨이를 LoRaWAN으로 연결하여 서버에서 MQTT로 데이터 받는데 성공
온, 습도값을 LoRaWAN으로 보내서 DynamoDB에 쌓는데 성공</p>
</section>
<hr class="docutils" />
<section id="id40">
<h3>기타<a class="headerlink" href="#id40" title="Link to this heading">¶</a></h3>
<p>디바이스를 등록할때 권한을 꼬이지 않게 잘 지정해야하고 Destination에서 RULE추가를 해줘야 한다.</p>
<p>LoRaWAN으로 온, 습도값을 보내는 코드를 짤때 핸들러가 멈춰서 강제실행하는 Yeild를 추가하여 해결했다.</p>
<br><hr class="docutils" />
</section>
</section>
<section id="sprt-07-09-rx004-01">
<span id="research-note-004017-2025-0209-0301-sprt-07-09-rx004-group01"></span><h2>연구 노트 2025_0209_0301_SPRT_07_09 RX004 01조<a class="headerlink" href="#sprt-07-09-rx004-01" title="Link to this heading">¶</a></h2>
<section id="id41">
<h3>개요<a class="headerlink" href="#id41" title="Link to this heading">¶</a></h3>
<p>저해상도 적외선 카메라로 촬영한 이미지를 mqtt 메세지로 보내 amazon s3에 저장한다.</p>
</section>
<hr class="docutils" />
<section id="id42">
<h3>02월 09일 - 02월 15일 (01주차)<a class="headerlink" href="#id42" title="Link to this heading">¶</a></h3>
<section id="id43">
<h4><strong>목표</strong><a class="headerlink" href="#id43" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가</p></li>
<li><p>rak19007 wisboard의 적외선 카메라(RAK12052) 추가 및 device data Aws IOT core 에서 S3에 저장</p></li>
</ol>
<hr class="docutils" />
<p>참고링크: <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7248/lorawan-network-server-guide/">RAK7248 가이드</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisgate/rak7268v2/lorawan-network-server-guide/">RAK7268 가이드</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak1901/quickstart/">RAK1901 가이드</a>, <a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-ddb-rule.html">DynamoDB 문서</a> , <a class="reference external" href="https://docs.aws.amazon.com/ko_kr/iot/latest/developerguide/iot-lambda-rule.html">Lambda 문서</a> , <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak12052/overview/">RAK12052문서</a>,
<a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak19007/datasheet/">RAK19007 wisboard</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rakbox-uo100x75x38-solar/overview/">태양광 패널 설치 가이드</a>, <a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak12052/overview/">IR Array Module 가이드</a></p>
</section>
<hr class="docutils" />
<section id="id50">
<h4><strong>과정</strong><a class="headerlink" href="#id50" title="Link to this heading">¶</a></h4>
<ul>
<li><dl class="simple">
<dt>단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>solar bettery 설치하기</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak19007/datasheet/">RAK19007 wisboard</a> 를 참고하여 Ctrl+F로 ‘Solar Panel Connector’를 검색하면 태양광 패널이 자동으로 에너지를 수확하여 리튬 이온 배터리로 저장되는 것을 확인할 수 있다.</p></li>
<li><p>Ctrl+F ‘Type-C USB port’ 를 검색하면 기존에 쓰던 device를 충전할 때 쓰는 C-type 단자를 충전기와 연결하면 자동으로 리튬 이온 배터리가 충전된다는 것을 확인할 수 있다.</p></li>
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rakbox-uo100x75x38-solar/overview/">태양광 패널 설치 가이드</a> 를 참고하여 RAK19007 보드를 연결해준다.</p></li>
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak19007/datasheet/">RAK19007 wisboard</a> 의 Battery Connector, Solar Panel Connector 파트를 참고해 태양광 패널과 리튬 이온 배터리를 device에 달아준다.</p></li>
<li><p>자동으로 태양광 패널을 사용한 에너지 수확 기능 추가 되었는 지 확인하기 위하여 C-type 연결선을 제거하고 리튬 이온 배터리만을 이용하여 device를 구동해본다. 이전에 만들어둔 기본적인 온습도 예제를 사용하여 DynamoDB에 data가 저장되는지 확인하면 된다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>rak19007 wisboard의 적외선 카메라(RAK12052) 추가</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>IR camera module 설치</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://docs.rakwireless.com/product-categories/wisblock/rak12052/overview/">IR Array Module 가이드</a> 의 quick start guide에 들어가면 하드웨어를 wisboard에 설치하는 방법이 나와있다.</p></li>
<li><p>가이드를 따라 밑으로 이동하면 Aduino 예제가 나오는데 진행해볼 수 있다. Fileexamplesrak12052-MLX90640RAK12052_32X24_IR_Read_MLX90640 - RAK12052_32X24_IR_display_MLX90640 예제는 출력되는 화면이 따로 없으므로 사용하지 않았다. 화면 mobulde이 따로 없어도 아두이노의 serial monitor로 출력값이 어떻게 되는 지 확인 가능하다.</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>Device data Aws IOT core 에서 S3에 저장 서버 구축</p>
<blockquote>
<div><ul>
<li><p>과정 정리</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>device → MQTT(project/sensor/decoded)으로 전체 코드(온도 포함) 전송</p></li>
<li><p>LoRaWANRouting/action3 에 새로운 Lambdafunction을 만들어 추가 → 온도를 사진으로 변환 → S3 저장</p></li>
</ol>
</div></blockquote>
</li>
<li><p>AWS IoT Core</p>
<blockquote>
<div><ol class="arabic">
<li><dl class="simple">
<dt>action3 추가</dt><dd><p>AWS IoT/Message routing/Rules/LoRaWANRouting에서
deviced와 이미 연결되어 destination의 역할을 결정해주는 rule인 LoRaWANRouting의 action을 추가해 lambda 를 넣어준다.</p>
</dd>
</dl>
</li>
<li><dl>
<dt>lambda fuction 추가</dt><dd><p>lambda fuction: mqtt-to-s3-labdafuction 만들던거 그대로 role 추가해준다. (참고로 python을 쓰기 위해 blueprint 선택해주고 hellow world fuction python으로 지정한다)</p>
<p>특정 Topic으로 받은 데이터를 사진으로 변환하여 이후 만들 S3/bucket으로 전송하는 코드를 만들어준다.</p>
</dd>
</dl>
</li>
<li><p>role, policy 추가</p>
<blockquote>
<div><p>policy: mqtt-to-s3 로 람다 함수가 s3로 데이터를 넣을 수 있는 JSON을 만들어준다.</p>
<p>role: mqtt-to-s3-role 위의 정책을 가진 role을 마저 만들어준다.</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</li>
<li><p>3S</p>
<blockquote>
<div><ol class="arabic simple">
<li><dl class="simple">
<dt>Bucket 설정</dt><dd><p>bucket/permissions/policy에서 람다에서 보내는 데이터를 저장해주는 policy를 추가해준다.</p>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="id51">
<h4><strong>결과</strong><a class="headerlink" href="#id51" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><dl class="simple">
<dt>단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가 및 구동</dt><dd><p>→ 성공</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>rak19007 wisboard의 적외선 카메라(RAK12052) 추가 및 device data Aws IOT core 에서 S3에 저장</dt><dd><p>→ 환경은 구축했으나 아두이노에서 mqtt메세지를 보내는 부분이 완성되지 않아서 구동은 확인 불가</p>
</dd>
</dl>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="id52">
<h3>02월 16일 - 02월 22일 (02주차)<a class="headerlink" href="#id52" title="Link to this heading">¶</a></h3>
<section id="id53">
<h4><strong>목표</strong><a class="headerlink" href="#id53" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>window pc를 이용해서 이미지를 mqtt로 보내 amazon s3에 저장하기</p></li>
</ol>
<hr class="docutils" />
<p>참고링크: <a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">Amazon S3</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a>, <a class="reference external" href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/functions">lambda</a></p>
</section>
<hr class="docutils" />
<section id="id55">
<h4><strong>과정</strong><a class="headerlink" href="#id55" title="Link to this heading">¶</a></h4>
<section id="aws">
<h5>• aws 설정<a class="headerlink" href="#aws" title="Link to this heading">¶</a></h5>
<ul>
<li><dl>
<dt>aws 버킷 생성</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">Amazon S3</a> 로 이동</p></li>
<li><p>Creat bucket 선택</p></li>
<li><p>버킷 이름 지정 (본인이 원하는 이름으로)</p></li>
<li><p>나머지 설정은 기본값을 유지하고 버킷 생성</p></li>
</ol>
<figure class="align-center" id="id88">
<img alt="생성된 S3 버킷" src="_images/figure_004121_work2_2_1.jpg" />
<figcaption>
<p><span class="caption-number">그림 76 </span><span class="caption-text">생성된 S3 버킷</span><a class="headerlink" href="#id88" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
<li><dl>
<dt>aws IoT Core 설정(IoT thing 생성)</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 로 이동</p></li>
<li><p>Manage - All device - Things 이동</p></li>
<li><p>Creat things 선택</p></li>
<li><p>본인이 원하는 이름 입력 후 next 선택</p></li>
<li><p>Auto-generate new certificate 선택 후 next 선택</p></li>
<li><p>creat policy 선택</p></li>
<li><p>본인이 원하는 이름 입력</p></li>
<li><p>아래에 policy document 밑에 json 선택</p></li>
<li><p>코드 편집기에 다음 코드 입력(region은 aws 리전, account-id는 본인 aws id)</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">{</span>
<span class="w">  </span><span class="s2">&quot;Version&quot;</span>:<span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span>,
<span class="w">  </span><span class="s2">&quot;Statement&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">    </span><span class="o">{</span>
<span class="w">      </span><span class="s2">&quot;Effect&quot;</span>:<span class="w"> </span><span class="s2">&quot;Allow&quot;</span>,
<span class="w">      </span><span class="s2">&quot;Action&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;iot:Publish&quot;</span>,
<span class="w">        </span><span class="s2">&quot;iot:Subscribe&quot;</span>,
<span class="w">        </span><span class="s2">&quot;iot:Receive&quot;</span>,
<span class="w">        </span><span class="s2">&quot;iot:Connect&quot;</span>
<span class="w">      </span><span class="o">]</span>,
<span class="w">      </span><span class="s2">&quot;Resource&quot;</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="s2">&quot;arn:aws:iot:&lt;region&gt;:&lt;account-id&gt;:topic/iot/images&quot;</span>,
<span class="w">        </span><span class="s2">&quot;arn:aws:iot:&lt;region&gt;:&lt;account-id&gt;:topicfilter/iot/images&quot;</span>,
<span class="w">        </span><span class="s2">&quot;arn:aws:iot:&lt;region&gt;:&lt;account-id&gt;:client/*&quot;</span>
<span class="w">      </span><span class="o">]</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">  </span><span class="o">]</span>
<span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="10">
<li><p>create 선택</p></li>
<li><p>방금 생성한 policy 선택 후 create thing 선택</p></li>
</ol>
<figure class="align-center" id="id89">
<img alt="생성된 thing" src="_images/figure_004122_work2_2_2.jpg" />
<figcaption>
<p><span class="caption-number">그림 77 </span><span class="caption-text">생성된 thing</span><a class="headerlink" href="#id89" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</dd>
</dl>
</li>
<li><dl>
<dt>람다함수 생성하기</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/functions">lambda</a> 로 이동</p></li>
<li><p>Creat function 선택</p></li>
<li><p>본인이 원하는 이름 입력</p></li>
<li><p>Runtime은 python 최신버전 선택</p></li>
<li><p>creat function 선택</p></li>
<li><p>방금 생성한 람다함수 선택</p></li>
<li><p>아래에 Code 탭에 열려있는 lambda_function.py에 다음 코드를 입력</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import<span class="w"> </span>json
import<span class="w"> </span>base64
import<span class="w"> </span>boto3
import<span class="w"> </span><span class="nb">time</span>

<span class="c1"># AWS S3 클라이언트 생성</span>
<span class="nv">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>boto3.client<span class="o">(</span><span class="s1">&#39;s3&#39;</span><span class="o">)</span>

<span class="c1"># S3 버킷 이름 (본인의 버킷 이름으로 변경)</span>
<span class="nv">BUCKET_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;m-bucket-test&quot;</span>

def<span class="w"> </span>lambda_handler<span class="o">(</span>event,<span class="w"> </span>context<span class="o">)</span>:
<span class="w">    </span>try:
<span class="w">        </span><span class="c1"># 로그 출력 (디버깅용)</span>
<span class="w">        </span>print<span class="o">(</span><span class="s2">&quot;Received event:&quot;</span>,<span class="w"> </span>json.dumps<span class="o">(</span>event,<span class="w"> </span><span class="nv">indent</span><span class="o">=</span><span class="m">2</span><span class="o">))</span>

<span class="w">        </span><span class="c1"># MQTT 메시지에서 Base64 인코딩된 이미지 데이터 추출</span>
<span class="w">        </span><span class="nv">image_data_base64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>event.get<span class="o">(</span><span class="s1">&#39;image_data&#39;</span>,<span class="w"> </span>None<span class="o">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span>not<span class="w"> </span>image_data_base64:
<span class="w">            </span>raise<span class="w"> </span>ValueError<span class="o">(</span><span class="s2">&quot;image_data 필드가 존재하지 않습니다.&quot;</span><span class="o">)</span>

<span class="w">        </span><span class="c1"># Base64 인코딩된 이미지 데이터를 디코딩</span>
<span class="w">        </span><span class="nv">image_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>base64.b64decode<span class="o">(</span>image_data_base64<span class="o">)</span>

<span class="w">        </span><span class="c1"># 저장할 파일명 생성 (timestamp 기반)</span>
<span class="w">        </span><span class="nv">file_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>f<span class="s2">&quot;image_{int(time.time())}.jpg&quot;</span>

<span class="w">        </span><span class="c1"># S3에 이미지 업로드</span>
<span class="w">        </span>s3.put_object<span class="o">(</span>
<span class="w">            </span><span class="nv">Bucket</span><span class="o">=</span>BUCKET_NAME,
<span class="w">            </span><span class="nv">Key</span><span class="o">=</span>file_name,
<span class="w">            </span><span class="nv">Body</span><span class="o">=</span>image_data,
<span class="w">            </span><span class="nv">ContentType</span><span class="o">=</span><span class="s2">&quot;image/jpeg&quot;</span>
<span class="w">        </span><span class="o">)</span>

<span class="w">        </span>print<span class="o">(</span>f<span class="s2">&quot;Image successfully saved to S3: {file_name}&quot;</span><span class="o">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s1">&#39;statusCode&#39;</span>:<span class="w"> </span><span class="m">200</span>,
<span class="w">            </span><span class="s1">&#39;body&#39;</span>:<span class="w"> </span>json.dumps<span class="o">(</span>f<span class="s1">&#39;Image uploaded: {file_name}&#39;</span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span>except<span class="w"> </span>Exception<span class="w"> </span>as<span class="w"> </span>e:
<span class="w">        </span>print<span class="o">(</span>f<span class="s2">&quot;Error processing MQTT message: {str(e)}&quot;</span><span class="o">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">{</span>
<span class="w">            </span><span class="s1">&#39;statusCode&#39;</span>:<span class="w"> </span><span class="m">500</span>,
<span class="w">            </span><span class="s1">&#39;body&#39;</span>:<span class="w"> </span>json.dumps<span class="o">(</span>f<span class="s1">&#39;Error: {str(e)}&#39;</span><span class="o">)</span>
<span class="w">        </span><span class="o">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>왼쪽에 Deploy 선택</p></li>
</ol>
<figure class="align-center" id="id90">
<img alt="생성된 람다" src="_images/figure_004123_work2_2_3.jpg" />
<figcaption>
<p><span class="caption-number">그림 78 </span><span class="caption-text">생성된 람다</span><a class="headerlink" href="#id90" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic simple" start="9">
<li><p>configuration 탭 선택 후 왼쪽의 목록에서 permissions 선택</p></li>
<li><p>Role name 아래에 자동으로 생성된 role 하이퍼링크 클릭</p></li>
<li><p>permissions - Add permissions - Attach policies 선택</p></li>
<li><p>search 탭에 ‘AmazonS3FullAccess’ 검색 후 Add permissions 선택</p></li>
<li><p>같은 방법으로 ‘AWSIoTFullAccess’ permmissions 추가</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id91">
<img alt="permission이 추가된 모습" src="_images/figure_004124_work2_2_4.jpg" />
<figcaption>
<p><span class="caption-number">그림 79 </span><span class="caption-text">permission이 추가된 모습</span><a class="headerlink" href="#id91" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl>
<dt>람다 트리거 설정</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 로 이동</p></li>
<li><p>Manage - Message routing - Rules 이동</p></li>
<li><p>Creat rule 선택</p></li>
<li><p>본인이 원하는 이름 입력 후 next 선택</p></li>
<li><p>SQL version은 2016-03-23, SQL Statement에 다음 입력</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>SELECT<span class="w"> </span>*<span class="w"> </span>FROM<span class="w"> </span><span class="s1">&#39;iot/images&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>Rule actions에서 Action 1에 Lambda 선택</p></li>
<li><p>Lambda function에서 이전에 만든 Lambda function 선택 후 next 선택</p></li>
<li><p>Creat 선택</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id92">
<img alt="Rule이 추가된 모습" src="_images/figure_004125_work2_2_5.jpg" />
<figcaption>
<p><span class="caption-number">그림 80 </span><span class="caption-text">Rule이 추가된 모습</span><a class="headerlink" href="#id92" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id56">
<h5>• 테스트<a class="headerlink" href="#id56" title="Link to this heading">¶</a></h5>
<ul>
<li><dl>
<dt>이미지를 base64로 인코딩</dt><dd><ol class="arabic simple">
<li><p>S3에 저장하려는 이미지를 jpg로 바탕화면에 저장</p></li>
<li><p>다음 파이썬 코드를 실행</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">image_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\사용자명\Desktop\test.jpg&quot;</span>  <span class="c1"># 변환할 이미지 파일 (파일명을 본인의 이미지로 변경)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
    <span class="n">encoded_string</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">image_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">mqtt_payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;image_data&quot;</span><span class="p">:</span> <span class="n">encoded_string</span><span class="p">})</span>  <span class="c1"># JSON 변환</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mqtt_payload</span><span class="p">)</span>  <span class="c1"># 전체 Base64 문자열 출력</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt>저장 테스트</dt><dd><ol class="arabic simple">
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/iot/home?region=us-east-1#/home">IoT Core</a> 로 이동</p></li>
<li><p>Test - MQTT test client로 이동</p></li>
<li><p>Publish to a topic 선택</p></li>
<li><p>Topic name에 iot/images입력</p></li>
<li><p>Message payload에 python 코드를 실행한 결과를 그대로 붙혀넣기</p></li>
<li><p>publish 선택</p></li>
<li><p><a class="reference external" href="https://us-east-1.console.aws.amazon.com/s3/get-started?region=us-east-1">Amazon S3</a> 로 이동</p></li>
<li><p>본인이 생성한 버킷에 이미지가 저장됨</p></li>
</ol>
<blockquote>
<div><figure class="align-center" id="id93">
<img alt="이미지가 저장된 모습" src="_images/figure_004126_work2_2_6.jpg" />
<figcaption>
<p><span class="caption-number">그림 81 </span><span class="caption-text">이미지가 저장된 모습</span><a class="headerlink" href="#id93" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-center" id="id94">
<img alt="저장된 이미지를 확인할 수 있다" src="_images/figure_004127_work2_2_7.jpg" />
<figcaption>
<p><span class="caption-number">그림 82 </span><span class="caption-text">저장된 이미지를 확인할 수 있다</span><a class="headerlink" href="#id94" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</div></blockquote>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="id57">
<h4><strong>결과</strong><a class="headerlink" href="#id57" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><dl class="simple">
<dt>window pc를 이용해서 이미지를 mqtt로 보내 amazon s3에 저장하기</dt><dd><p>–&gt; 성공</p>
</dd>
</dl>
</li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="id58">
<h3>02월 23일 - 03월 01일 (03주차)<a class="headerlink" href="#id58" title="Link to this heading">¶</a></h3>
<p>더이상 진행할 수 있는 작업업이 없어서 문서화 작업 수행함.</p>
</section>
<hr class="docutils" />
<section id="id59">
<h3>결산<a class="headerlink" href="#id59" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><dl>
<dt>단말 장치에 태양광 패널을 사용한 에너지 수확 기능 추가</dt><dd><div class="line-block">
<div class="line"><strong>–&gt; 배터리를 장착하여 배터리를 사용해 디바이스가 동작하는 것을 확인함.</strong></div>
<div class="line"><strong>–&gt; 태양광 패널을 장착은 했지만 동작유무는 확인하지 못 함.</strong></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>단말 장치에 저해상도 적외선 카메라 기능 추가</dt><dd><p><strong>–&gt; 디바이스에 ir 카메라 모듈을 설치하고 파이썬을 이용해 동작을 확인함.</strong></p>
</dd>
</dl>
</li>
<li><dl>
<dt>서버에 영상 데이터 저장 기능 추가</dt><dd><div class="line-block">
<div class="line"><strong>–&gt; 디바이스에서 mqtt 메세지로 사진파일 보내기는 실패함.</strong></div>
<div class="line"><strong>–&gt; window PC환경에서 mqtt 메세지로 사진을 보내 S3에 저장은 성공함.</strong></div>
</div>
</dd>
</dl>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="id60">
<h3>기타<a class="headerlink" href="#id60" title="Link to this heading">¶</a></h3>
<br><hr class="docutils" />
</section>
</section>
<section id="sprt-07-09-rx004-02">
<span id="research-note-004018-2025-0209-0301-sprt-07-09-rx004-group02"></span><h2>연구 노트 2025_0209_0301_SPRT_07_09 RX004 02조<a class="headerlink" href="#sprt-07-09-rx004-02" title="Link to this heading">¶</a></h2>
<section id="id61">
<h3>개요<a class="headerlink" href="#id61" title="Link to this heading">¶</a></h3>
<p>.</p>
</section>
<hr class="docutils" />
<section id="id62">
<h3>02월 09일 - 02월 15일 (01주차)<a class="headerlink" href="#id62" title="Link to this heading">¶</a></h3>
<p>카메라와 RAK4630을 연결하고 태양광과 배터리를 연결하여 작동하는지 테스트 해봄.</p>
<p><a class="reference internal" href="#figure-001-01-temp"><span class="std std-numref">그림 83</span></a> 은 RAK4630을 하드웨어를 연결한 모습이다.</p>
<figure class="align-center" id="id95">
<span id="figure-001-01-temp"></span><a class="reference internal image-reference" href="_images/figure_004158_RAK4630_hard.png"><img alt="RAK4630" src="_images/figure_004158_RAK4630_hard.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 83 </span><span class="caption-text">RAK4630</span><a class="headerlink" href="#id95" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>카메라로 찍은 데이터 aws iot core에 보내는 코드 작성 (패킷문제 발생)</p>
</section>
<hr class="docutils" />
<section id="id63">
<h3>02월 16일 - 02월 22일 (02주차)<a class="headerlink" href="#id63" title="Link to this heading">¶</a></h3>
<p>rx004 라이브러리 사용법 학습</p>
</section>
<hr class="docutils" />
<section id="id64">
<h3>02월 23일 - 03월 01일 (03주차)<a class="headerlink" href="#id64" title="Link to this heading">¶</a></h3>
<p>개요</p>
<p>본 문서는 AWS IoT Core를 활용하여 MQTT 프로토콜을 통해 이미지를 전송하고, AWS Lambda를 이용하여 S3 버킷에 저장하는 과정에 대한 내용을 포함한다.</p>
<hr class="docutils" />
<p>AWS 설정</p>
<hr class="docutils" />
<p>S3 버킷 생성</p>
<p>AWS S3 콘솔로 이동한다.</p>
<p>“버킷 만들기”를 클릭한다.</p>
<p>버킷 이름: tests3coobarha</p>
<p>퍼블릭 액세스 차단 설정: “모든 퍼블릭 액세스 차단” 유지</p>
<p>“생성” 버튼을 클릭한다.</p>
<hr class="docutils" />
<p>AWS IoT Core에서 Thing 생성</p>
<p>AWS IoT Core 콘솔로 이동한다.</p>
<p>“Manage” → “Things”를 선택한다.</p>
<p>“Create Things”를 클릭하여 “Create single thing”을 선택한다.</p>
<p>Thing 이름: iot-image-uploader 입력</p>
<p>Device Shadow: “Enable” 선택</p>
<p>“Next” 클릭 후 “Auto-generate new certificate” 선택</p>
<p>“Next” → “Create Thing” 클릭</p>
<p><a class="reference internal" href="#figure-001-01-things"><span class="std std-numref">그림 84</span></a> 생성된 사물</p>
<figure class="align-center" id="id96">
<span id="figure-001-01-things"></span><a class="reference internal image-reference" href="_images/figure_004165_s3things.png"><img alt="생성된 사물" src="_images/figure_004165_s3things.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 84 </span><span class="caption-text">생성된 사물</span><a class="headerlink" href="#id96" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>AWS IoT Core 인증서 다운로드</p>
<p>AWS IoT Core에서 아래 3개의 파일을 다운로드한다.</p>
<p>Device Certificate (.crt 파일)</p>
<p>Private Key (.key 파일)</p>
<p>Amazon Root CA (AmazonRootCA1.pem)</p>
<p>다운로드한 파일을 안전한 폴더에 저장한다.</p>
<p>예: C:\Users\dlwng\Downloads\</p>
<hr class="docutils" />
<p>AWS IoT 정책 생성 (MQTT + S3 접근 허용)</p>
<p>AWS IoT Core 콘솔에서 “Secure” → “Policies” 클릭</p>
<p>“Create policy” 클릭</p>
<p>정책 이름: IoT_MQTT_S3_Policy</p>
<p>정책 문서(JSON) 추가</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="p">{</span>
<span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;iot:Publish&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;iot:Connect&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;iot:Receive&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;iot:Subscribe&quot;</span>
<span class="p">],</span>
<span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;s3:PutObject&quot;</span>
<span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arn:aws:s3:::iot-image-bucket/&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>“Create” 클릭</p>
<p>“Secure” → “Certificates”에서 Attach policy 선택 후 IoT_MQTT_S3_Policy 정책을 연결</p>
<p><a class="reference internal" href="#figure-001-01-poli"><span class="std std-numref">그림 85</span></a></p>
<figure class="align-center" id="id97">
<span id="figure-001-01-poli"></span><a class="reference internal image-reference" href="_images/figure_004162_s3pol.png"><img alt="정책" src="_images/figure_004162_s3pol.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 85 </span><span class="caption-text">정책</span><a class="headerlink" href="#id97" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>AWS Lambda 설정</p>
<p>Lambda 함수 생성</p>
<p>AWS Lambda 콘솔로 이동한다.</p>
<p>“Create function” 클릭</p>
<p>Function name: iot-image-handler</p>
<p>Runtime: Python 3.8 이상 선택</p>
<p>“Create function” 클릭</p>
<p>Lambda에 S3 접근 권한 추가</p>
<p>Lambda 콘솔에서 “Configuration” → “Permissions” 클릭</p>
<p>“Execution role” 아래 “Role name” 클릭</p>
<p>IAM 콘솔에서 “Add permissions” → “Attach policies” 클릭</p>
<p>“AmazonS3FullAccess” 선택 후 “Attach policies” 클릭</p>
<hr class="docutils" />
<p>Lambda 코드 작성</p>
<p>AWS IoT Core에서 MQTT 메시지를 받아 S3에 저장하는 Python 코드</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="kn">import</span><span class="w"> </span><span class="nn">boto3</span>
 <span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
 <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
 <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>


 <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
 <span class="n">BUCKET_NAME</span> <span class="o">=</span> <span class="s2">&quot;iot-image-bucket&quot;</span>

 <span class="k">def</span><span class="w"> </span><span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
 <span class="k">try</span><span class="p">:</span>
 <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📡 수신된 이벤트:&quot;</span><span class="p">)</span>
 <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

     <span class="n">image_data_base64</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image_data&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
     <span class="k">if</span> <span class="ow">not</span> <span class="n">image_data_base64</span><span class="p">:</span>
         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;❌ &#39;image_data&#39; 필드가 이벤트에 없음!&quot;</span><span class="p">)</span>

    <span class="n">image_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">image_data_base64</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;image_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">.png&quot;</span>

    <span class="n">s3</span><span class="o">.</span><span class="n">put_object</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">BUCKET_NAME</span><span class="p">,</span>
        <span class="n">Key</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">Body</span><span class="o">=</span><span class="n">image_data</span><span class="p">,</span>
        <span class="n">ContentType</span><span class="o">=</span><span class="s2">&quot;image/png&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ S3에 이미지 업로드 완료: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image uploaded to S3: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)}</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ 오류 발생: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;body&quot;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<hr class="docutils" />
<p>AWS IoT Core “Rules” 설정</p>
<p>AWS IoT Core에서 “Message routing” → “Rules” 선택</p>
<p>기존의 iot-image-rule 클릭</p>
<p>SQL Statement 수정</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="s1">&#39;image/topic&#39;</span>
</pre></div>
</div>
<p>“Lambda” 액션 추가</p>
<p>Lambda 함수 iot-image-handler 선택</p>
<p>“Update rule” 클릭하여 저장</p>
<p><a class="reference internal" href="#figure-001-01-rules"><span class="std std-numref">그림 86</span></a> 규칙</p>
<figure class="align-center" id="id98">
<span id="figure-001-01-rules"></span><a class="reference internal image-reference" href="_images/figure_004164_s3rules.png"><img alt="규칙" src="_images/figure_004164_s3rules.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 86 </span><span class="caption-text">규칙</span><a class="headerlink" href="#id98" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<hr class="docutils" />
<p>Python 코드 작성 (MQTT로 이미지 전송)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">AWSIoTPythonSDK.MQTTLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">AWSIoTMQTTClient</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;a263uq00h584cr-ats.iot.us-east-1.amazonaws.com&quot;</span>
<span class="n">THING_NAME</span> <span class="o">=</span> <span class="s2">&quot;iot-image-uploader&quot;</span>
<span class="n">TOPIC</span> <span class="o">=</span> <span class="s2">&quot;image/topic&quot;</span>

<span class="n">CA_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Downloads\AmazonRootCA1.pem&quot;</span>
<span class="n">CERT_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Downloads\device-certificate.pem.crt&quot;</span>
<span class="n">KEY_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Downloads\private.pem.key&quot;</span>

<span class="n">IMAGE_PATH</span> <span class="o">=</span> <span class="s2">&quot;C:\Users\dlwng\Pictures\Screenshots\스크린샷.png&quot;</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">AWSIoTMQTTClient</span><span class="p">(</span><span class="n">THING_NAME</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">configureEndpoint</span><span class="p">(</span><span class="n">ENDPOINT</span><span class="p">,</span> <span class="mi">8883</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">configureCredentials</span><span class="p">(</span><span class="n">CA_PATH</span><span class="p">,</span> <span class="n">KEY_PATH</span><span class="p">,</span> <span class="n">CERT_PATH</span><span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">IMAGE_PATH</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">image_file</span><span class="p">:</span>
<span class="n">image_data</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">image_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="n">THING_NAME</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span> <span class="s2">&quot;image_data&quot;</span><span class="p">:</span> <span class="n">image_data</span><span class="p">})</span>

<span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">,</span> <span class="n">payload</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
</pre></div>
</div>
<p>최종 결과 및 테스트</p>
<p>AWS IoT Core의 MQTT Test Client에서 image/topic을 구독하여 이미지 데이터가 정상적으로 전달되는지 확인한다. S3 버킷에서 이미지가 정상적으로 저장되는지 확인한다.</p>
<p><a class="reference internal" href="#figure-001-01-s3"><span class="std std-numref">그림 87</span></a> 는 결과 사진이다.</p>
<figure class="align-center" id="id99">
<span id="figure-001-01-s3"></span><a class="reference internal image-reference" href="_images/figure_004159_s3coobarha.png"><img alt="MQTT로 수신된 이미지파일" src="_images/figure_004159_s3coobarha.png" style="width: 90%;" />
</a>
<figcaption>
<p><span class="caption-number">그림 87 </span><span class="caption-text">MQTT로 수신된 이미지파일</span><a class="headerlink" href="#id99" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<hr class="docutils" />
<section id="id65">
<h3>결산<a class="headerlink" href="#id65" title="Link to this heading">¶</a></h3>
<p>.</p>
</section>
<hr class="docutils" />
<section id="id66">
<h3>기타<a class="headerlink" href="#id66" title="Link to this heading">¶</a></h3>
<p>.</p>
<br><hr class="docutils" />
<br></section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="seminar.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Seminar</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="technical_reports.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Technical reports</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, RX004
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Research notes</a><ul>
<li><a class="reference internal" href="#sprt-03-06-rx004-01">연구 노트 2025_0112_0208_SPRT_03_06 RX004 01조</a><ul>
<li><a class="reference internal" href="#id2">개요</a></li>
<li><a class="reference internal" href="#id3">01월 12일 - 01월 18일 (01주차)</a><ul>
<li><a class="reference internal" href="#id4"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id5"><strong>과정</strong></a><ul>
<li><a class="reference internal" href="#rak-1901">• rak 1901 동작 테스트</a></li>
<li><a class="reference internal" href="#id6">• 게이트웨이 등록하기</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">01월 19일 - 01월 25일 (02주차)</a><ul>
<li><a class="reference internal" href="#id9"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id12"><strong>과정</strong></a><ul>
<li><a class="reference internal" href="#id13">• 게이트웨이 설정</a></li>
<li><a class="reference internal" href="#id16">• 디바이스 등록</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id17"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">01월 26일 - 02월 01일 (설 연휴)</a></li>
<li><a class="reference internal" href="#id19">02월 02일 - 02월 08일 (03주차)</a><ul>
<li><a class="reference internal" href="#id20"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id21"><strong>과정</strong></a></li>
<li><a class="reference internal" href="#id22"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id23">결산</a></li>
<li><a class="reference internal" href="#id24">기타</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sprt-03-06-rx004-02">연구 노트 2025_0112_0208_SPRT_03_06 RX004 02조</a><ul>
<li><a class="reference internal" href="#id25">개요</a></li>
<li><a class="reference internal" href="#id26">01월 12일 - 01월 18일 (01주차)</a></li>
<li><a class="reference internal" href="#id29">01월 19일 - 01월 25일 (02주차)</a></li>
<li><a class="reference internal" href="#id34">01월 26일 - 02월 01일 (설 연휴)</a></li>
<li><a class="reference internal" href="#id35">02월 02일 - 02월 08일 (03주차)</a></li>
<li><a class="reference internal" href="#id39">결산</a></li>
<li><a class="reference internal" href="#id40">기타</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sprt-07-09-rx004-01">연구 노트 2025_0209_0301_SPRT_07_09 RX004 01조</a><ul>
<li><a class="reference internal" href="#id41">개요</a></li>
<li><a class="reference internal" href="#id42">02월 09일 - 02월 15일 (01주차)</a><ul>
<li><a class="reference internal" href="#id43"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id50"><strong>과정</strong></a></li>
<li><a class="reference internal" href="#id51"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id52">02월 16일 - 02월 22일 (02주차)</a><ul>
<li><a class="reference internal" href="#id53"><strong>목표</strong></a></li>
<li><a class="reference internal" href="#id55"><strong>과정</strong></a><ul>
<li><a class="reference internal" href="#aws">• aws 설정</a></li>
<li><a class="reference internal" href="#id56">• 테스트</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id57"><strong>결과</strong></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id58">02월 23일 - 03월 01일 (03주차)</a></li>
<li><a class="reference internal" href="#id59">결산</a></li>
<li><a class="reference internal" href="#id60">기타</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sprt-07-09-rx004-02">연구 노트 2025_0209_0301_SPRT_07_09 RX004 02조</a><ul>
<li><a class="reference internal" href="#id61">개요</a></li>
<li><a class="reference internal" href="#id62">02월 09일 - 02월 15일 (01주차)</a></li>
<li><a class="reference internal" href="#id63">02월 16일 - 02월 22일 (02주차)</a></li>
<li><a class="reference internal" href="#id64">02월 23일 - 03월 01일 (03주차)</a></li>
<li><a class="reference internal" href="#id65">결산</a></li>
<li><a class="reference internal" href="#id66">기타</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=10f1778b"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="https://cdn.jsdelivr.net/npm/pseudocode@latest/build/pseudocode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
    </body>
</html>